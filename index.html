<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameCreators - Sistema de Gest√£o Escolar</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéÆ</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2196F3;
            --primary-dark: #1976D2;
            --primary-light: #BBDEFB;
            --success: #4CAF50;
            --success-dark: #45a049;
            --warning: #FF9800;
            --danger: #f44336;
            --info: #2196F3;
            --light: #f5f5f5;
            --dark: #333;
            --border: #e0e0e0;
            --purple: #9C27B0;
            --gold: #FFD700;
            --background: #fafafa;
            --card-shadow: 0 4px 20px rgba(0,0,0,0.08);
            --hover-shadow: 0 8px 30px rgba(0,0,0,0.12);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            width: 100%;
            max-width: 450px;
            text-align: center;
            backdrop-filter: blur(10px);
            animation: slideIn 0.6s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-logo {
            font-size: 64px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .login-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .login-subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .login-tabs {
            display: flex;
            margin-bottom: 30px;
            background: var(--light);
            border-radius: 12px;
            padding: 4px;
        }

        .login-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 14px;
        }

        .login-tab.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .login-form {
            text-align: left;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 16px;
            transition: var(--transition);
            background: white;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
            transform: translateY(-1px);
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: var(--transition);
            margin-right: 12px;
            margin-bottom: 12px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--hover-shadow);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-danger { background: linear-gradient(135deg, var(--danger), #d32f2f); }
        .btn-success { background: linear-gradient(135deg, var(--success), var(--success-dark)); }
        .btn-warning { background: linear-gradient(135deg, var(--warning), #F57C00); }
        .btn-secondary { background: linear-gradient(135deg, #6c757d, #5a6268); }
        .btn-info { background: linear-gradient(135deg, var(--info), #1976D2); }
        .btn-purple { background: linear-gradient(135deg, var(--purple), #7B1FA2); }

        .forgot-password {
            text-align: center;
            margin-top: 20px;
        }

        .forgot-password a {
            color: var(--primary);
            text-decoration: none;
            font-size: 14px;
        }

        .forgot-password a:hover {
            text-decoration: underline;
        }

        .main-app {
            display: none;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            background: var(--background);
            min-height: 100vh;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -20px 40px rgba(0,0,0,0.15);
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            box-shadow: var(--card-shadow);
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .user-role {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            backdrop-filter: blur(10px);
        }

        .nav-tabs {
            display: flex;
            border-bottom: 3px solid var(--border);
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 15px;
            position: sticky;
            top: 0;
            background: var(--background);
            z-index: 100;
            margin: 0 -20px 30px -20px;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .nav-tab {
            padding: 14px 22px;
            background: white;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
            min-width: 130px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: var(--hover-shadow);
        }

        .nav-tab:hover:not(.active) {
            background: var(--primary-light);
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--card-shadow);
        }

        .nav-tab.hidden {
            display: none;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--hover-shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border);
            flex-wrap: wrap;
            gap: 15px;
        }

        .card-header h2 {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 28px;
            border-radius: 16px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .stat-card:hover {
            transform: scale(1.05) translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .stat-card.success {
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
        }

        .stat-card.warning {
            background: linear-gradient(135deg, var(--warning) 0%, #F57C00 100%);
        }

        .stat-card.danger {
            background: linear-gradient(135deg, var(--danger) 0%, #d32f2f 100%);
        }

        .stat-card.purple {
            background: linear-gradient(135deg, var(--purple) 0%, #7B1FA2 100%);
        }

        .stat-card.gold {
            background: linear-gradient(135deg, var(--gold) 0%, #FFA500 100%);
            color: #333;
        }

        .stat-number {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.95;
            font-weight: 500;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 24px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        .table th,
        .table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .table th {
            background: var(--light);
            font-weight: 700;
            color: var(--dark);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table tr:hover {
            background: rgba(33, 150, 243, 0.04);
            transform: scale(1.01);
            transition: var(--transition);
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
        }

        .badge.success { background: var(--success); color: white; }
        .badge.danger { background: var(--danger); color: white; }
        .badge.warning { background: var(--warning); color: white; }
        .badge.info { background: var(--info); color: white; }
        .badge.secondary { background: #6c757d; color: white; }

        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            padding: 18px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 10001;
            transform: translateX(400px);
            transition: var(--transition);
            max-width: 350px;
            box-shadow: var(--hover-shadow);
            backdrop-filter: blur(10px);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: linear-gradient(135deg, var(--success), var(--success-dark)); }
        .notification.error { background: linear-gradient(135deg, var(--danger), #d32f2f); }
        .notification.info { background: linear-gradient(135deg, var(--info), var(--primary-dark)); }
        .notification.warning { background: linear-gradient(135deg, var(--warning), #F57C00); }

        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            transform: translateY(-50px);
            transition: var(--transition);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal.show .modal-content {
            transform: translateY(0);
        }

        .financial-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: var(--light);
            border-radius: 12px;
            padding: 4px;
            flex-wrap: wrap;
        }

        .financial-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 14px;
            text-align: center;
            min-width: 120px;
        }

        .financial-tab.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .pedagogic-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: var(--light);
            border-radius: 12px;
            padding: 4px;
            flex-wrap: wrap;
        }

        .pedagogic-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 14px;
            text-align: center;
            min-width: 120px;
        }

        .pedagogic-tab.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .filters-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
        }

        .filter-group select {
            padding: 8px 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            min-width: 150px;
        }

        .financial-detail-card {
            background: var(--light);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid var(--info);
        }

        .financial-detail-card.overdue {
            border-left-color: var(--danger);
            background: rgba(244, 67, 54, 0.05);
        }

        .financial-detail-card.paid {
            border-left-color: var(--success);
            background: rgba(76, 175, 80, 0.05);
        }

        .financial-detail-card.pending {
            border-left-color: var(--warning);
            background: rgba(255, 152, 0, 0.05);
        }

        .student-financial-summary {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
        }

        .payment-history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .payment-history-item:last-child {
            border-bottom: none;
        }

        .class-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .class-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            cursor: pointer;
            border-left: 4px solid var(--primary);
        }

        .class-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .class-card h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .class-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .class-stat {
            text-align: center;
            padding: 10px;
            background: var(--light);
            border-radius: 8px;
        }

        .attendance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .attendance-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .attendance-btn.present {
            background: var(--success);
            color: white;
        }

        .attendance-btn.absent {
            background: var(--danger);
            color: white;
        }

        .attendance-btn.pending {
            background: var(--warning);
            color: white;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: var(--light);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--success), var(--success-dark));
            border-radius: 10px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }

        .module-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--card-shadow);
            border-left: 4px solid var(--info);
        }

        .module-card.completed {
            border-left-color: var(--success);
            background: rgba(76, 175, 80, 0.05);
        }

        .module-card.current {
            border-left-color: var(--warning);
            background: rgba(255, 152, 0, 0.05);
        }

        .lesson-list {
            margin-top: 15px;
        }

        .lesson-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .lesson-item:last-child {
            border-bottom: none;
        }

        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1000;
            display: block;
        }

        .connection-status.connected {
            background: var(--success);
            color: white;
        }

        .connection-status.disconnected {
            background: var(--danger);
            color: white;
        }

        @media (max-width: 768px) {
            .login-card {
                padding: 30px 20px;
            }

            .main-app {
                padding: 15px;
            }
            
            .nav-tabs { 
                flex-direction: column; 
                overflow-x: visible;
                margin: 0 -15px 30px -15px;
                padding: 15px;
            }
            
            .nav-tab { 
                margin-bottom: 8px; 
                min-width: auto;
                font-size: 14px;
                padding: 12px 18px;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }
            
            .card {
                padding: 20px;
            }
            
            .card-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .table {
                font-size: 14px;
            }
            
            .table th,
            .table td {
                padding: 10px 8px;
            }
            
            .btn {
                font-size: 14px;
                padding: 10px 16px;
            }
            
            .stat-number {
                font-size: 28px;
            }

            .modal-content {
                width: 95%;
                margin: 2% auto;
                padding: 20px;
            }

            .financial-tabs, .pedagogic-tabs {
                flex-direction: column;
            }

            .filters-section {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group select {
                min-width: auto;
            }

            .class-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="connectionStatus" class="connection-status disconnected">
        üî¥ Modo Demo
    </div>

    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="login-logo">üéÆ</div>
            <h1 class="login-title">GameCreators</h1>
            <p class="login-subtitle">Sistema de Gest√£o Escolar</p>
            
            <div class="login-tabs">
                <button class="login-tab active" onclick="switchLoginTab('colaborador')">üë®‚Äçüíº Colaborador</button>
                <button class="login-tab" onclick="switchLoginTab('aluno')">üë®‚Äçüéì Aluno</button>
            </div>

            <form id="colaboradorLogin" class="login-form">
                <div class="form-group">
                    <label for="loginUsuario">Usu√°rio</label>
                    <input type="text" id="loginUsuario" placeholder="admin ou ricardo" required value="admin">
                </div>
                <div class="form-group">
                    <label for="loginSenha">Senha</label>
                    <input type="password" id="loginSenha" placeholder="admin123 ou prof123" required value="admin123">
                </div>
                <button type="submit" class="btn">
                    üîë Entrar como Colaborador
                </button>
                <p style="font-size: 12px; color: #666; margin-top: 10px;">
                    Demo: admin/admin123 ou ricardo/prof123
                </p>
            </form>

            <form id="alunoLogin" class="login-form" style="display: none;">
                <div class="form-group">
                    <label for="loginRA">RA (Registro Acad√™mico)</label>
                    <input type="text" id="loginRA" placeholder="2025001" required value="2025001">
                </div>
                <button type="submit" class="btn btn-info">
                    üéì Entrar como Aluno
                </button>
                <p style="font-size: 12px; color: #666; margin-top: 10px;">
                    Demo: 2025001, 2025002 ou 2025003
                </p>
            </form>

            <div class="forgot-password">
                <a href="#" onclick="showMessage('Entre em contato com a administra√ß√£o', 'info')">Esqueci minha senha</a>
            </div>
        </div>
    </div>

    <div id="mainApp" class="main-app">
        <div class="header">
            <div class="header-info">
                <div>
                    <h1>üéÆ GameCreators - Sistema de Gest√£o</h1>
                    <p id="userWelcome">Bem-vindo!</p>
                </div>
                <div class="user-role" id="userRole">Usu√°rio</div>
            </div>
            <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                <button class="btn btn-info" onclick="connectSheets()" id="connectBtn">üîó Conectar Sheets</button>
                <button class="btn btn-secondary" onclick="toggleTheme()">üåô Tema</button>
                <button class="btn btn-warning" onclick="exportData()" id="exportBtn">üíæ Backup</button>
                <button class="btn btn-danger" onclick="logout()">üö™ Sair</button>
            </div>
        </div>

        <div class="nav-tabs" id="navTabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')" data-role="all">üìä Dashboard</button>
            <button class="nav-tab" onclick="switchTab('students')" data-role="admin,professor" id="studentsTab">üë• Alunos</button>
            <button class="nav-tab" onclick="switchTab('pedagogic')" data-role="admin,professor" id="pedagogicTab">üìö Pedag√≥gico</button>
            <button class="nav-tab" onclick="switchTab('financial')" data-role="admin" id="financialTab">üí∞ Financeiro</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card" onclick="switchTab('students')">
                    <div class="stat-number" id="totalStudents">5</div>
                    <div class="stat-label">üë• Total de Alunos</div>
                </div>
                <div class="stat-card success" onclick="switchTab('students')">
                    <div class="stat-number" id="activeStudents">3</div>
                    <div class="stat-label">‚úÖ Alunos Ativos</div>
                </div>
                <div class="stat-card purple" onclick="switchTab('pedagogic')">
                    <div class="stat-number" id="totalClasses">4</div>
                    <div class="stat-label">üè´ Turmas Ativas</div>
                </div>
                <div class="stat-card warning" onclick="switchTab('pedagogic')">
                    <div class="stat-number" id="todayAttendance">85%</div>
                    <div class="stat-label">üìä Presen√ßa Hoje</div>
                </div>
                <div class="stat-card danger" onclick="switchTab('financial')">
                    <div class="stat-number" id="overdueStudents">2</div>
                    <div class="stat-label">‚ö†Ô∏è Inadimplentes</div>
                </div>
                <div class="stat-card gold" onclick="switchTab('financial')">
                    <div class="stat-number" id="monthlyRevenue">R$ 2.098</div>
                    <div class="stat-label">üí∞ Receita Mensal</div>
                </div>
            </div>
        </div>

        <!-- Students Tab -->
        <div id="students" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2>üë• Gest√£o de Alunos</h2>
                    <button class="btn btn-success" onclick="openStudentModal()">‚ûï Novo Aluno</button>
                </div>

                <div class="filters-section">
                    <div class="filter-group">
                        <label>Status</label>
                        <select id="studentStatusFilter" onchange="filterStudents()">
                            <option value="">Todos os Status</option>
                            <option value="ativo">Ativo</option>
                            <option value="inadimplente">Inadimplente</option>
                            <option value="suspenso">Suspenso</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Curso</label>
                        <select id="studentCourseFilter" onchange="filterStudents()">
                            <option value="">Todos os Cursos</option>
                            <option value="unity">Unity Game Development</option>
                            <option value="blender">Blender 3D</option>
                            <option value="csharp">C# Programming</option>
                            <option value="unreal">Unreal Engine</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Turma</label>
                        <select id="studentClassFilter" onchange="filterStudents()">
                            <option value="">Todas as Turmas</option>
                        </select>
                    </div>
                </div>

                <table class="table">
                    <thead>
                        <tr>
                            <th>RA</th>
                            <th>Nome</th>
                            <th>Curso</th>
                            <th>Turma</th>
                            <th>Status</th>
                            <th>Mensalidade</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTableBody">
                        <!-- Students loaded dynamically -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Pedagogic Tab -->
        <div id="pedagogic" class="tab-content">
            <div class="pedagogic-tabs">
                <button class="pedagogic-tab active" onclick="switchPedagogicTab('classes')">üè´ Turmas</button>
                <button class="pedagogic-tab" onclick="switchPedagogicTab('attendance')">üìã Chamada</button>
                <button class="pedagogic-tab" onclick="switchPedagogicTab('progress')">üìà Progresso</button>
                <button class="pedagogic-tab" onclick="switchPedagogicTab('reports')">üìä Relat√≥rios</button>
            </div>

            <!-- Classes Tab -->
            <div id="pedagogicClasses" class="pedagogic-content active">
                <div class="card">
                    <div class="card-header">
                        <h2>üè´ Gest√£o de Turmas</h2>
                        <button class="btn btn-success" onclick="openClassModal()">‚ûï Nova Turma</button>
                    </div>
                    
                    <div class="class-grid" id="classesGrid">
                        <!-- Classes loaded dynamically -->
                    </div>
                </div>
            </div>

            <!-- Attendance Tab -->
            <div id="pedagogicAttendance" class="pedagogic-content">
                <div class="card">
                    <div class="card-header">
                        <h2>üìã Controle de Chamada</h2>
                        <div class="filters-section">
                            <div class="filter-group">
                                <label>Turma</label>
                                <select id="attendanceClassFilter" onchange="loadAttendance()">
                                    <option value="">Selecione uma turma</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Data</label>
                                <input type="date" id="attendanceDate" onchange="loadAttendance()" />
                            </div>
                            <button class="btn btn-primary" onclick="saveAttendance()">üíæ Salvar Chamada</button>
                        </div>
                    </div>
                    
                    <div id="attendanceContent">
                        <p style="text-align: center; color: #666; padding: 40px;">Selecione uma turma e data para fazer a chamada</p>
                    </div>
                </div>
            </div>

            <!-- Progress Tab -->
            <div id="pedagogicProgress" class="pedagogic-content">
                <div class="card">
                    <div class="card-header">
                        <h2>üìà Progresso dos Alunos</h2>
                        <div class="filters-section">
                            <div class="filter-group">
                                <label>Aluno</label>
                                <select id="progressStudentFilter" onchange="loadStudentProgress()">
                                    <option value="">Selecione um aluno</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div id="progressContent">
                        <p style="text-align: center; color: #666; padding: 40px;">Selecione um aluno para ver seu progresso</p>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="pedagogicReports" class="pedagogic-content">
                <div class="card">
                    <div class="card-header">
                        <h2>üìä Relat√≥rios de Frequ√™ncia</h2>
                        <div class="filters-section">
                            <div class="filter-group">
                                <label>Tipo de Relat√≥rio</label>
                                <select id="reportType" onchange="generatePedagogicReport()">
                                    <option value="">Selecione um tipo</option>
                                    <option value="daily">Frequ√™ncia Di√°ria</option>
                                    <option value="monthly">Frequ√™ncia Mensal</option>
                                    <option value="student">Por Aluno</option>
                                    <option value="class">Por Turma</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Per√≠odo</label>
                                <select id="reportPeriod" onchange="generatePedagogicReport()">
                                    <option value="current">M√™s Atual</option>
                                    <option value="last">M√™s Anterior</option>
                                    <option value="custom">Per√≠odo Personalizado</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div id="reportsContent">
                        <p style="text-align: center; color: #666; padding: 40px;">Selecione um tipo de relat√≥rio para visualizar</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Financial Tab -->
        <div id="financial" class="tab-content">
            <div class="financial-tabs">
                <button class="financial-tab active" onclick="switchFinancialTab('reports')">üìä Relat√≥rios</button>
                <button class="financial-tab" onclick="switchFinancialTab('tuitions')">üìÖ Mensalidades</button>
                <button class="financial-tab" onclick="switchFinancialTab('transactions')">üí∞ Transa√ß√µes</button>
            </div>

            <!-- Reports Tab -->
            <div id="financialReports" class="financial-content active">
                <div class="card">
                    <div class="card-header">
                        <h2>üìä Relat√≥rios Financeiros Avan√ßados</h2>
                    </div>
                    
                    <div class="filters-section">
                        <div class="filter-group">
                            <label>Filtrar por Aluno</label>
                            <select id="reportStudentFilter" onchange="filterReports()">
                                <option value="">Todos os Alunos</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Status do Aluno</label>
                            <select id="reportStatusFilter" onchange="filterReports()">
                                <option value="">Todos os Status</option>
                                <option value="ativo">Ativo</option>
                                <option value="inadimplente">Inadimplente</option>
                                <option value="suspenso">Suspenso</option>
                                <option value="cancelado">Cancelado</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Per√≠odo</label>
                            <select id="reportPeriodFilter" onchange="filterReports()">
                                <option value="current">M√™s Atual</option>
                                <option value="last3">√öltimos 3 Meses</option>
                                <option value="last6">√öltimos 6 Meses</option>
                                <option value="all">Todos os Per√≠odos</option>
                            </select>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card success" onclick="showDetailedReport('revenue')">
                            <div class="stat-number" id="monthlyRevenue">R$ 2.098,00</div>
                            <div class="stat-label">üí∞ Receita Total</div>
                        </div>
                        <div class="stat-card warning" onclick="showDetailedReport('pending')">
                            <div class="stat-number" id="pendingPaymentsCount">1</div>
                            <div class="stat-label">‚è∞ Pagamentos Pendentes</div>
                        </div>
                        <div class="stat-card danger" onclick="showDetailedReport('overdue')">
                            <div class="stat-number" id="overduePaymentsCount">2</div>
                            <div class="stat-label">‚ö†Ô∏è Pagamentos Atrasados</div>
                        </div>
                        <div class="stat-card info" onclick="showDetailedReport('cancelled')">
                            <div class="stat-number" id="cancelledCount">1</div>
                            <div class="stat-label">‚ùå Cancelados</div>
                        </div>
                    </div>

                    <div id="detailedReportSection" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h3 id="reportTitle">Relat√≥rio Detalhado</h3>
                                <button class="btn btn-secondary" onclick="hideDetailedReport()">‚úï Fechar</button>
                            </div>
                            <div id="reportContent">
                                <!-- Detailed report content loaded dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tuitions Tab -->
            <div id="financialTuitions" class="financial-content">
                <div class="card">
                    <div class="card-header">
                        <h2>üìÖ Controle de Mensalidades</h2>
                        <div class="filters-section">
                            <div class="filter-group">
                                <select id="tuitionMonthFilter" onchange="filterTuitions()">
                                    <option value="">Todos os meses</option>
                                    <option value="2025-01">Janeiro 2025</option>
                                    <option value="2025-02">Fevereiro 2025</option>
                                    <option value="2025-03">Mar√ßo 2025</option>
                                    <option value="2025-04">Abril 2025</option>
                                    <option value="2025-05">Maio 2025</option>
                                    <option value="2025-06">Junho 2025</option>
                                    <option value="2025-07">Julho 2025</option>
                                    <option value="2025-08">Agosto 2025</option>
                                    <option value="2025-09">Setembro 2025</option>
                                    <option value="2025-10">Outubro 2025</option>
                                    <option value="2025-11">Novembro 2025</option>
                                    <option value="2025-12">Dezembro 2025</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Aluno</th>
                                <th>Curso</th>
                                <th>Vencimento</th>
                                <th>Valor</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tuitionsTableBody">
                            <!-- Tuitions loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Transactions Tab -->
            <div id="financialTransactions" class="financial-content">
                <div class="card">
                    <div class="card-header">
                        <h2>üí∞ Transa√ß√µes Financeiras</h2>
                        <button class="btn btn-success" onclick="openTransactionModal()">‚ûï Nova Transa√ß√£o</button>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Tipo</th>
                                <th>Descri√ß√£o</th>
                                <th>Valor</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsTableBody">
                            <!-- Transactions loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- Student Modal -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <h3 id="studentModalTitle">Novo Aluno</h3>
            <form id="studentForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="studentRA">RA (Registro Acad√™mico)</label>
                        <input type="text" id="studentRA" required>
                    </div>
                    <div class="form-group">
                        <label for="studentName">Nome Completo</label>
                        <input type="text" id="studentName" required>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="studentEmail">Email</label>
                        <input type="email" id="studentEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="studentPhone">Telefone</label>
                        <input type="tel" id="studentPhone" required>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="studentCourse">Curso</label>
                        <select id="studentCourse" required>
                            <option value="">Selecione um curso</option>
                            <option value="unity">Unity Game Development</option>
                            <option value="blender">Blender 3D</option>
                            <option value="csharp">C# Programming</option>
                            <option value="unreal">Unreal Engine</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="studentClass">Turma</label>
                        <select id="studentClass" required>
                            <option value="">Selecione uma turma</option>
                        </select>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="studentTuition">Mensalidade (R$)</label>
                        <input type="number" id="studentTuition" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="studentStatus">Status</label>
                        <select id="studentStatus" required>
                            <option value="ativo">Ativo</option>
                            <option value="inadimplente">Inadimplente</option>
                            <option value="suspenso">Suspenso</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="studentEnrollmentDate">Data de Matr√≠cula</label>
                        <input type="date" id="studentEnrollmentDate" required>
                    </div>
                    <div class="form-group">
                        <label for="studentStartDate">Data de In√≠cio do Curso</label>
                        <input type="date" id="studentStartDate" required>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="studentDurationMonths">Dura√ß√£o (meses)</label>
                        <input type="number" id="studentDurationMonths" min="1" max="24" value="12" required>
                    </div>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('studentModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Salvar Aluno</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Class Modal -->
    <div id="classModal" class="modal">
        <div class="modal-content">
            <h3 id="classModalTitle">Nova Turma</h3>
            <form id="classForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="className">Nome da Turma</label>
                        <input type="text" id="className" required>
                    </div>
                    <div class="form-group">
                        <label for="classCourse">Curso</label>
                        <select id="classCourse" required>
                            <option value="">Selecione um curso</option>
                            <option value="unity">Unity Game Development</option>
                            <option value="blender">Blender 3D</option>
                            <option value="csharp">C# Programming</option>
                            <option value="unreal">Unreal Engine</option>
                        </select>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="classInstructor">Instrutor</label>
                        <input type="text" id="classInstructor" required>
                    </div>
                    <div class="form-group">
                        <label for="classSchedule">Hor√°rio</label>
                        <input type="text" id="classSchedule" placeholder="Ex: Seg/Qua/Sex 19h-22h" required>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="classStartDate">Data de In√≠cio</label>
                        <input type="date" id="classStartDate" required>
                    </div>
                    <div class="form-group">
                        <label for="classEndDate">Data de T√©rmino</label>
                        <input type="date" id="classEndDate" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="classDescription">Descri√ß√£o</label>
                    <textarea id="classDescription" rows="3"></textarea>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('classModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Salvar Turma</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Class Details Modal -->
    <div id="classDetailsModal" class="modal">
        <div class="modal-content">
            <h3 id="classDetailsTitle">Detalhes da Turma</h3>
            <div id="classDetailsContent">
                <!-- Class details loaded dynamically -->
            </div>
            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                <button type="button" class="btn btn-secondary" onclick="closeModal('classDetailsModal')">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Student Financial Details Modal -->
    <div id="studentFinancialModal" class="modal">
        <div class="modal-content">
            <h3 id="studentFinancialTitle">Situa√ß√£o Financeira do Aluno</h3>
            <div id="studentFinancialContent">
                <!-- Student financial details loaded dynamically -->
            </div>
            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                <button type="button" class="btn btn-secondary" onclick="closeModal('studentFinancialModal')">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Transaction Modal -->
    <div id="transactionModal" class="modal">
        <div class="modal-content">
            <h3 id="transactionModalTitle">Nova Transa√ß√£o</h3>
            <form id="transactionForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="transactionDate">Data</label>
                        <input type="date" id="transactionDate" required>
                    </div>
                    <div class="form-group">
                        <label for="transactionType">Tipo</label>
                        <select id="transactionType" required>
                            <option value="">Selecione</option>
                            <option value="receita">Receita</option>
                            <option value="despesa">Despesa</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="transactionDescription">Descri√ß√£o</label>
                    <input type="text" id="transactionDescription" required>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="transactionValue">Valor (R$)</label>
                        <input type="number" id="transactionValue" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="transactionStatus">Status</label>
                        <select id="transactionStatus" required>
                            <option value="pendente">Pendente</option>
                            <option value="pago">Pago</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('transactionModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Salvar Transa√ß√£o</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Transfer Student Modal -->
    <div id="transferModal" class="modal">
        <div class="modal-content">
            <h3>Transferir Aluno de Turma</h3>
            <form id="transferForm">
                <div class="form-group">
                    <label>Aluno:</label>
                    <p id="transferStudentName" style="font-weight: bold; margin-bottom: 15px;"></p>
                </div>
                <div class="form-group">
                    <label>Turma Atual:</label>
                    <p id="transferCurrentClass" style="margin-bottom: 15px;"></p>
                </div>
                <div class="form-group">
                    <label for="transferNewClass">Nova Turma</label>
                    <select id="transferNewClass" required>
                        <option value="">Selecione uma turma</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="transferReason">Motivo da Transfer√™ncia</label>
                    <textarea id="transferReason" rows="3"></textarea>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('transferModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Confirmar Transfer√™ncia</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentEditingId = null;
        let currentEditingType = null;

        // Demo data with expanded functionality
        const demoData = {
            users: [
                { id: 1, username: 'admin', password: 'admin123', name: 'Administrador do Sistema', email: 'admin@gamecreators.com', role: 'admin' },
                { id: 2, username: 'ricardo', password: 'prof123', name: 'Prof. Ricardo Santos', email: 'ricardo@gamecreators.com', role: 'professor' }
            ],
            classes: [
                { 
                    id: 1, 
                    name: 'Unity Iniciante - Manh√£', 
                    course: 'unity', 
                    instructor: 'Prof. Ricardo Santos', 
                    schedule: 'Seg/Qua/Sex 09h-12h',
                    startDate: '2025-02-01',
                    endDate: '2025-08-01',
                    description: 'Turma voltada para iniciantes em desenvolvimento de jogos com Unity'
                },
                { 
                    id: 2, 
                    name: 'Unity Avan√ßado - Noite', 
                    course: 'unity', 
                    instructor: 'Prof. Ana Silva', 
                    schedule: 'Ter/Qui 19h-22h',
                    startDate: '2025-03-01',
                    endDate: '2025-09-01',
                    description: 'Turma para alunos com conhecimento intermedi√°rio em Unity'
                },
                { 
                    id: 3, 
                    name: 'Blender 3D - Tarde', 
                    course: 'blender', 
                    instructor: 'Prof. Carlos Lima', 
                    schedule: 'Ter/Qui/Sab 14h-17h',
                    startDate: '2025-02-10',
                    endDate: '2025-12-10',
                    description: 'Curso completo de modelagem e anima√ß√£o 3D com Blender'
                },
                { 
                    id: 4, 
                    name: 'C# Programming - Noite', 
                    course: 'csharp', 
                    instructor: 'Prof. Maria Santos', 
                    schedule: 'Seg/Qua/Sex 19h-22h',
                    startDate: '2025-02-15',
                    endDate: '2025-10-15',
                    description: 'Programa√ß√£o avan√ßada em C# para desenvolvimento de jogos'
                }
            ],
            students: [
                { 
                    id: 1, ra: '2025001', name: 'Jo√£o Silva', email: 'joao@email.com', phone: '(11) 99999-9999', 
                    course: 'unity', classId: 1, status: 'ativo', tuition: 299.00, progress: 75,
                    enrollmentDate: '2025-01-15', startDate: '2025-02-01', durationMonths: 12, endDate: '2026-02-01',
                    currentModule: 3, currentLesson: 12
                },
                { 
                    id: 2, ra: '2025002', name: 'Maria Santos', email: 'maria@email.com', phone: '(11) 88888-8888', 
                    course: 'blender', classId: 3, status: 'inadimplente', tuition: 199.00, progress: 60,
                    enrollmentDate: '2025-01-20', startDate: '2025-02-10', durationMonths: 10, endDate: '2025-12-10',
                    currentModule: 2, currentLesson: 8
                },
                { 
                    id: 3, ra: '2025003', name: 'Carlos Oliveira', email: 'carlos@email.com', phone: '(11) 77777-7777', 
                    course: 'csharp', classId: 4, status: 'ativo', tuition: 349.00, progress: 85,
                    enrollmentDate: '2025-02-01', startDate: '2025-02-15', durationMonths: 8, endDate: '2025-10-15',
                    currentModule: 4, currentLesson: 20
                },
                { 
                    id: 4, ra: '2025004', name: 'Ana Costa', email: 'ana.costa@email.com', phone: '(11) 66666-6666', 
                    course: 'unity', classId: 2, status: 'inadimplente', tuition: 299.00, progress: 45,
                    enrollmentDate: '2025-03-01', startDate: '2025-03-15', durationMonths: 12, endDate: '2026-03-15',
                    currentModule: 2, currentLesson: 5
                },
                { 
                    id: 5, ra: '2025005', name: 'Pedro Lima', email: 'pedro@email.com', phone: '(11) 55555-5555', 
                    course: 'unreal', classId: null, status: 'cancelado', tuition: 399.00, progress: 15,
                    enrollmentDate: '2025-04-01', startDate: '2025-04-15', durationMonths: 14, endDate: '2026-06-15',
                    currentModule: 1, currentLesson: 3
                }
            ],
            courses: [
                { 
                    id: 1, name: 'Unity Game Development', code: 'unity', description: 'Desenvolvimento completo de jogos com Unity', 
                    hours: 180, price: 299.00, duration: 12,
                    modules: [
                        { id: 1, name: 'Introdu√ß√£o ao Unity', lessons: ['Interface do Unity', 'Criando primeiro projeto', 'GameObjects e Components', 'Transforma√ß√µes', 'Prefabs'] },
                        { id: 2, name: 'Scripts e Programa√ß√£o', lessons: ['Introdu√ß√£o ao C#', 'MonoBehaviour', 'Update e Start', 'Input System', 'Controle de Jogador'] },
                        { id: 3, name: 'F√≠sica e Colis√µes', lessons: ['Rigidbody', 'Colliders', 'Triggers', 'For√ßas e Movimento', 'Raycast'] },
                        { id: 4, name: 'Interface e UI', lessons: ['Canvas e UI', 'Bot√µes e Eventos', 'Invent√°rio', 'Menus', 'HUD'] }
                    ]
                },
                { 
                    id: 2, name: 'Blender 3D', code: 'blender', description: 'Modelagem e anima√ß√£o 3D profissional', 
                    hours: 120, price: 199.00, duration: 10,
                    modules: [
                        { id: 1, name: 'Interface do Blender', lessons: ['Navega√ß√£o 3D', 'Sele√ß√£o e Manipula√ß√£o', 'Viewports', 'Shortcuts'] },
                        { id: 2, name: 'Modelagem', lessons: ['Edit Mode', 'Extrude e Inset', 'Loop Cuts', 'Subdivis√£o', 'Modificadores'] },
                        { id: 3, name: 'Materiais e Texturas', lessons: ['Shader Editor', 'Texturas PBR', 'UV Mapping', 'Ilumina√ß√£o'] }
                    ]
                },
                { 
                    id: 3, name: 'C# Programming', code: 'csharp', description: 'Programa√ß√£o avan√ßada em C#', 
                    hours: 160, price: 349.00, duration: 8,
                    modules: [
                        { id: 1, name: 'Fundamentos C#', lessons: ['Vari√°veis e Tipos', 'Operadores', 'Estruturas de Controle', 'Arrays'] },
                        { id: 2, name: 'Orienta√ß√£o a Objetos', lessons: ['Classes e Objetos', 'Heran√ßa', 'Polimorfismo', 'Encapsulamento'] },
                        { id: 3, name: 'Cole√ß√µes e LINQ', lessons: ['Lists e Arrays', 'Dictionary', 'LINQ Queries', 'Lambda'] },
                        { id: 4, name: 'Padr√µes de Projeto', lessons: ['Singleton', 'Factory', 'Observer', 'Strategy'] }
                    ]
                },
                { 
                    id: 4, name: 'Unreal Engine', code: 'unreal', description: 'Desenvolvimento de jogos com Unreal Engine', 
                    hours: 200, price: 399.00, duration: 14,
                    modules: [
                        { id: 1, name: 'Introdu√ß√£o ao Unreal', lessons: ['Interface', 'Content Browser', 'Viewport', 'Blueprint Basics'] }
                    ]
                }
            ],
            attendance: [
                // Format: { classId, studentId, date, status: 'present'|'absent' }
                { id: 1, classId: 1, studentId: 1, date: '2025-09-01', status: 'present' },
                { id: 2, classId: 1, studentId: 2, date: '2025-09-01', status: 'absent' },
                { id: 3, classId: 3, studentId: 2, date: '2025-09-01', status: 'present' },
                { id: 4, classId: 4, studentId: 3, date: '2025-09-01', status: 'present' }
            ],
            transactions: [
                { id: 1, date: '2025-09-01', type: 'receita', description: 'Mensalidade Jo√£o Silva - Setembro', value: 299.00, status: 'pago', studentId: 1 },
                { id: 2, date: '2025-09-01', type: 'receita', description: 'Mensalidade Carlos Oliveira - Setembro', value: 349.00, status: 'pago', studentId: 3 },
                { id: 3, date: '2025-09-01', type: 'receita', description: 'Mensalidade Maria Santos - Setembro', value: 199.00, status: 'pendente', studentId: 2 },
                { id: 4, date: '2025-08-01', type: 'receita', description: 'Mensalidade Jo√£o Silva - Agosto', value: 299.00, status: 'pago', studentId: 1 },
                { id: 5, date: '2025-08-01', type: 'receita', description: 'Mensalidade Carlos Oliveira - Agosto', value: 349.00, status: 'pago', studentId: 3 },
                { id: 6, date: '2025-08-01', type: 'receita', description: 'Mensalidade Maria Santos - Agosto', value: 199.00, status: 'atrasado', studentId: 2 },
                { id: 7, date: '2025-07-01', type: 'receita', description: 'Mensalidade Ana Costa - Julho', value: 299.00, status: 'atrasado', studentId: 4 },
                { id: 8, date: '2025-08-15', type: 'despesa', description: 'Licen√ßa Unity Pro', value: 1500.00, status: 'pago' },
                { id: 9, date: '2025-07-20', type: 'despesa', description: 'Material Did√°tico', value: 850.00, status: 'pago' }
            ]
        };

        // Utility functions
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString + 'T00:00:00');
            return date.toLocaleDateString('pt-BR');
        }

        function showMessage(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'block';
            setTimeout(() => modal.classList.add('show'), 10);
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('show');
            setTimeout(() => modal.style.display = 'none', 300);
        }

        // Login functions
        function switchLoginTab(type) {
            const colaboradorTab = document.querySelector('.login-tab:first-child');
            const alunoTab = document.querySelector('.login-tab:last-child');
            const colaboradorForm = document.getElementById('colaboradorLogin');
            const alunoForm = document.getElementById('alunoLogin');

            if (type === 'colaborador') {
                colaboradorTab.classList.add('active');
                alunoTab.classList.remove('active');
                colaboradorForm.style.display = 'block';
                alunoForm.style.display = 'none';
            } else {
                alunoTab.classList.add('active');
                colaboradorTab.classList.remove('active');
                alunoForm.style.display = 'block';
                colaboradorForm.style.display = 'none';
            }
        }

        // Main login logic
        document.getElementById('colaboradorLogin').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsuario').value;
            const password = document.getElementById('loginSenha').value;

            const user = demoData.users.find(u => u.username === username && u.password === password);
            if (user) {
                currentUser = user;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('userWelcome').textContent = `Bem-vindo, ${user.name}!`;
                document.getElementById('userRole').textContent = user.role === 'admin' ? 'Administrador' : 'Professor';
                
                setupUserInterface();
                loadDashboard();
                showMessage('Login realizado com sucesso!', 'success');
            } else {
                showMessage('Usu√°rio ou senha incorretos!', 'error');
            }
        });

        document.getElementById('alunoLogin').addEventListener('submit', function(e) {
            e.preventDefault();
            const ra = document.getElementById('loginRA').value;
            
            const student = demoData.students.find(s => s.ra === ra);
            if (student) {
                currentUser = { ...student, role: 'student' };
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('userWelcome').textContent = `Bem-vindo, ${student.name}!`;
                document.getElementById('userRole').textContent = 'Aluno';
                
                setupStudentInterface();
                showMessage('Login realizado com sucesso!', 'success');
            } else {
                showMessage('RA n√£o encontrado!', 'error');
            }
        });

        function setupUserInterface() {
            const tabs = document.querySelectorAll('.nav-tab');
            const userRole = currentUser.role;

            tabs.forEach(tab => {
                const allowedRoles = tab.getAttribute('data-role');
                if (allowedRoles === 'all' || allowedRoles.includes(userRole)) {
                    tab.style.display = 'block';
                } else {
                    tab.style.display = 'none';
                }
            });

            // Populate filter dropdowns
            populateStudentFilters();
            populateClassFilters();
        }

        function setupStudentInterface() {
            // Hide all tabs except dashboard for students
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                const allowedRoles = tab.getAttribute('data-role');
                if (allowedRoles !== 'all') {
                    tab.style.display = 'none';
                }
            });
            
            // Show student-specific dashboard
            loadStudentDashboard();
        }

        function loadStudentDashboard() {
            const dashboard = document.getElementById('dashboard');
            const student = currentUser;
            const course = demoData.courses.find(c => c.code === student.course);
            const className = student.classId ? demoData.classes.find(c => c.id === student.classId)?.name : 'N√£o matriculado';
            
            dashboard.innerHTML = `
                <div class="student-financial-summary">
                    <h2>üìö Minha √Årea do Aluno</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                        <div>
                            <h4>Informa√ß√µes Acad√™micas</h4>
                            <p><strong>Nome:</strong> ${student.name}</p>
                            <p><strong>RA:</strong> ${student.ra}</p>
                            <p><strong>Curso:</strong> ${course ? course.name : student.course}</p>
                            <p><strong>Turma:</strong> ${className}</p>
                            <p><strong>Status:</strong> <span class="badge ${getStatusBadgeClass(student.status)}">${student.status}</span></p>
                        </div>
                        <div>
                            <h4>Progresso do Curso</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${student.progress}%">${student.progress}%</div>
                            </div>
                            <p><strong>M√≥dulo Atual:</strong> ${student.currentModule}</p>
                            <p><strong>Aula Atual:</strong> ${student.currentLesson}</p>
                            <p><strong>Data de T√©rmino:</strong> ${formatDate(student.endDate)}</p>
                        </div>
                        <div>
                            <h4>Informa√ß√µes Financeiras</h4>
                            <p><strong>Mensalidade:</strong> ${formatCurrency(student.tuition)}</p>
                            <p><strong>Data de In√≠cio:</strong> ${formatDate(student.startDate)}</p>
                            <p><strong>Dura√ß√£o:</strong> ${student.durationMonths} meses</p>
                            <p><strong>Data de T√©rmino:</strong> ${formatDate(student.endDate)}</p>
                        </div>
                    </div>
                    <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                        <button class="btn btn-info" onclick="viewStudentFinancialDetails(${student.id})">
                            üí∞ Hist√≥rico de Pagamentos
                        </button>
                        <button class="btn btn-purple" onclick="viewStudentProgress(${student.id})">
                            üìà Progresso Detalhado
                        </button>
                        <button class="btn btn-success" onclick="viewStudentAttendance(${student.id})">
                            üìã Minha Frequ√™ncia
                        </button>
                    </div>
                </div>
            `;
        }

        function viewStudentProgress(studentId) {
            const student = demoData.students.find(s => s.id === studentId);
            const course = demoData.courses.find(c => c.code === student.course);
            
            if (!course) return;

            let progressContent = `
                <div class="student-financial-summary">
                    <h4>üìà Progresso Detalhado - ${student.name}</h4>
                    <div style="margin-bottom: 20px;">
                        <p><strong>Curso:</strong> ${course.name}</p>
                        <p><strong>Progresso Geral:</strong></p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${student.progress}%">${student.progress}%</div>
                        </div>
                    </div>
                </div>
            `;

            course.modules.forEach((module, index) => {
                const moduleIndex = index + 1;
                let moduleStatus = '';
                let moduleClass = '';
                
                if (moduleIndex < student.currentModule) {
                    moduleStatus = 'Conclu√≠do';
                    moduleClass = 'completed';
                } else if (moduleIndex === student.currentModule) {
                    moduleStatus = 'Em Andamento';
                    moduleClass = 'current';
                } else {
                    moduleStatus = 'Pendente';
                    moduleClass = '';
                }

                progressContent += `
                    <div class="module-card ${moduleClass}">
                        <div style="display: flex; justify-content: between; align-items: center;">
                            <div>
                                <h5>M√≥dulo ${moduleIndex}: ${module.name}</h5>
                                <p><span class="badge ${moduleClass === 'completed' ? 'success' : moduleClass === 'current' ? 'warning' : 'secondary'}">${moduleStatus}</span></p>
                            </div>
                        </div>
                        <div class="lesson-list">
                            ${module.lessons.map((lesson, lessonIndex) => {
                                const lessonNumber = lessonIndex + 1;
                                let lessonStatus = '';
                                
                                if (moduleIndex < student.currentModule || 
                                    (moduleIndex === student.currentModule && lessonNumber <= student.currentLesson)) {
                                    lessonStatus = '‚úÖ';
                                } else if (moduleIndex === student.currentModule && lessonNumber === student.currentLesson + 1) {
                                    lessonStatus = '‚ñ∂Ô∏è';
                                } else {
                                    lessonStatus = '‚è≥';
                                }
                                
                                return `
                                    <div class="lesson-item">
                                        <span>${lessonStatus} Aula ${lessonNumber}: ${lesson}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            });

            // Show in modal
            document.getElementById('studentFinancialTitle').textContent = `üìà Progresso - ${student.name}`;
            document.getElementById('studentFinancialContent').innerHTML = progressContent;
            openModal('studentFinancialModal');
        }

        function viewStudentAttendance(studentId) {
            const student = demoData.students.find(s => s.id === studentId);
            const studentAttendance = demoData.attendance.filter(a => a.studentId === studentId);
            
            let attendanceContent = `
                <div class="student-financial-summary">
                    <h4>üìã Frequ√™ncia - ${student.name}</h4>
                    <div style="margin-bottom: 20px;">
                        <p><strong>Total de Aulas:</strong> ${studentAttendance.length}</p>
                        <p><strong>Presen√ßas:</strong> ${studentAttendance.filter(a => a.status === 'present').length}</p>
                        <p><strong>Faltas:</strong> ${studentAttendance.filter(a => a.status === 'absent').length}</p>
                        <p><strong>Percentual de Frequ√™ncia:</strong> ${Math.round((studentAttendance.filter(a => a.status === 'present').length / studentAttendance.length) * 100)}%</p>
                    </div>
                </div>

                <h5 style="margin-bottom: 15px;">üìÖ Hist√≥rico de Presen√ßas</h5>
                <div style="max-height: 400px; overflow-y: auto;">
                    ${studentAttendance.map(attendance => `
                        <div class="financial-detail-card ${attendance.status === 'present' ? 'paid' : 'overdue'}">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h6>${formatDate(attendance.date)}</h6>
                                </div>
                                <div>
                                    <span class="badge ${attendance.status === 'present' ? 'success' : 'danger'}">
                                        ${attendance.status === 'present' ? 'Presente' : 'Falta'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            document.getElementById('studentFinancialTitle').textContent = `üìã Frequ√™ncia - ${student.name}`;
            document.getElementById('studentFinancialContent').innerHTML = attendanceContent;
            openModal('studentFinancialModal');
        }

        function getCourseNameByCode(code) {
            const course = demoData.courses.find(c => c.code === code);
            return course ? course.name : code;
        }

        function getStatusBadgeClass(status) {
            const classes = {
                'ativo': 'success',
                'inadimplente': 'danger',
                'suspenso': 'warning',
                'cancelado': 'secondary'
            };
            return classes[status] || 'secondary';
        }

        // Tab switching
        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.nav-tab');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));

            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');

            // Load tab content
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'students':
                    loadStudents();
                    break;
                case 'pedagogic':
                    loadPedagogic();
                    break;
                case 'financial':
                    loadFinancial();
                    break;
            }
        }

        // Pedagogic tab switching
        function switchPedagogicTab(tabName) {
            const tabs = document.querySelectorAll('.pedagogic-tab');
            const contents = document.querySelectorAll('.pedagogic-content');

            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById('pedagogic' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.add('active');

            switch(tabName) {
                case 'classes':
                    loadClasses();
                    break;
                case 'attendance':
                    loadAttendanceTab();
                    break;
                case 'progress':
                    loadProgressTab();
                    break;
                case 'reports':
                    loadPedagogicReportsTab();
                    break;
            }
        }

        // Financial tab switching
        function switchFinancialTab(tabName) {
            const tabs = document.querySelectorAll('.financial-tab');
            const contents = document.querySelectorAll('.financial-content');

            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById('financial' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.add('active');

            if (tabName === 'tuitions') {
                loadTuitions();
            } else if (tabName === 'transactions') {
                loadTransactions();
            } else if (tabName === 'reports') {
                loadFinancialReports();
            }
        }

        // Dashboard loading
        function loadDashboard() {
            if (currentUser?.role === 'student') {
                loadStudentDashboard();
                return;
            }

            const totalStudents = demoData.students.length;
            const activeStudents = demoData.students.filter(s => s.status === 'ativo').length;
            const totalClasses = demoData.classes.length;
            const overdueStudents = demoData.students.filter(s => s.status === 'inadimplente').length;
            const pendingPayments = demoData.transactions.filter(t => t.status === 'pendente').length;

            // Calculate today's attendance
            const today = new Date().toISOString().split('T')[0];
            const todayAttendance = demoData.attendance.filter(a => a.date === today);
            const todayPresent = todayAttendance.filter(a => a.status === 'present').length;
            const todayAttendanceRate = todayAttendance.length > 0 ? Math.round((todayPresent / todayAttendance.length) * 100) : 0;

            // Calculate monthly revenue
            const currentMonth = new Date().toISOString().slice(0, 7);
            const monthlyRevenue = demoData.transactions
                .filter(t => t.type === 'receita' && t.status === 'pago' && t.date.startsWith(currentMonth))
                .reduce((sum, t) => sum + t.value, 0);

            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('activeStudents').textContent = activeStudents;
            document.getElementById('totalClasses').textContent = totalClasses;
            document.getElementById('todayAttendance').textContent = `${todayAttendanceRate}%`;
            document.getElementById('overdueStudents').textContent = overdueStudents;
            document.getElementById('monthlyRevenue').textContent = formatCurrency(monthlyRevenue);
        }

        // Students management
        function populateStudentFilters() {
            // Populate student filter for reports
            const reportStudentFilter = document.getElementById('reportStudentFilter');
            if (reportStudentFilter) {
                reportStudentFilter.innerHTML = '<option value="">Todos os Alunos</option>';
                demoData.students.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = `${student.name} (${student.ra})`;
                    reportStudentFilter.appendChild(option);
                });
            }

            // Populate class filters
            const studentClassFilter = document.getElementById('studentClassFilter');
            if (studentClassFilter) {
                studentClassFilter.innerHTML = '<option value="">Todas as Turmas</option>';
                demoData.classes.forEach(cls => {
                    const option = document.createElement('option');
                    option.value = cls.id;
                    option.textContent = cls.name;
                    studentClassFilter.appendChild(option);
                });
            }

            // Populate progress student filter
            const progressStudentFilter = document.getElementById('progressStudentFilter');
            if (progressStudentFilter) {
                progressStudentFilter.innerHTML = '<option value="">Selecione um aluno</option>';
                demoData.students.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = `${student.name} (${student.ra})`;
                    progressStudentFilter.appendChild(option);
                });
            }
        }

        function populateClassFilters() {
            // Populate attendance class filter
            const attendanceClassFilter = document.getElementById('attendanceClassFilter');
            if (attendanceClassFilter) {
                attendanceClassFilter.innerHTML = '<option value="">Selecione uma turma</option>';
                demoData.classes.forEach(cls => {
                    const option = document.createElement('option');
                    option.value = cls.id;
                    option.textContent = cls.name;
                    attendanceClassFilter.appendChild(option);
                });
            }

            // Populate student class selection in forms
            const studentClass = document.getElementById('studentClass');
            if (studentClass) {
                studentClass.innerHTML = '<option value="">Selecione uma turma</option>';
                demoData.classes.forEach(cls => {
                    const option = document.createElement('option');
                    option.value = cls.id;
                    option.textContent = cls.name;
                    studentClass.appendChild(option);
                });
            }
        }

        function loadStudents() {
            const tbody = document.getElementById('studentsTableBody');
            tbody.innerHTML = '';

            let studentsToShow = demoData.students;

            // Apply filters
            const statusFilter = document.getElementById('studentStatusFilter').value;
            const courseFilter = document.getElementById('studentCourseFilter').value;
            const classFilter = document.getElementById('studentClassFilter').value;

            if (statusFilter) {
                studentsToShow = studentsToShow.filter(s => s.status === statusFilter);
            }

            if (courseFilter) {
                studentsToShow = studentsToShow.filter(s => s.course === courseFilter);
            }

            if (classFilter) {
                studentsToShow = studentsToShow.filter(s => s.classId == classFilter);
            }

            studentsToShow.forEach(student => {
                const course = demoData.courses.find(c => c.code === student.course);
                const studentClass = student.classId ? demoData.classes.find(c => c.id === student.classId) : null;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.ra}</td>
                    <td>${student.name}</td>
                    <td>${course ? course.name : student.course}</td>
                    <td>${studentClass ? studentClass.name : 'N√£o matriculado'}</td>
                    <td><span class="badge ${getStatusBadgeClass(student.status)}">${student.status}</span></td>
                    <td>${formatCurrency(student.tuition)}</td>
                    <td>
                        <button class="btn btn-info" onclick="viewStudentFinancialDetails(${student.id})" style="font-size: 12px; padding: 8px 12px;">üí∞ Financeiro</button>
                        <button class="btn btn-purple" onclick="viewStudentProgress(${student.id})" style="font-size: 12px; padding: 8px 12px;">üìà Progresso</button>
                        <button class="btn btn-warning" onclick="editStudent(${student.id})" style="font-size: 12px; padding: 8px 12px;">‚úèÔ∏è Editar</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function filterStudents() {
            loadStudents();
        }

        function openStudentModal() {
            currentEditingId = null;
            currentEditingType = 'student';
            document.getElementById('studentModalTitle').textContent = 'Novo Aluno';
            document.getElementById('studentForm').reset();
            populateClassFilters(); // Populate class options
            openModal('studentModal');
        }

        function editStudent(id) {
            const student = demoData.students.find(s => s.id === id);
            if (!student) return;

            currentEditingId = id;
            currentEditingType = 'student';
            
            populateClassFilters(); // Populate class options first
            
            document.getElementById('studentModalTitle').textContent = 'Editar Aluno';
            document.getElementById('studentRA').value = student.ra;
            document.getElementById('studentName').value = student.name;
            document.getElementById('studentEmail').value = student.email;
            document.getElementById('studentPhone').value = student.phone;
            document.getElementById('studentCourse').value = student.course;
            document.getElementById('studentClass').value = student.classId || '';
            document.getElementById('studentTuition').value = student.tuition;
            document.getElementById('studentEnrollmentDate').value = student.enrollmentDate;
            document.getElementById('studentStartDate').value = student.startDate;
            document.getElementById('studentDurationMonths').value = student.durationMonths;
            document.getElementById('studentStatus').value = student.status;
            
            openModal('studentModal');
        }

        // Pedagogic functions
        function loadPedagogic() {
            loadClasses();
        }

        function loadClasses() {
            const grid = document.getElementById('classesGrid');
            grid.innerHTML = '';

            demoData.classes.forEach(cls => {
                const course = demoData.courses.find(c => c.code === cls.course);
                const studentsInClass = demoData.students.filter(s => s.classId === cls.id);
                const activeStudents = studentsInClass.filter(s => s.status === 'ativo');
                
                const classCard = document.createElement('div');
                classCard.className = 'class-card';
                classCard.onclick = () => viewClassDetails(cls.id);
                
                classCard.innerHTML = `
                    <h3>${cls.name}</h3>
                    <p><strong>Curso:</strong> ${course ? course.name : cls.course}</p>
                    <p><strong>Instrutor:</strong> ${cls.instructor}</p>
                    <p><strong>Hor√°rio:</strong> ${cls.schedule}</p>
                    <p><strong>Per√≠odo:</strong> ${formatDate(cls.startDate)} - ${formatDate(cls.endDate)}</p>
                    
                    <div class="class-stats">
                        <div class="class-stat">
                            <strong>${studentsInClass.length}</strong>
                            <div>Total Alunos</div>
                        </div>
                        <div class="class-stat">
                            <strong>${activeStudents.length}</strong>
                            <div>Alunos Ativos</div>
                        </div>
                    </div>
                `;
                
                grid.appendChild(classCard);
            });
        }

        function openClassModal() {
            currentEditingId = null;
            currentEditingType = 'class';
            document.getElementById('classModalTitle').textContent = 'Nova Turma';
            document.getElementById('classForm').reset();
            openModal('classModal');
        }

        function viewClassDetails(classId) {
            const cls = demoData.classes.find(c => c.id === classId);
            const course = demoData.courses.find(c => c.code === cls.course);
            const studentsInClass = demoData.students.filter(s => s.classId === classId);

            document.getElementById('classDetailsTitle').textContent = `Detalhes - ${cls.name}`;
            document.getElementById('classDetailsContent').innerHTML = `
                <div class="student-financial-summary">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div>
                            <h4>Informa√ß√µes da Turma</h4>
                            <p><strong>Nome:</strong> ${cls.name}</p>
                            <p><strong>Curso:</strong> ${course ? course.name : cls.course}</p>
                            <p><strong>Instrutor:</strong> ${cls.instructor}</p>
                            <p><strong>Hor√°rio:</strong> ${cls.schedule}</p>
                            <p><strong>Per√≠odo:</strong> ${formatDate(cls.startDate)} - ${formatDate(cls.endDate)}</p>
                        </div>
                        <div>
                            <h4>Estat√≠sticas</h4>
                            <p><strong>Total de Alunos:</strong> ${studentsInClass.length}</p>
                            <p><strong>Alunos Ativos:</strong> ${studentsInClass.filter(s => s.status === 'ativo').length}</p>
                            <p><strong>Alunos Inadimplentes:</strong> ${studentsInClass.filter(s => s.status === 'inadimplente').length}</p>
                            <p><strong>Descri√ß√£o:</strong> ${cls.description || 'N√£o informado'}</p>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <button class="btn btn-warning" onclick="editClass(${classId})">‚úèÔ∏è Editar Turma</button>
                    <button class="btn btn-danger" onclick="deleteClass(${classId})">üóëÔ∏è Excluir Turma</button>
                </div>

                <h4 style="margin-bottom: 20px;">üë• Alunos da Turma</h4>
                <div style="max-height: 400px; overflow-y: auto;">
                    ${studentsInClass.map(student => `
                        <div class="financial-detail-card">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h5>${student.name} (${student.ra})</h5>
                                    <p><strong>Status:</strong> <span class="badge ${getStatusBadgeClass(student.status)}">${student.status}</span></p>
                                    <p><strong>Email:</strong> ${student.email}</p>
                                    <p><strong>Telefone:</strong> ${student.phone}</p>
                                </div>
                                <div style="text-align: right;">
                                    <p><strong>Mensalidade:</strong> ${formatCurrency(student.tuition)}</p>
                                    <div style="display: flex; gap: 5px; margin-top: 10px; flex-wrap: wrap;">
                                        <button class="btn btn-info" onclick="viewStudentProgress(${student.id})" style="font-size: 12px; padding: 6px 12px;">üìà Progresso</button>
                                        <button class="btn btn-warning" onclick="editStudent(${student.id})" style="font-size: 12px; padding: 6px 12px;">‚úèÔ∏è Editar</button>
                                        <button class="btn btn-purple" onclick="transferStudent(${student.id})" style="font-size: 12px; padding: 6px 12px;">üîÑ Transferir</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            openModal('classDetailsModal');
        }

        function editClass(classId) {
            const cls = demoData.classes.find(c => c.id === classId);
            if (!cls) return;

            currentEditingId = classId;
            currentEditingType = 'class';
            
            document.getElementById('classModalTitle').textContent = 'Editar Turma';
            document.getElementById('className').value = cls.name;
            document.getElementById('classCourse').value = cls.course;
            document.getElementById('classInstructor').value = cls.instructor;
            document.getElementById('classSchedule').value = cls.schedule;
            document.getElementById('classStartDate').value = cls.startDate;
            document.getElementById('classEndDate').value = cls.endDate;
            document.getElementById('classDescription').value = cls.description || '';
            
            closeModal('classDetailsModal');
            openModal('classModal');
        }

        function deleteClass(classId) {
            const studentsInClass = demoData.students.filter(s => s.classId === classId);
            
            if (studentsInClass.length > 0) {
                showMessage('N√£o √© poss√≠vel excluir uma turma com alunos matriculados!', 'error');
                return;
            }

            if (confirm('Tem certeza que deseja excluir esta turma?')) {
                const index = demoData.classes.findIndex(c => c.id === classId);
                if (index > -1) {
                    demoData.classes.splice(index, 1);
                    showMessage('Turma exclu√≠da com sucesso!', 'success');
                    closeModal('classDetailsModal');
                    loadClasses();
                    loadDashboard();
                }
            }
        }

        function transferStudent(studentId) {
            const student = demoData.students.find(s => s.id === studentId);
            const currentClass = demoData.classes.find(c => c.id === student.classId);
            
            document.getElementById('transferStudentName').textContent = student.name;
            document.getElementById('transferCurrentClass').textContent = currentClass ? currentClass.name : 'N√£o matriculado';
            
            // Populate available classes (excluding current class)
            const transferNewClass = document.getElementById('transferNewClass');
            transferNewClass.innerHTML = '<option value="">Selecione uma turma</option>';
            demoData.classes.filter(c => c.id !== student.classId).forEach(cls => {
                const option = document.createElement('option');
                option.value = cls.id;
                option.textContent = cls.name;
                transferNewClass.appendChild(option);
            });

            // Store current student ID for transfer
            currentEditingId = studentId;
            currentEditingType = 'transfer';
            
            openModal('transferModal');
        }

        function loadAttendanceTab() {
            populateClassFilters();
            // Set today's date as default
            document.getElementById('attendanceDate').value = new Date().toISOString().split('T')[0];
        }

        function loadAttendance() {
            const classId = document.getElementById('attendanceClassFilter').value;
            const date = document.getElementById('attendanceDate').value;
            
            if (!classId || !date) {
                document.getElementById('attendanceContent').innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Selecione uma turma e data para fazer a chamada</p>';
                return;
            }

            const selectedClass = demoData.classes.find(c => c.id == classId);
            const studentsInClass = demoData.students.filter(s => s.classId == classId && s.status === 'ativo');
            
            let content = `
                <div class="card">
                    <h4>üìã Chamada - ${selectedClass.name}</h4>
                    <p><strong>Data:</strong> ${formatDate(date)}</p>
                    <p><strong>Alunos Ativos:</strong> ${studentsInClass.length}</p>
                </div>
                
                <div style="display: grid; gap: 15px; margin-top: 20px;">
            `;

            studentsInClass.forEach(student => {
                const attendance = demoData.attendance.find(a => 
                    a.classId == classId && a.studentId === student.id && a.date === date
                );
                
                const currentStatus = attendance ? attendance.status : 'pending';
                
                content += `
                    <div class="financial-detail-card">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h5>${student.name} (${student.ra})</h5>
                                <p>${student.email}</p>
                            </div>
                            <div class="attendance-grid">
                                <button class="attendance-btn ${currentStatus === 'present' ? 'present' : ''}" 
                                        onclick="markAttendance(${classId}, ${student.id}, '${date}', 'present')">
                                    ‚úÖ Presente
                                </button>
                                <button class="attendance-btn ${currentStatus === 'absent' ? 'absent' : ''}"
                                        onclick="markAttendance(${classId}, ${student.id}, '${date}', 'absent')">
                                    ‚ùå Falta
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });

            content += '</div>';
            document.getElementById('attendanceContent').innerHTML = content;
        }

        function markAttendance(classId, studentId, date, status) {
            // Find existing attendance record
            const existingIndex = demoData.attendance.findIndex(a => 
                a.classId == classId && a.studentId === studentId && a.date === date
            );

            if (existingIndex > -1) {
                // Update existing record
                demoData.attendance[existingIndex].status = status;
            } else {
                // Create new record
                const newId = Math.max(...demoData.attendance.map(a => a.id), 0) + 1;
                demoData.attendance.push({
                    id: newId,
                    classId: parseInt(classId),
                    studentId: studentId,
                    date: date,
                    status: status
                });
            }

            // Refresh attendance view
            loadAttendance();
            showMessage(`Presen√ßa marcada como ${status === 'present' ? 'presente' : 'falta'}!`, 'success');
        }

        function saveAttendance() {
            showMessage('Chamada salva com sucesso!', 'success');
            loadDashboard(); // Update dashboard stats
        }

        function loadProgressTab() {
            populateStudentFilters();
        }

        function loadStudentProgress() {
            const studentId = document.getElementById('progressStudentFilter').value;
            
            if (!studentId) {
                document.getElementById('progressContent').innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Selecione um aluno para ver seu progresso</p>';
                return;
            }

            const student = demoData.students.find(s => s.id == studentId);
            const course = demoData.courses.find(c => c.code === student.course);
            const studentClass = student.classId ? demoData.classes.find(c => c.id === student.classId) : null;
            
            if (!course) {
                document.getElementById('progressContent').innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Curso n√£o encontrado</p>';
                return;
            }

            let content = `
                <div class="student-financial-summary">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div>
                            <h4>Informa√ß√µes do Aluno</h4>
                            <p><strong>Nome:</strong> ${student.name}</p>
                            <p><strong>RA:</strong> ${student.ra}</p>
                            <p><strong>Curso:</strong> ${course.name}</p>
                            <p><strong>Turma:</strong> ${studentClass ? studentClass.name : 'N√£o matriculado'}</p>
                        </div>
                        <div>
                            <h4>Progresso Geral</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${student.progress}%">${student.progress}%</div>
                            </div>
                            <p><strong>M√≥dulo Atual:</strong> ${student.currentModule} de ${course.modules.length}</p>
                            <p><strong>Data de In√≠cio:</strong> ${formatDate(student.startDate)}</p>
                            <p><strong>Previs√£o de T√©rmino:</strong> ${formatDate(student.endDate)}</p>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="advanceStudentProgress(${student.id})">‚è≠Ô∏è Avan√ßar Progresso</button>
                        <button class="btn btn-warning" onclick="updateStudentProgress(${student.id})">‚úèÔ∏è Editar Progresso</button>
                    </div>
                </div>
            `;

            course.modules.forEach((module, index) => {
                const moduleIndex = index + 1;
                let moduleStatus = '';
                let moduleClass = '';
                
                if (moduleIndex < student.currentModule) {
                    moduleStatus = 'Conclu√≠do';
                    moduleClass = 'completed';
                } else if (moduleIndex === student.currentModule) {
                    moduleStatus = 'Em Andamento';
                    moduleClass = 'current';
                } else {
                    moduleStatus = 'Pendente';
                    moduleClass = '';
                }

                content += `
                    <div class="module-card ${moduleClass}">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h5>M√≥dulo ${moduleIndex}: ${module.name}</h5>
                                <p><span class="badge ${moduleClass === 'completed' ? 'success' : moduleClass === 'current' ? 'warning' : 'secondary'}">${moduleStatus}</span></p>
                            </div>
                            <div>
                                ${moduleIndex === student.currentModule ? `<p><strong>Aula:</strong> ${student.currentLesson} de ${module.lessons.length}</p>` : ''}
                            </div>
                        </div>
                        <div class="lesson-list">
                            ${module.lessons.map((lesson, lessonIndex) => {
                                const lessonNumber = lessonIndex + 1;
                                let lessonStatus = '';
                                let lessonClass = '';
                                
                                if (moduleIndex < student.currentModule || 
                                    (moduleIndex === student.currentModule && lessonNumber <= student.currentLesson)) {
                                    lessonStatus = '‚úÖ Conclu√≠da';
                                    lessonClass = 'completed';
                                } else if (moduleIndex === student.currentModule && lessonNumber === student.currentLesson + 1) {
                                    lessonStatus = '‚ñ∂Ô∏è Pr√≥xima';
                                    lessonClass = 'current';
                                } else {
                                    lessonStatus = '‚è≥ Pendente';
                                    lessonClass = 'pending';
                                }
                                
                                return `
                                    <div class="lesson-item">
                                        <span>Aula ${lessonNumber}: ${lesson}</span>
                                        <span class="badge ${lessonClass === 'completed' ? 'success' : lessonClass === 'current' ? 'warning' : 'secondary'}">${lessonStatus}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            });

            document.getElementById('progressContent').innerHTML = content;
        }

        function advanceStudentProgress(studentId) {
            const student = demoData.students.find(s => s.id === studentId);
            const course = demoData.courses.find(c => c.code === student.course);
            
            if (!student || !course) return;

            const currentModule = course.modules[student.currentModule - 1];
            if (!currentModule) return;

            // Check if we can advance
            if (student.currentLesson < currentModule.lessons.length) {
                // Advance to next lesson
                student.currentLesson++;
            } else if (student.currentModule < course.modules.length) {
                // Advance to next module
                student.currentModule++;
                student.currentLesson = 1;
            } else {
                showMessage('Aluno j√° completou todo o curso!', 'info');
                return;
            }

            // Update progress percentage
            const totalLessons = course.modules.reduce((sum, mod) => sum + mod.lessons.length, 0);
            const completedLessons = course.modules.slice(0, student.currentModule - 1).reduce((sum, mod) => sum + mod.lessons.length, 0) + student.currentLesson;
            student.progress = Math.round((completedLessons / totalLessons) * 100);

            showMessage('Progresso do aluno avan√ßado!', 'success');
            loadStudentProgress();
        }

        function updateStudentProgress(studentId) {
            const student = demoData.students.find(s => s.id === studentId);
            const course = demoData.courses.find(c => c.code === student.course);
            
            if (!student || !course) return;

            const newModule = prompt(`M√≥dulo atual (1-${course.modules.length}):`, student.currentModule);
            if (newModule && !isNaN(newModule)) {
                const moduleNum = parseInt(newModule);
                if (moduleNum >= 1 && moduleNum <= course.modules.length) {
                    const newLesson = prompt(`Aula atual (1-${course.modules[moduleNum - 1].lessons.length}):`, student.currentLesson);
                    if (newLesson && !isNaN(newLesson)) {
                        const lessonNum = parseInt(newLesson);
                        if (lessonNum >= 1 && lessonNum <= course.modules[moduleNum - 1].lessons.length) {
                            student.currentModule = moduleNum;
                            student.currentLesson = lessonNum;
                            
                            // Update progress percentage
                            const totalLessons = course.modules.reduce((sum, mod) => sum + mod.lessons.length, 0);
                            const completedLessons = course.modules.slice(0, student.currentModule - 1).reduce((sum, mod) => sum + mod.lessons.length, 0) + student.currentLesson;
                            student.progress = Math.round((completedLessons / totalLessons) * 100);
                            
                            showMessage('Progresso atualizado com sucesso!', 'success');
                            loadStudentProgress();
                        }
                    }
                }
            }
        }

        function loadPedagogicReportsTab() {
            // Initialize with empty content
            document.getElementById('reportsContent').innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Selecione um tipo de relat√≥rio para visualizar</p>';
        }

        function generatePedagogicReport() {
            const reportType = document.getElementById('reportType').value;
            const reportPeriod = document.getElementById('reportPeriod').value;
            
            if (!reportType) {
                document.getElementById('reportsContent').innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Selecione um tipo de relat√≥rio para visualizar</p>';
                return;
            }

            let content = '';
            
            switch (reportType) {
                case 'daily':
                    content = generateDailyAttendanceReport();
                    break;
                case 'monthly':
                    content = generateMonthlyAttendanceReport(reportPeriod);
                    break;
                case 'student':
                    content = generateStudentAttendanceReport(reportPeriod);
                    break;
                case 'class':
                    content = generateClassAttendanceReport(reportPeriod);
                    break;
                default:
                    content = '<p style="text-align: center; color: #666; padding: 40px;">Tipo de relat√≥rio n√£o implementado</p>';
            }
            
            document.getElementById('reportsContent').innerHTML = content;
        }

        function generateDailyAttendanceReport() {
            const today = new Date().toISOString().split('T')[0];
            const todayAttendance = demoData.attendance.filter(a => a.date === today);
            
            let content = `
                <div class="card">
                    <h4>üìÖ Relat√≥rio de Frequ√™ncia Di√°ria - ${formatDate(today)}</h4>
                    <div class="stats-grid" style="margin-top: 20px;">
                        <div class="stat-card success">
                            <div class="stat-number">${todayAttendance.filter(a => a.status === 'present').length}</div>
                            <div class="stat-label">Presen√ßas</div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-number">${todayAttendance.filter(a => a.status === 'absent').length}</div>
                            <div class="stat-label">Faltas</div>
                        </div>
                        <div class="stat-card info">
                            <div class="stat-number">${todayAttendance.length > 0 ? Math.round((todayAttendance.filter(a => a.status === 'present').length / todayAttendance.length) * 100) : 0}%</div>
                            <div class="stat-label">Taxa de Presen√ßa</div>
                        </div>
                    </div>
                </div>
            `;

            // Group by class
            const attendanceByClass = {};
            todayAttendance.forEach(att => {
                if (!attendanceByClass[att.classId]) {
                    attendanceByClass[att.classId] = [];
                }
                attendanceByClass[att.classId].push(att);
            });

            Object.keys(attendanceByClass).forEach(classId => {
                const classData = demoData.classes.find(c => c.id == classId);
                const classAttendance = attendanceByClass[classId];
                const presentCount = classAttendance.filter(a => a.status === 'present').length;
                
                content += `
                    <div class="financial-detail-card">
                        <h5>${classData.name}</h5>
                        <p><strong>Presen√ßas:</strong> ${presentCount} / ${classAttendance.length}</p>
                        <p><strong>Taxa:</strong> ${Math.round((presentCount / classAttendance.length) * 100)}%</p>
                        
                        <div style="margin-top: 15px;">
                            ${classAttendance.map(att => {
                                const student = demoData.students.find(s => s.id === att.studentId);
                                return `
                                    <div class="lesson-item">
                                        <span>${student.name}</span>
                                        <span class="badge ${att.status === 'present' ? 'success' : 'danger'}">${att.status === 'present' ? 'Presente' : 'Falta'}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            });

            return content;
        }

        function generateMonthlyAttendanceReport(period) {
            const currentDate = new Date();
            let startDate, endDate;
            
            if (period === 'current') {
                startDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
                endDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            } else if (period === 'last') {
                startDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);
                endDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0);
            }

            const monthAttendance = demoData.attendance.filter(a => {
                const attDate = new Date(a.date);
                return attDate >= startDate && attDate <= endDate;
            });

            let content = `
                <div class="card">
                    <h4>üìÖ Relat√≥rio de Frequ√™ncia Mensal</h4>
                    <p><strong>Per√≠odo:</strong> ${formatDate(startDate.toISOString().split('T')[0])} - ${formatDate(endDate.toISOString().split('T')[0])}</p>
                    
                    <div class="stats-grid" style="margin-top: 20px;">
                        <div class="stat-card success">
                            <div class="stat-number">${monthAttendance.filter(a => a.status === 'present').length}</div>
                            <div class="stat-label">Total de Presen√ßas</div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-number">${monthAttendance.filter(a => a.status === 'absent').length}</div>
                            <div class="stat-label">Total de Faltas</div>
                        </div>
                        <div class="stat-card info">
                            <div class="stat-number">${monthAttendance.length > 0 ? Math.round((monthAttendance.filter(a => a.status === 'present').length / monthAttendance.length) * 100) : 0}%</div>
                            <div class="stat-label">Taxa Geral</div>
                        </div>
                    </div>
                </div>
            `;

            // Daily breakdown
            const dailyStats = {};
            monthAttendance.forEach(att => {
                if (!dailyStats[att.date]) {
                    dailyStats[att.date] = { present: 0, absent: 0 };
                }
                dailyStats[att.date][att.status]++;
            });

            content += '<h5 style="margin-top: 20px;">üìä Frequ√™ncia por Dia</h5>';
            Object.keys(dailyStats).sort().forEach(date => {
                const dayStats = dailyStats[date];
                const total = dayStats.present + dayStats.absent;
                const rate = Math.round((dayStats.present / total) * 100);
                
                content += `
                    <div class="financial-detail-card">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h6>${formatDate(date)}</h6>
                                <p>Presen√ßas: ${dayStats.present} | Faltas: ${dayStats.absent}</p>
                            </div>
                            <div>
                                <span class="badge ${rate >= 80 ? 'success' : rate >= 60 ? 'warning' : 'danger'}">${rate}%</span>
                            </div>
                        </div>
                    </div>
                `;
            });

            return content;
        }

        function generateStudentAttendanceReport(period) {
            let content = `
                <div class="card">
                    <h4>üë®‚Äçüéì Relat√≥rio de Frequ√™ncia por Aluno</h4>
                </div>
            `;

            demoData.students.forEach(student => {
                const studentAttendance = demoData.attendance.filter(a => a.studentId === student.id);
                const presentCount = studentAttendance.filter(a => a.status === 'present').length;
                const absentCount = studentAttendance.filter(a => a.status === 'absent').length;
                const attendanceRate = studentAttendance.length > 0 ? Math.round((presentCount / studentAttendance.length) * 100) : 0;

                content += `
                    <div class="financial-detail-card">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h5>${student.name} (${student.ra})</h5>
                                <p><strong>Presen√ßas:</strong> ${presentCount} | <strong>Faltas:</strong> ${absentCount}</p>
                                <p><strong>Total de Aulas:</strong> ${studentAttendance.length}</p>
                            </div>
                            <div style="text-align: right;">
                                <div class="progress-bar" style="width: 150px;">
                                    <div class="progress-fill" style="width: ${attendanceRate}%; font-size: 10px;">${attendanceRate}%</div>
                                </div>
                                <span class="badge ${attendanceRate >= 80 ? 'success' : attendanceRate >= 60 ? 'warning' : 'danger'}">
                                    ${attendanceRate >= 80 ? 'Excelente' : attendanceRate >= 60 ? 'Regular' : 'Baixa'}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            });

            return content;
        }

        function generateClassAttendanceReport(period) {
            let content = `
                <div class="card">
                    <h4>üè´ Relat√≥rio de Frequ√™ncia por Turma</h4>
                </div>
            `;

            demoData.classes.forEach(cls => {
                const classAttendance = demoData.attendance.filter(a => a.classId === cls.id);
                const presentCount = classAttendance.filter(a => a.status === 'present').length;
                const absentCount = classAttendance.filter(a => a.status === 'absent').length;
                const attendanceRate = classAttendance.length > 0 ? Math.round((presentCount / classAttendance.length) * 100) : 0;
                const studentsInClass = demoData.students.filter(s => s.classId === cls.id && s.status === 'ativo');

                content += `
                    <div class="financial-detail-card">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h5>${cls.name}</h5>
                                <p><strong>Instrutor:</strong> ${cls.instructor}</p>
                                <p><strong>Alunos Ativos:</strong> ${studentsInClass.length}</p>
                                <p><strong>Total de Presen√ßas:</strong> ${presentCount} | <strong>Faltas:</strong> ${absentCount}</p>
                            </div>
                            <div style="text-align: right;">
                                <div class="progress-bar" style="width: 150px;">
                                    <div class="progress-fill" style="width: ${attendanceRate}%; font-size: 10px;">${attendanceRate}%</div>
                                </div>
                                <span class="badge ${attendanceRate >= 80 ? 'success' : attendanceRate >= 60 ? 'warning' : 'danger'}">
                                    Taxa: ${attendanceRate}%
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            });

            return content;
        }

        function viewStudentFinancialDetails(studentId) {
            const student = demoData.students.find(s => s.id === studentId);
            if (!student) return;

            const studentTransactions = demoData.transactions.filter(t => t.studentId === studentId);
            const course = demoData.courses.find(c => c.code === student.course);

            // Generate expected payments based on course duration
            const expectedPayments = [];
            const startDate = new Date(student.startDate);
            
            for (let i = 0; i < student.durationMonths; i++) {
                const dueDate = new Date(startDate);
                dueDate.setMonth(dueDate.getMonth() + i);
                
                const monthKey = `${dueDate.getFullYear()}-${String(dueDate.getMonth() + 1).padStart(2, '0')}`;
                const payment = studentTransactions.find(t => t.date.startsWith(monthKey));
                const currentDate = new Date();
                
                expectedPayments.push({
                    month: dueDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' }),
                    dueDate: dueDate,
                    value: student.tuition,
                    status: payment ? payment.status : (dueDate < currentDate ? 'atrasado' : 'pendente'),
                    transaction: payment
                });
            }

            const totalPaid = studentTransactions.filter(t => t.status === 'pago').reduce((sum, t) => sum + t.value, 0);
            const totalPending = expectedPayments.filter(p => p.status !== 'pago').reduce((sum, p) => sum + p.value, 0);
            const totalOverdue = expectedPayments.filter(p => p.status === 'atrasado').reduce((sum, p) => sum + p.value, 0);

            document.getElementById('studentFinancialTitle').textContent = `üí∞ Situa√ß√£o Financeira - ${student.name}`;
            document.getElementById('studentFinancialContent').innerHTML = `
                <div class="student-financial-summary">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div>
                            <h4>Informa√ß√µes do Aluno</h4>
                            <p><strong>Nome:</strong> ${student.name}</p>
                            <p><strong>RA:</strong> ${student.ra}</p>
                            <p><strong>Curso:</strong> ${course ? course.name : student.course}</p>
                            <p><strong>Status:</strong> <span class="badge ${getStatusBadgeClass(student.status)}">${student.status}</span></p>
                            <p><strong>Mensalidade:</strong> ${formatCurrency(student.tuition)}</p>
                        </div>
                        <div>
                            <h4>Resumo Financeiro</h4>
                            <p><strong>Total Pago:</strong> <span style="color: var(--success); font-weight: bold;">${formatCurrency(totalPaid)}</span></p>
                            <p><strong>Total Pendente:</strong> <span style="color: var(--warning); font-weight: bold;">${formatCurrency(totalPending)}</span></p>
                            <p><strong>Total Atrasado:</strong> <span style="color: var(--danger); font-weight: bold;">${formatCurrency(totalOverdue)}</span></p>
                            <p><strong>Valor Total do Curso:</strong> ${formatCurrency(student.tuition * student.durationMonths)}</p>
                        </div>
                    </div>
                </div>

                <h4 style="margin-bottom: 20px;">üìÖ Hist√≥rico de Mensalidades</h4>
                <div style="max-height: 400px; overflow-y: auto;">
                    ${expectedPayments.map(payment => `
                        <div class="financial-detail-card ${payment.status}">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h5 style="margin-bottom: 8px;">${payment.month}</h5>
                                    <p><strong>Vencimento:</strong> ${formatDate(payment.dueDate.toISOString().split('T')[0])}</p>
                                    <p><strong>Status:</strong> <span class="badge ${getStatusBadgeClass(payment.status)}">${payment.status}</span></p>
                                </div>
                                <div style="text-align: right;">
                                    <p style="font-size: 18px; font-weight: bold;">${formatCurrency(payment.value)}</p>
                                    ${payment.transaction && payment.transaction.status === 'pago' ? 
                                        `<p style="font-size: 12px; color: #666;">Pago em ${formatDate(payment.transaction.date)}</p>` : ''}
                                    ${payment.status !== 'pago' ? 
                                        `<button class="btn btn-success" onclick="markPaymentAsPaid(${studentId}, '${payment.dueDate.toISOString().split('T')[0].slice(0, 7)}')" style="font-size: 12px; padding: 6px 12px; margin-top: 8px;">‚úÖ Marcar como Pago</button>` : ''}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            openModal('studentFinancialModal');
        }

        function markPaymentAsPaid(studentId, monthKey) {
            const student = demoData.students.find(s => s.id === studentId);
            if (!student) return;

            const newTransaction = {
                id: Math.max(...demoData.transactions.map(t => t.id), 0) + 1,
                date: `${monthKey}-05`,
                type: 'receita',
                description: `Mensalidade ${student.name} - ${monthKey}`,
                value: student.tuition,
                status: 'pago',
                studentId: studentId
            };

            demoData.transactions.push(newTransaction);
            
            // Refresh the modal
            viewStudentFinancialDetails(studentId);
            
            // Update other views
            loadFinancialReports();
            loadDashboard();
            
            showMessage('Pagamento registrado com sucesso!', 'success');
        }

        // Form submissions
        document.getElementById('studentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const studentData = {
                ra: document.getElementById('studentRA').value,
                name: document.getElementById('studentName').value,
                email: document.getElementById('studentEmail').value,
                phone: document.getElementById('studentPhone').value,
                course: document.getElementById('studentCourse').value,
                classId: document.getElementById('studentClass').value ? parseInt(document.getElementById('studentClass').value) : null,
                tuition: parseFloat(document.getElementById('studentTuition').value),
                enrollmentDate: document.getElementById('studentEnrollmentDate').value,
                startDate: document.getElementById('studentStartDate').value,
                durationMonths: parseInt(document.getElementById('studentDurationMonths').value),
                status: document.getElementById('studentStatus').value,
                progress: 0,
                currentModule: 1,
                currentLesson: 1
            };

            // Calculate end date
            const startDate = new Date(studentData.startDate);
            const endDate = new Date(startDate);
            endDate.setMonth(endDate.getMonth() + studentData.durationMonths);
            studentData.endDate = endDate.toISOString().split('T')[0];

            if (currentEditingId) {
                const index = demoData.students.findIndex(s => s.id === currentEditingId);
                if (index > -1) {
                    demoData.students[index] = { ...demoData.students[index], ...studentData };
                    showMessage('Aluno atualizado com sucesso!', 'success');
                }
            } else {
                const newId = Math.max(...demoData.students.map(s => s.id), 0) + 1;
                demoData.students.push({ id: newId, ...studentData });
                showMessage('Aluno cadastrado com sucesso!', 'success');
            }

            closeModal('studentModal');
            loadStudents();
            loadDashboard();
            populateStudentFilters();
        });

        document.getElementById('classForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const classData = {
                name: document.getElementById('className').value,
                course: document.getElementById('classCourse').value,
                instructor: document.getElementById('classInstructor').value,
                schedule: document.getElementById('classSchedule').value,
                startDate: document.getElementById('classStartDate').value,
                endDate: document.getElementById('classEndDate').value,
                description: document.getElementById('classDescription').value
            };

            if (currentEditingId) {
                const index = demoData.classes.findIndex(c => c.id === currentEditingId);
                if (index > -1) {
                    demoData.classes[index] = { ...demoData.classes[index], ...classData };
                    showMessage('Turma atualizada com sucesso!', 'success');
                }
            } else {
                const newId = Math.max(...demoData.classes.map(c => c.id), 0) + 1;
                demoData.classes.push({ id: newId, ...classData });
                showMessage('Turma cadastrada com sucesso!', 'success');
            }

            closeModal('classModal');
            loadClasses();
            loadDashboard();
            populateClassFilters();
        });

        document.getElementById('transferForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newClassId = parseInt(document.getElementById('transferNewClass').value);
            const reason = document.getElementById('transferReason').value;
            
            if (currentEditingId && newClassId) {
                const studentIndex = demoData.students.findIndex(s => s.id === currentEditingId);
                if (studentIndex > -1) {
                    const oldClassId = demoData.students[studentIndex].classId;
                    demoData.students[studentIndex].classId = newClassId;
                    
                    // Log the transfer (could be stored in a transfers table)
                    showMessage('Aluno transferido com sucesso!', 'success');
                    
                    closeModal('transferModal');
                    closeModal('classDetailsModal');
                    loadClasses();
                    loadStudents();
                }
            }
        });

        // Financial management
        function loadFinancial() {
            loadFinancialReports();
        }

        function loadFinancialReports() {
            const currentDate = new Date();
            const currentMonth = currentDate.toISOString().slice(0, 7);

            // Calculate financial metrics based on filters
            const studentFilter = document.getElementById('reportStudentFilter')?.value;
            const statusFilter = document.getElementById('reportStatusFilter')?.value;
            const periodFilter = document.getElementById('reportPeriodFilter')?.value || 'current';

            let filteredStudents = demoData.students;
            let filteredTransactions = demoData.transactions;

            // Apply student filter
            if (studentFilter) {
                filteredStudents = filteredStudents.filter(s => s.id == studentFilter);
                filteredTransactions = filteredTransactions.filter(t => t.studentId == studentFilter);
            }

            // Apply status filter
            if (statusFilter) {
                filteredStudents = filteredStudents.filter(s => s.status === statusFilter);
                filteredTransactions = filteredTransactions.filter(t => {
                    const student = demoData.students.find(s => s.id === t.studentId);
                    return student && student.status === statusFilter;
                });
            }

            // Apply period filter
            let dateFilter = () => true;
            if (periodFilter === 'current') {
                dateFilter = (date) => date.startsWith(currentMonth);
            } else if (periodFilter === 'last3') {
                const threeMonthsAgo = new Date();
                threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);
                dateFilter = (date) => new Date(date) >= threeMonthsAgo;
            } else if (periodFilter === 'last6') {
                const sixMonthsAgo = new Date();
                sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
                dateFilter = (date) => new Date(date) >= sixMonthsAgo;
            }

            const periodTransactions = filteredTransactions.filter(t => dateFilter(t.date));

            const totalRevenue = periodTransactions
                .filter(t => t.type === 'receita' && t.status === 'pago')
                .reduce((sum, t) => sum + t.value, 0);

            const pendingCount = periodTransactions.filter(t => t.status === 'pendente').length;
            const overdueCount = filteredTransactions.filter(t => t.status === 'atrasado').length;
            const cancelledCount = filteredStudents.filter(s => s.status === 'cancelado').length;

            document.getElementById('monthlyRevenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('pendingPaymentsCount').textContent = pendingCount;
            document.getElementById('overduePaymentsCount').textContent = overdueCount;
            document.getElementById('cancelledCount').textContent = cancelledCount;
        }

        function filterReports() {
            loadFinancialReports();
        }

        function showDetailedReport(type) {
            const reportSection = document.getElementById('detailedReportSection');
            const reportTitle = document.getElementById('reportTitle');
            const reportContent = document.getElementById('reportContent');

            let title = '';
            let content = '';

            const studentFilter = document.getElementById('reportStudentFilter')?.value;
            const statusFilter = document.getElementById('reportStatusFilter')?.value;
            
            let filteredStudents = demoData.students;
            let filteredTransactions = demoData.transactions;

            // Apply filters
            if (studentFilter) {
                filteredStudents = filteredStudents.filter(s => s.id == studentFilter);
                filteredTransactions = filteredTransactions.filter(t => t.studentId == studentFilter);
            }
            if (statusFilter) {
                filteredStudents = filteredStudents.filter(s => s.status === statusFilter);
                filteredTransactions = filteredTransactions.filter(t => {
                    const student = demoData.students.find(s => s.id === t.studentId);
                    return student && student.status === statusFilter;
                });
            }

            switch (type) {
                case 'revenue':
                    title = 'üí∞ Detalhamento de Receitas';
                    const revenueTransactions = filteredTransactions.filter(t => t.type === 'receita' && t.status === 'pago');
                    content = `
                        <div style="max-height: 500px; overflow-y: auto;">
                            ${revenueTransactions.map(transaction => {
                                const student = demoData.students.find(s => s.id === transaction.studentId);
                                return `
                                    <div class="financial-detail-card paid">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <h5>${transaction.description}</h5>
                                                <p><strong>Aluno:</strong> ${student ? student.name : 'N/A'}</p>
                                                <p><strong>Data:</strong> ${formatDate(transaction.date)}</p>
                                            </div>
                                            <div style="text-align: right;">
                                                <p style="font-size: 18px; font-weight: bold; color: var(--success);">${formatCurrency(transaction.value)}</p>
                                                <span class="badge success">Pago</span>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: var(--light); border-radius: 8px;">
                            <h4>üìä Resumo de Receitas</h4>
                            <p><strong>Total de Transa√ß√µes:</strong> ${revenueTransactions.length}</p>
                            <p><strong>Valor Total:</strong> <span style="color: var(--success); font-weight: bold;">${formatCurrency(revenueTransactions.reduce((sum, t) => sum + t.value, 0))}</span></p>
                        </div>
                    `;
                    break;

                case 'pending':
                    title = '‚è∞ Pagamentos Pendentes';
                    const pendingTransactions = filteredTransactions.filter(t => t.status === 'pendente');
                    content = `
                        <div style="max-height: 500px; overflow-y: auto;">
                            ${pendingTransactions.map(transaction => {
                                const student = demoData.students.find(s => s.id === transaction.studentId);
                                return `
                                    <div class="financial-detail-card pending">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <h5>${transaction.description}</h5>
                                                <p><strong>Aluno:</strong> ${student ? student.name : 'N/A'} (${student ? student.ra : 'N/A'})</p>
                                                <p><strong>Status do Aluno:</strong> <span class="badge ${getStatusBadgeClass(student?.status)}">${student?.status || 'N/A'}</span></p>
                                                <p><strong>Data:</strong> ${formatDate(transaction.date)}</p>
                                            </div>
                                            <div style="text-align: right;">
                                                <p style="font-size: 18px; font-weight: bold; color: var(--warning);">${formatCurrency(transaction.value)}</p>
                                                <span class="badge warning">Pendente</span>
                                                <br>
                                                <button class="btn btn-success" onclick="markTransactionAsPaid(${transaction.id})" style="font-size: 12px; padding: 6px 12px; margin-top: 8px;">‚úÖ Marcar como Pago</button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: var(--light); border-radius: 8px;">
                            <h4>üìä Resumo de Pend√™ncias</h4>
                            <p><strong>Total de Transa√ß√µes Pendentes:</strong> ${pendingTransactions.length}</p>
                            <p><strong>Valor Total Pendente:</strong> <span style="color: var(--warning); font-weight: bold;">${formatCurrency(pendingTransactions.reduce((sum, t) => sum + t.value, 0))}</span></p>
                        </div>
                    `;
                    break;

                case 'overdue':
                    title = '‚ö†Ô∏è Pagamentos Atrasados';
                    const overdueTransactions = filteredTransactions.filter(t => t.status === 'atrasado');
                    content = `
                        <div style="max-height: 500px; overflow-y: auto;">
                            ${overdueTransactions.map(transaction => {
                                const student = demoData.students.find(s => s.id === transaction.studentId);
                                const daysOverdue = Math.ceil((new Date() - new Date(transaction.date)) / (1000 * 60 * 60 * 24));
                                return `
                                    <div class="financial-detail-card overdue">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <h5>${transaction.description}</h5>
                                                <p><strong>Aluno:</strong> ${student ? student.name : 'N/A'} (${student ? student.ra : 'N/A'})</p>
                                                <p><strong>Status do Aluno:</strong> <span class="badge ${getStatusBadgeClass(student?.status)}">${student?.status || 'N/A'}</span></p>
                                                <p><strong>Data de Vencimento:</strong> ${formatDate(transaction.date)}</p>
                                                <p><strong>Dias em Atraso:</strong> <span style="color: var(--danger); font-weight: bold;">${daysOverdue} dias</span></p>
                                            </div>
                                            <div style="text-align: right;">
                                                <p style="font-size: 18px; font-weight: bold; color: var(--danger);">${formatCurrency(transaction.value)}</p>
                                                <span class="badge danger">Atrasado</span>
                                                <br>
                                                <button class="btn btn-success" onclick="markTransactionAsPaid(${transaction.id})" style="font-size: 12px; padding: 6px 12px; margin-top: 8px;">‚úÖ Marcar como Pago</button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: var(--light); border-radius: 8px;">
                            <h4>üìä Resumo de Atrasos</h4>
                            <p><strong>Total de Transa√ß√µes Atrasadas:</strong> ${overdueTransactions.length}</p>
                            <p><strong>Valor Total Atrasado:</strong> <span style="color: var(--danger); font-weight: bold;">${formatCurrency(overdueTransactions.reduce((sum, t) => sum + t.value, 0))}</span></p>
                        </div>
                    `;
                    break;

                case 'cancelled':
                    title = '‚ùå Alunos Cancelados';
                    const cancelledStudents = filteredStudents.filter(s => s.status === 'cancelado');
                    content = `
                        <div style="max-height: 500px; overflow-y: auto;">
                            ${cancelledStudents.map(student => {
                                const course = demoData.courses.find(c => c.code === student.course);
                                const studentTransactions = demoData.transactions.filter(t => t.studentId === student.id);
                                const totalPaid = studentTransactions.filter(t => t.status === 'pago').reduce((sum, t) => sum + t.value, 0);
                                return `
                                    <div class="financial-detail-card">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <h5>${student.name} (${student.ra})</h5>
                                                <p><strong>Curso:</strong> ${course ? course.name : student.course}</p>
                                                <p><strong>Data de Matr√≠cula:</strong> ${formatDate(student.enrollmentDate)}</p>
                                                <p><strong>Data de In√≠cio:</strong> ${formatDate(student.startDate)}</p>
                                                <p><strong>Status:</strong> <span class="badge secondary">Cancelado</span></p>
                                            </div>
                                            <div style="text-align: right;">
                                                <p><strong>Valor Total Pago:</strong></p>
                                                <p style="font-size: 18px; font-weight: bold; color: var(--info);">${formatCurrency(totalPaid)}</p>
                                                <button class="btn btn-info" onclick="viewStudentFinancialDetails(${student.id})" style="font-size: 12px; padding: 6px 12px; margin-top: 8px;">üìä Ver Detalhes</button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: var(--light); border-radius: 8px;">
                            <h4>üìä Resumo de Cancelamentos</h4>
                            <p><strong>Total de Alunos Cancelados:</strong> ${cancelledStudents.length}</p>
                            <p><strong>Receita Perdida (estimada):</strong> <span style="color: var(--danger); font-weight: bold;">${formatCurrency(cancelledStudents.reduce((sum, s) => sum + (s.tuition * s.durationMonths), 0))}</span></p>
                        </div>
                    `;
                    break;
            }

            reportTitle.textContent = title;
            reportContent.innerHTML = content;
            reportSection.style.display = 'block';
        }

        function hideDetailedReport() {
            document.getElementById('detailedReportSection').style.display = 'none';
        }

        function markTransactionAsPaid(transactionId) {
            const transactionIndex = demoData.transactions.findIndex(t => t.id === transactionId);
            if (transactionIndex > -1) {
                demoData.transactions[transactionIndex].status = 'pago';
                
                // Refresh current view
                loadFinancialReports();
                
                // Refresh detailed report if it's open
                const reportSection = document.getElementById('detailedReportSection');
                if (reportSection.style.display !== 'none') {
                    // Get current report type from title
                    const title = document.getElementById('reportTitle').textContent;
                    if (title.includes('Pendentes')) {
                        showDetailedReport('pending');
                    } else if (title.includes('Atrasados')) {
                        showDetailedReport('overdue');
                    }
                }
                
                showMessage('Pagamento marcado como pago!', 'success');
            }
        }

        function loadTuitions() {
            const tbody = document.getElementById('tuitionsTableBody');
            tbody.innerHTML = '';

            demoData.students.forEach(student => {
                const course = demoData.courses.find(c => c.code === student.course);
                const startDate = new Date(student.startDate);
                
                // Generate tuitions for each month of the course
                for (let i = 0; i < student.durationMonths; i++) {
                    const dueDate = new Date(startDate);
                    dueDate.setMonth(dueDate.getMonth() + i);
                    
                    const monthKey = `${dueDate.getFullYear()}-${String(dueDate.getMonth() + 1).padStart(2, '0')}`;
                    const payment = demoData.transactions.find(t => 
                        t.studentId === student.id && 
                        t.date.startsWith(monthKey)
                    );
                    
                    const currentDate = new Date();
                    let status = 'pendente';
                    if (payment) {
                        status = payment.status;
                    } else if (dueDate < currentDate) {
                        status = 'atrasado';
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${student.name}</td>
                        <td>${course ? course.name : student.course}</td>
                        <td>${dueDate.toLocaleDateString('pt-BR')}</td>
                        <td>${formatCurrency(student.tuition)}</td>
                        <td><span class="badge ${getStatusBadgeClass(status)}">${status}</span></td>
                        <td>
                            ${status !== 'pago' ? `<button class="btn btn-success" onclick="markAsPaid(${student.id}, '${monthKey}')" style="font-size: 12px; padding: 8px 12px;">‚úÖ Marcar como Pago</button>` : ''}
                        </td>
                    `;
                    tbody.appendChild(row);
                }
            });
        }

        function filterTuitions() {
            const selectedMonth = document.getElementById('tuitionMonthFilter').value;
            const rows = document.querySelectorAll('#tuitionsTableBody tr');
            
            rows.forEach(row => {
                if (!selectedMonth) {
                    row.style.display = '';
                } else {
                    const dueDate = row.children[2].textContent;
                    const [day, month, year] = dueDate.split('/');
                    const rowMonth = `${year}-${month.padStart(2, '0')}`;
                    row.style.display = rowMonth === selectedMonth ? '' : 'none';
                }
            });
        }

        function markAsPaid(studentId, monthKey) {
            const student = demoData.students.find(s => s.id === studentId);
            if (!student) return;

            const newTransaction = {
                id: Math.max(...demoData.transactions.map(t => t.id), 0) + 1,
                date: `${monthKey}-05`,
                type: 'receita',
                description: `Mensalidade ${student.name} - ${monthKey}`,
                value: student.tuition,
                status: 'pago',
                studentId: studentId
            };

            demoData.transactions.push(newTransaction);
            loadTuitions();
            loadFinancialReports();
            showMessage('Pagamento registrado com sucesso!', 'success');
        }

        function loadTransactions() {
            const tbody = document.getElementById('transactionsTableBody');
            tbody.innerHTML = '';

            demoData.transactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(transaction.date)}</td>
                    <td><span class="badge ${transaction.type === 'receita' ? 'success' : 'warning'}">${transaction.type}</span></td>
                    <td>${transaction.description}</td>
                    <td>${formatCurrency(transaction.value)}</td>
                    <td><span class="badge ${getStatusBadgeClass(transaction.status)}">${transaction.status}</span></td>
                    <td>
                        <button class="btn btn-info" onclick="editTransaction(${transaction.id})" style="font-size: 12px; padding: 8px 12px;">‚úèÔ∏è Editar</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function openTransactionModal() {
            currentEditingId = null;
            currentEditingType = 'transaction';
            document.getElementById('transactionModalTitle').textContent = 'Nova Transa√ß√£o';
            document.getElementById('transactionForm').reset();
            document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
            openModal('transactionModal');
        }

        function editTransaction(id) {
            const transaction = demoData.transactions.find(t => t.id === id);
            if (!transaction) return;

            currentEditingId = id;
            currentEditingType = 'transaction';
            
            document.getElementById('transactionModalTitle').textContent = 'Editar Transa√ß√£o';
            document.getElementById('transactionDate').value = transaction.date;
            document.getElementById('transactionType').value = transaction.type;
            document.getElementById('transactionDescription').value = transaction.description;
            document.getElementById('transactionValue').value = transaction.value;
            document.getElementById('transactionStatus').value = transaction.status;
            
            openModal('transactionModal');
        }

        document.getElementById('transactionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const transactionData = {
                date: document.getElementById('transactionDate').value,
                type: document.getElementById('transactionType').value,
                description: document.getElementById('transactionDescription').value,
                value: parseFloat(document.getElementById('transactionValue').value),
                status: document.getElementById('transactionStatus').value
            };

            if (currentEditingId) {
                const index = demoData.transactions.findIndex(t => t.id === currentEditingId);
                if (index > -1) {
                    demoData.transactions[index] = { ...demoData.transactions[index], ...transactionData };
                    showMessage('Transa√ß√£o atualizada com sucesso!', 'success');
                }
            } else {
                const newId = Math.max(...demoData.transactions.map(t => t.id), 0) + 1;
                demoData.transactions.push({ id: newId, ...transactionData });
                showMessage('Transa√ß√£o cadastrada com sucesso!', 'success');
            }

            closeModal('transactionModal');
            loadTransactions();
            loadFinancialReports();
        });

        // Utility functions
        function logout() {
            currentUser = null;
            currentEditingId = null;
            currentEditingType = null;
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
            showMessage('Logout realizado com sucesso!', 'info');
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            showMessage('Tema alterado!', 'info');
        }

        function connectSheets() {
            showMessage('Funcionalidade de integra√ß√£o com Google Sheets em desenvolvimento!', 'info');
        }

        function exportData() {
            const dataToExport = {
                students: demoData.students,
                classes: demoData.classes,
                courses: demoData.courses,
                attendance: demoData.attendance,
                transactions: demoData.transactions,
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `gamecreators_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showMessage('Backup exportado com sucesso!', 'success');
        }

        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            populateStudentFilters();
            populateClassFilters();
        });
    </script>
</body>
</html>
>
</body>
</html>
