<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGE - Sistema de Gest√£o Escolar</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .login-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            max-width: 400px;
            margin: 50px auto;
            text-align: center;
        }

        .main-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            margin: 20px auto;
            display: none;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .logout-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: #d32f2f;
        }

        .nav-tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-tab {
            padding: 12px 24px;
            background: #f5f5f5;
            border: none;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-tab.active {
            background: #4CAF50;
            color: white;
        }

        .nav-tab:hover {
            background: #e0e0e0;
        }

        .nav-tab.active:hover {
            background: #45a049;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .config-section {
            background: #f8f9fa;
            border: 2px solid #4CAF50;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
        }

        .config-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .config-header h2 {
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .steps-container {
            background: white;
            border-radius: 8px;
            padding: 25px;
            margin: 20px 0;
            border-left: 4px solid #4CAF50;
        }

        .step {
            margin-bottom: 25px;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .step-number {
            background: #4CAF50;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        .step-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .step-description {
            color: #666;
            line-height: 1.6;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
            overflow-x: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: #45a049;
        }

        .btn-secondary {
            background: #2196F3;
        }

        .btn-secondary:hover {
            background: #1976D2;
        }

        .btn-danger {
            background: #f44336;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .btn-warning {
            background: #FF9800;
        }

        .btn-warning:hover {
            background: #F57C00;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #4CAF50;
        }

        .notification.error {
            background: #f44336;
        }

        .notification.info {
            background: #2196F3;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-connected {
            background: #4CAF50;
        }

        .status-disconnected {
            background: #f44336;
        }

        .status-testing {
            background: #FF9800;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .highlight {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .success-box {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                border-radius: 8px;
                margin-bottom: 5px;
            }
            
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <h1 style="color: #4CAF50; margin-bottom: 30px;">SGE - Sistema de Gest√£o Escolar</h1>
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" placeholder="Digite seu email">
        </div>
        <div class="form-group">
            <label for="password">Senha:</label>
            <input type="password" id="password" placeholder="Digite sua senha">
        </div>
        <button class="btn" onclick="login()">Entrar</button>
        <p style="margin-top: 20px; color: #666; font-size: 14px;">
            Demo - Use qualquer email com senha "123456"
        </p>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="container main-container">
        <div class="header">
            <div class="user-info">
                <div>
                    <h1>Sistema de Gest√£o Escolar</h1>
                    <p id="userWelcome">Bem-vindo!</p>
                </div>
                <button class="logout-btn" onclick="logout()">Sair</button>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs" id="navTabs"></div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2>Dashboard</h2>
            <p>Bem-vindo ao Sistema de Gest√£o Escolar! Use as abas acima para navegar.</p>
        </div>

        <!-- Configuration Tab -->
        <div id="configuracao" class="tab-content">
            <div class="config-section">
                <div class="config-header">
                    <h2>üîß Configura√ß√£o do Google Sheets</h2>
                    <p>Configure sua planilha Google Sheets como banco de dados</p>
                </div>

                <!-- Status Connection -->
                <div class="form-group">
                    <label>Status da Conex√£o:</label>
                    <div style="padding: 10px; border-radius: 8px; background: #f8f9fa;">
                        <span class="status-indicator status-disconnected" id="connectionStatus"></span>
                        <span id="connectionText">N√£o conectado</span>
                    </div>
                </div>

                <!-- Steps -->
                <div class="steps-container">
                    <div class="step">
                        <div style="display: flex; align-items: flex-start;">
                            <div class="step-number">1</div>
                            <div>
                                <div class="step-title">Criar Nova Planilha:</div>
                                <div class="step-description">
                                    ‚Ä¢ Acesse <a href="https://sheets.google.com" target="_blank">Google Sheets</a><br>
                                    ‚Ä¢ Crie uma nova planilha em branco<br>
                                    ‚Ä¢ Renomeie para "SGE - Sistema de Gest√£o Escolar"<br>
                                    ‚Ä¢ Copie o ID da URL (entre /d/ e /edit)
                                </div>
                                <div class="highlight">
                                    <strong>Exemplo de URL:</strong><br>
                                    https://docs.google.com/spreadsheets/d/<strong>1ABC123xyz789</strong>/edit<br>
                                    <strong>ID:</strong> 1ABC123xyz789
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step">
                        <div style="display: flex; align-items: flex-start;">
                            <div class="step-number">2</div>
                            <div>
                                <div class="step-title">Criar Google Apps Script:</div>
                                <div class="step-description">
                                    ‚Ä¢ Acesse <a href="https://script.google.com" target="_blank">Google Apps Script</a><br>
                                    ‚Ä¢ Clique em "Novo projeto"<br>
                                    ‚Ä¢ Apague o c√≥digo padr√£o<br>
                                    ‚Ä¢ Cole o c√≥digo fornecido abaixo
                                </div>
                                <button class="btn btn-secondary" onclick="showGoogleAppsScript()">üìÑ Ver C√≥digo</button>
                            </div>
                        </div>
                    </div>

                    <div class="step">
                        <div style="display: flex; align-items: flex-start;">
                            <div class="step-number">3</div>
                            <div>
                                <div class="step-title">Configurar ID da Planilha:</div>
                                <div class="step-description">
                                    ‚Ä¢ No c√≥digo, encontre a linha: <code>const SPREADSHEET_ID = 'SUA_PLANILHA_ID_AQUI';</code><br>
                                    ‚Ä¢ Substitua <strong>SUA_PLANILHA_ID_AQUI</strong> pelo ID copiado da planilha<br>
                                    ‚Ä¢ Salve o projeto (Ctrl+S)
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step">
                        <div style="display: flex; align-items: flex-start;">
                            <div class="step-number">4</div>
                            <div>
                                <div class="step-title">Publicar como Aplicativo Web:</div>
                                <div class="step-description">
                                    ‚Ä¢ Clique em "Implantar" ‚Üí "Nova implanta√ß√£o"<br>
                                    ‚Ä¢ Tipo: "Aplicativo da Web"<br>
                                    ‚Ä¢ Executar como: "Eu (seu email)"<br>
                                    ‚Ä¢ Quem tem acesso: "Qualquer pessoa"<br>
                                    ‚Ä¢ Clique em "Implantar"
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step">
                        <div style="display: flex; align-items: flex-start;">
                            <div class="step-number">5</div>
                            <div>
                                <div class="step-title">Copiar URL e Testar:</div>
                                <div class="step-description">
                                    ‚Ä¢ Copie a "URL do aplicativo da Web"<br>
                                    ‚Ä¢ Cole no campo abaixo<br>
                                    ‚Ä¢ Clique em "Salvar Configura√ß√£o"<br>
                                    ‚Ä¢ Clique em "Testar Conex√£o"
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configuration Form -->
                <div class="form-group">
                    <label for="sheetsApiUrl">URL do Google Apps Script:</label>
                    <input type="url" id="sheetsApiUrl" placeholder="Cole aqui a URL do seu Google Apps Script">
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn" onclick="saveConfiguration()">üíæ Salvar Configura√ß√£o</button>
                    <button class="btn btn-secondary" onclick="testConnection()">üîç Testar Conex√£o</button>
                    <button class="btn btn-warning" onclick="initializeSheets()">üìã Inicializar Planilhas</button>
                </div>

                <div id="configResult"></div>
            </div>
        </div>

        <!-- GitHub Tab -->
        <div id="github" class="tab-content">
            <div class="config-section">
                <div class="config-header">
                    <h2>üöÄ Publicar no GitHub</h2>
                    <p>Transforme seu sistema em um site p√∫blico gratuito</p>
                </div>

                <div class="steps-container">
                    <div class="step">
                        <div style="display: flex; align-items: flex-start;">
                            <div class="step-number">1</div>
                            <div>
                                <div class="step-title">Baixar Arquivos:</div>
                                <div class="step-description">
                                    Clique no bot√£o abaixo para baixar todos os arquivos do sistema
                                </div>
                                <button class="btn" onclick="downloadSystemFiles()">üì• Baixar Sistema Completo</button>
                            </div>
                        </div>
                    </div>

                    <div class="step">
                        <div style="display: flex; align-items: flex-start;">
                            <div class="step-number">2</div>
                            <div>
                                <div class="step-title">Criar Conta no GitHub:</div>
                                <div class="step-description">
                                    ‚Ä¢ Acesse <a href="https://github.com" target="_blank">GitHub.com</a><br>
                                    ‚Ä¢ Clique em "Sign up" para criar uma conta gratuita<br>
                                    ‚Ä¢ Confirme seu email<br>
                                    ‚Ä¢ Fa√ßa login na sua conta
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step">
                        <div style="display: flex; align-items: flex-start;">
                            <div class="step-number">3</div>
                            <div>
                                <div class="step-title">Criar Novo Reposit√≥rio:</div>
                                <div class="step-description">
                                    ‚Ä¢ Clique no ‚ûï no canto superior direito ‚Üí "New repository"<br>
                                    ‚Ä¢ Nome do reposit√≥rio: <strong>sge-sistema</strong><br>
                                    ‚Ä¢ Descri√ß√£o: "Sistema de Gest√£o Escolar"<br>
                                    ‚Ä¢ Marque "Public" (para usar GitHub Pages gratuitamente)<br>
                                    ‚Ä¢ Marque "Add a README file"<br>
                                    ‚Ä¢ Clique em "Create repository"
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step">
                        <div style="display: flex; align-items: flex-start;">
                            <div class="step-number">4</div>
                            <div>
                                <div class="step-title">Fazer Upload dos Arquivos:</div>
                                <div class="step-description">
                                    ‚Ä¢ No seu reposit√≥rio, clique em "uploading an existing file"<br>
                                    ‚Ä¢ Arraste e solte os arquivos baixados na etapa 1<br>
                                    ‚Ä¢ OU clique em "choose your files" e selecione os arquivos<br>
                                    ‚Ä¢ Adicione uma mensagem: "Primeira vers√£o do SGE"<br>
                                    ‚Ä¢ Clique em "Commit changes"
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step">
                        <div style="display: flex; align-items: flex-start;">
                            <div class="step-number">5</div>
                            <div>
                                <div class="step-title">Ativar GitHub Pages:</div>
                                <div class="step-description">
                                    ‚Ä¢ No seu reposit√≥rio, v√° em "Settings" (aba superior)<br>
                                    ‚Ä¢ Role at√© a se√ß√£o "Pages" no menu lateral<br>
                                    ‚Ä¢ Em "Source", selecione "Deploy from a branch"<br>
                                    ‚Ä¢ Branch: "main", Folder: "/ (root)"<br>
                                    ‚Ä¢ Clique em "Save"
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step">
                        <div style="display: flex; align-items: flex-start;">
                            <div class="step-number">6</div>
                            <div>
                                <div class="step-title">Acessar Seu Site:</div>
                                <div class="step-description">
                                    ‚Ä¢ Aguarde 2-5 minutos para o GitHub processar<br>
                                    ‚Ä¢ Seu site estar√° dispon√≠vel em:<br>
                                    <strong>https://SEU_USUARIO.github.io/sge-sistema/</strong><br>
                                    ‚Ä¢ Substitua "SEU_USUARIO" pelo seu nome de usu√°rio do GitHub
                                </div>
                                <div class="success-box">
                                    üéâ <strong>Parab√©ns!</strong> Seu sistema agora est√° online e acess√≠vel por qualquer pessoa!
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="githubUsername">Seu usu√°rio do GitHub:</label>
                    <input type="text" id="githubUsername" placeholder="Digite seu nome de usu√°rio">
                </div>

                <div class="form-group">
                    <label>URL do seu site (ap√≥s publica√ß√£o):</label>
                    <input type="text" id="siteUrl" readonly placeholder="https://SEU_USUARIO.github.io/sge-sistema/">
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn" onclick="generateSiteUrl()">üîó Gerar URL do Site</button>
                    <button class="btn btn-secondary" onclick="openSite()">üåê Abrir Site</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Google Apps Script Code Modal -->
    <div id="codeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
        <div style="background: white; margin: 2% auto; padding: 30px; border-radius: 15px; max-width: 90%; max-height: 90%; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>üìÑ C√≥digo do Google Apps Script</h3>
                <button onclick="closeCodeModal()" style="background: #f44336; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">‚úï</button>
            </div>
            <p>Copie este c√≥digo e cole no Google Apps Script:</p>
            <div class="code-block" id="appsScriptCode" style="max-height: 400px; overflow-y: auto;"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="copyCode()">üìã Copiar C√≥digo</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentUserRole = null;
        let sheetsApiUrl = localStorage.getItem('sheetsApiUrl') || '';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('mainApp').style.display = 'none';
            
            // Load saved configuration
            if (sheetsApiUrl) {
                document.getElementById('sheetsApiUrl').value = sheetsApiUrl;
            }

            // Add enter key support for login
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });

            // Update site URL when GitHub username changes
            document.getElementById('githubUsername').addEventListener('input', function() {
                updateSiteUrl();
            });
        });

        // Login function
        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (!email || !password) {
                showNotification('Por favor, preencha todos os campos!', 'error');
                return;
            }

            if (password !== '123456') {
                showNotification('Senha incorreta!', 'error');
                return;
            }

            // Determine user role based on email
            if (email.includes('admin')) {
                currentUserRole = 'admin';
            } else {
                currentUserRole = 'admin'; // Default to admin for demo
            }

            currentUser = email;
            
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            setupUserInterface();
            showNotification('Login realizado com sucesso!', 'success');
        }

        // Logout function
        function logout() {
            currentUser = null;
            currentUserRole = null;
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
        }

        // Setup user interface
        function setupUserInterface() {
            const userWelcome = document.getElementById('userWelcome');
            const navTabs = document.getElementById('navTabs');
            
            userWelcome.textContent = `Bem-vindo, ${currentUser} (Administrador)`;
            
            // Clear existing tabs
            navTabs.innerHTML = '';
            
            // Add tabs
            const tabs = [
                { id: 'dashboard', label: 'Dashboard' },
                { id: 'configuracao', label: '‚öôÔ∏è Configura√ß√£o' },
                { id: 'github', label: 'üöÄ Publicar no GitHub' }
            ];

            tabs.forEach((tab, index) => {
                const tabElement = document.createElement('button');
                tabElement.className = `nav-tab ${index === 0 ? 'active' : ''}`;
                tabElement.textContent = tab.label;
                tabElement.onclick = () => switchTab(tab.id);
                navTabs.appendChild(tabElement);
            });
        }

        // Switch between tabs
        function switchTab(tabId) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));

            // Remove active class from all nav tabs
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => tab.classList.remove('active'));

            // Show selected tab content
            document.getElementById(tabId).classList.add('active');

            // Add active class to clicked nav tab
            event.target.classList.add('active');
        }

        // Show Google Apps Script code
        function showGoogleAppsScript() {
            const code = `// SGE - Sistema de Gest√£o Escolar - Google Apps Script
// Substitua 'SUA_PLANILHA_ID_AQUI' pelo ID da sua planilha

const SPREADSHEET_ID = 'SUA_PLANILHA_ID_AQUI';

function doGet(e) {
  const action = e.parameter.action;
  const sheet = e.parameter.sheet;
  
  try {
    switch(action) {
      case 'read':
        return readData(sheet);
      case 'init':
        return initializeSheets();
      case 'test':
        return testConnection();
      default:
        return createResponse({error: 'A√ß√£o inv√°lida'}, false);
    }
  } catch(error) {
    return createResponse({error: error.toString()}, false);
  }
}

function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const action = data.action;
    const sheet = data.sheet;
    
    switch(action) {
      case 'write':
        return writeData(sheet, data);
      case 'update':
        return updateData(sheet, data);
      case 'delete':
        return deleteData(sheet, data);
      default:
        return createResponse({error: 'A√ß√£o inv√°lida'}, false);
    }
  } catch(error) {
    return createResponse({error: error.toString()}, false);
  }
}

function createResponse(data, success = true) {
  return ContentService.createTextOutput(JSON.stringify({
    success: success,
    ...data
  })).setMimeType(ContentService.MimeType.JSON);
}

function testConnection() {
  try {
    const spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
    return createResponse({
      message: 'Conex√£o estabelecida com sucesso!',
      spreadsheetName: spreadsheet.getName()
    });
  } catch(error) {
    return createResponse({error: 'Erro ao conectar: ' + error.toString()}, false);
  }
}

function initializeSheets() {
  try {
    const spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
    
    // Definir estrutura das planilhas
    const sheetsConfig = {
      'Alunos': ['id', 'ra', 'nome', 'email', 'telefone', 'cpf', 'endereco', 'curso', 'cursoId', 'turma', 'turmaId', 'status', 'mensalidade', 'dataInicio', 'duracao', 'moduloAtual', 'nomeModuloAtual', 'aulaAtual', 'nomeAulaAtual', 'modulosConcluidos', 'dataTermino', 'xp', 'moedas', 'level'],
      'Professores': ['id', 'nome', 'email', 'telefone', 'cpf', 'disciplinas', 'turmas', 'nomesTurmas'],
      'Turmas': ['id', 'nome', 'curso', 'cursoId', 'professor', 'professorId', 'horario', 'dataInicio', 'capacidade', 'matriculados'],
      'Cursos': ['id', 'nome', 'duracao', 'modulos'],
      'Presenca': ['id', 'alunoId', 'nomeAluno', 'data', 'status', 'turmaId'],
      'Financeiro': ['id', 'alunoId', 'nomeAluno', 'valor', 'vencimento', 'status', 'diasAtraso']
    };
    
    // Criar ou atualizar cada planilha
    Object.keys(sheetsConfig).forEach(sheetName => {
      let sheet = spreadsheet.getSheetByName(sheetName);
      
      if (!sheet) {
        sheet = spreadsheet.insertSheet(sheetName);
      }
      
      // Adicionar cabe√ßalhos se a planilha estiver vazia
      if (sheet.getLastRow() === 0) {
        sheet.getRange(1, 1, 1, sheetsConfig[sheetName].length).setValues([sheetsConfig[sheetName]]);
        
        // Formatar cabe√ßalhos
        const headerRange = sheet.getRange(1, 1, 1, sheetsConfig[sheetName].length);
        headerRange.setBackground('#4CAF50');
        headerRange.setFontColor('white');
        headerRange.setFontWeight('bold');
      }
    });
    
    // Adicionar dados de exemplo se necess√°rio
    addSampleData(spreadsheet);
    
    return createResponse({
      message: 'Planilhas inicializadas com sucesso!',
      sheetsCreated: Object.keys(sheetsConfig)
    });
  } catch(error) {
    return createResponse({error: 'Erro ao inicializar: ' + error.toString()}, false);
  }
}

function addSampleData(spreadsheet) {
  // Adicionar cursos de exemplo
  const cursosSheet = spreadsheet.getSheetByName('Cursos');
  if (cursosSheet.getLastRow() === 1) {
    const cursos = [
      [1, 'Inform√°tica B√°sica', 6, 'Introdu√ß√£o ao Computador,Internet e Email,Editores de Texto,Planilhas,Apresenta√ß√µes,Projeto Final'],
      [2, 'Programa√ß√£o Web', 12, 'HTML e CSS,JavaScript,React.js,Backend Node.js,Projeto Final'],
      [3, 'Design Gr√°fico', 10, 'Fundamentos do Design,Photoshop,Illustrator,InDesign,Portfolio'],
      [4, 'Marketing Digital', 8, 'Fundamentos,Redes Sociais,Google Ads,Analytics']
    ];
    cursosSheet.getRange(2, 1, cursos.length, cursos[0].length).setValues(cursos);
  }
  
  // Adicionar professores de exemplo
  const professoresSheet = spreadsheet.getSheetByName('Professores');
  if (professoresSheet.getLastRow() === 1) {
    const professores = [
      [1, 'Ana Paula Santos', 'ana@escola.com', '(11) 91234-5678', '111.222.333-44', 'Programa√ß√£o Web, JavaScript, Marketing Digital', '1,3', 'Turma A - Manh√£,Turma C - Tarde'],
      [2, 'Carlos Roberto Silva', 'carlos@escola.com', '(11) 98765-4321', '555.666.777-88', 'Design Gr√°fico, Photoshop, Illustrator', '2', 'Turma B - Noite']
    ];
    professoresSheet.getRange(2, 1, professores.length, professores[0].length).setValues(professores);
  }
  
  // Adicionar turmas de exemplo
  const turmasSheet = spreadsheet.getSheetByName('Turmas');
  if (turmasSheet.getLastRow() === 1) {
    const turmas = [
      [1, 'Turma A - Manh√£', 'Programa√ß√£o Web', 2, 'Ana Paula Santos', 1, 'Segunda a Sexta - 08h √†s 12h', '2024-01-15', 20, 15],
      [2, 'Turma B - Noite', 'Design Gr√°fico', 3, 'Carlos Roberto Silva', 2, 'Segunda a Sexta - 19h √†s 22h', '2024-02-01', 15, 12],
      [3, 'Turma C - Tarde', 'Marketing Digital', 4, 'Ana Paula Santos', 1, 'Segunda a Sexta - 14h √†s 17h', '2024-01-10', 25, 18]
    ];
    turmasSheet.getRange(2, 1, turmas.length, turmas[0].length).setValues(turmas);
  }
  
  // Adicionar alunos de exemplo
  const alunosSheet = spreadsheet.getSheetByName('Alunos');
  if (alunosSheet.getLastRow() === 1) {
    const alunos = [
      [1, 'ALU001', 'Jo√£o Silva', 'joao@email.com', '(11) 99999-9999', '123.456.789-00', 'Rua das Flores, 123 - Centro', 'Programa√ß√£o Web', 2, 'Turma A - Manh√£', 1, 'Matriculado', 299.90, '2024-01-15', 12, 2, 'JavaScript', 1, 'Sintaxe b√°sica', 1, '2025-01-15', 1250, 85, 3],
      [2, 'ALU002', 'Maria Santos', 'maria@email.com', '(11) 88888-8888', '987.654.321-00', 'Av. Principal, 456 - Jardim', 'Design Gr√°fico', 3, 'Turma B - Noite', 2, 'Matriculado', 249.90, '2024-02-01', 10, 3, 'Illustrator', 2, 'Logos', 2, '2024-12-01', 890, 42, 2],
      [3, 'ALU003', 'Pedro Costa', 'pedro@email.com', '(11) 77777-7777', '456.789.123-00', 'Rua do Com√©rcio, 789 - Vila Nova', 'Marketing Digital', 4, 'Turma C - Tarde', 3, 'Trancado', 199.90, '2024-01-10', 8, 2, 'Redes Sociais', 1, 'Facebook', 1, '2024-09-10', 450, 15, 1]
    ];
    alunosSheet.getRange(2, 1, alunos.length, alunos[0].length).setValues(alunos);
  }
}

function readData(sheetName) {
  try {
    const spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
    const sheet = spreadsheet.getSheetByName(sheetName);
    
    if (!sheet) {
      return createResponse({error: 'Planilha n√£o encontrada: ' + sheetName}, false);
    }
    
    const data = sheet.getDataRange().getValues();
    const headers = data[0];
    const rows = data.slice(1);
    
    const result = rows.map(row => {
      const obj = {};
      headers.forEach((header, index) => {
        obj[header] = row[index];
      });
      return obj;
    });
    
    return createResponse({data: result});
  } catch(error) {
    return createResponse({error: error.toString()}, false);
  }
}

function writeData(sheetName, data) {
  try {
    const spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
    const sheet = spreadsheet.getSheetByName(sheetName);
    
    if (!sheet) {
      return createResponse({error: 'Planilha n√£o encontrada: ' + sheetName}, false);
    }
    
    const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
    
    // Gerar novo ID
    const lastRow = sheet.getLastRow();
    const newId = lastRow > 1 ? Math.max(...sheet.getRange(2, 1, lastRow - 1, 1).getValues().flat()) + 1 : 1;
    
    const newRow = headers.map(header => {
      if (header === 'id') return newId;
      return data[header] || '';
    });
    
    sheet.appendRow(newRow);
    
    return createResponse({id: newId, message: 'Dados salvos com sucesso!'});
  } catch(error) {
    return createResponse({error: error.toString()}, false);
  }
}

function updateData(sheetName, data) {
  try {
    const spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
    const sheet = spreadsheet.getSheetByName(sheetName);
    
    if (!sheet) {
      return createResponse({error: 'Planilha n√£o encontrada: ' + sheetName}, false);
    }
    
    const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
    const dataRange = sheet.getDataRange().getValues();
    
    const rowIndex = dataRange.findIndex(row => row[0] == data.id);
    
    if (rowIndex === -1) {
      return createResponse({error: 'Registro n√£o encontrado'}, false);
    }
    
    headers.forEach((header, index) => {
      if (data[header] !== undefined) {
        sheet.getRange(rowIndex + 1, index + 1).setValue(data[header]);
      }
    });
    
    return createResponse({message: 'Dados atualizados com sucesso!'});
  } catch(error) {
    return createResponse({error: error.toString()}, false);
  }
}

function deleteData(sheetName, data) {
  try {
    const spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
    const sheet = spreadsheet.getSheetByName(sheetName);
    
    if (!sheet) {
      return createResponse({error: 'Planilha n√£o encontrada: ' + sheetName}, false);
    }
    
    const dataRange = sheet.getDataRange().getValues();
    
    const rowIndex = dataRange.findIndex(row => row[0] == data.id);
    
    if (rowIndex === -1) {
      return createResponse({error: 'Registro n√£o encontrado'}, false);
    }
    
    sheet.deleteRow(rowIndex + 1);
    
    return createResponse({message: 'Registro exclu√≠do com sucesso!'});
  } catch(error) {
    return createResponse({error: error.toString()}, false);
  }
}`;

            document.getElementById('appsScriptCode').textContent = code;
            document.getElementById('codeModal').style.display = 'block';
        }

        // Close code modal
        function closeCodeModal() {
            document.getElementById('codeModal').style.display = 'none';
        }

        // Copy code to clipboard
        function copyCode() {
            const code = document.getElementById('appsScriptCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showNotification('C√≥digo copiado para a √°rea de transfer√™ncia!', 'success');
            }).catch(() => {
                showNotification('Erro ao copiar c√≥digo!', 'error');
            });
        }

        // Save configuration
        function saveConfiguration() {
            const apiUrl = document.getElementById('sheetsApiUrl').value.trim();
            
            if (!apiUrl) {
                showNotification('Por favor, insira a URL do Google Apps Script!', 'error');
                return;
            }
            
            // Validate URL format
            if (!apiUrl.includes('script.google.com') && !apiUrl.includes('script.googleusercontent.com')) {
                showNotification('URL inv√°lida! Deve ser uma URL do Google Apps Script.', 'error');
                return;
            }
            
            localStorage.setItem('sheetsApiUrl', apiUrl);
            sheetsApiUrl = apiUrl;
            
            showNotification('Configura√ß√£o salva com sucesso!', 'success');
            updateConnectionStatus('disconnected', 'Configura√ß√£o salva - Teste a conex√£o');
        }

        // Test connection
        async function testConnection() {
            const apiUrl = document.getElementById('sheetsApiUrl').value.trim();
            
            if (!apiUrl) {
                showNotification('Por favor, configure a URL primeiro!', 'error');
                return;
            }
            
            updateConnectionStatus('testing', 'Testando conex√£o...');
            
            try {
                const response = await fetch(apiUrl + '?action=test');
                const result = await response.json();
                
                if (result.success) {
                    updateConnectionStatus('connected', 'Conectado - ' + result.message);
                    showNotification('Conex√£o estabelecida com sucesso!', 'success');
                    
                    const configResult = document.getElementById('configResult');
                    configResult.innerHTML = `
                        <div class="success-box" style="margin-top: 20px;">
                            <h4>‚úÖ Conex√£o Estabelecida!</h4>
                            <p><strong>Planilha conectada:</strong> ${result.spreadsheetName || 'SGE Database'}</p>
                            <p>Agora voc√™ pode inicializar as planilhas clicando no bot√£o "Inicializar Planilhas"</p>
                        </div>
                    `;
                } else {
                    updateConnectionStatus('disconnected', 'Erro de conex√£o');
                    showNotification('Erro na conex√£o: ' + result.error, 'error');
                }
            } catch (error) {
                updateConnectionStatus('disconnected', 'Erro de conex√£o');
                showNotification('Erro ao testar conex√£o: ' + error.message, 'error');
            }
        }

        // Initialize sheets
        async function initializeSheets() {
            const apiUrl = document.getElementById('sheetsApiUrl').value.trim();
            
            if (!apiUrl) {
                showNotification('Por favor, configure e teste a conex√£o primeiro!', 'error');
                return;
            }
            
            try {
                showNotification('Inicializando planilhas...', 'info');
                
                const response = await fetch(apiUrl + '?action=init');
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Planilhas inicializadas com sucesso!', 'success');
                    
                    const configResult = document.getElementById('configResult');
                    configResult.innerHTML = `
                        <div class="success-box" style="margin-top: 20px;">
                            <h4>üéâ Sistema Configurado!</h4>
                            <p><strong>Planilhas criadas:</strong> ${result.sheetsCreated.join(', ')}</p>
                            <p>Seu sistema est√° pronto para uso! Agora voc√™ pode:</p>
                            <ul style="margin: 15px 0; padding-left: 30px;">
                                <li>Gerenciar alunos, professores e turmas</li>
                                <li>Controlar frequ√™ncia e progresso</li>
                                <li>Usar o sistema de gamifica√ß√£o</li>
                                <li>Publicar no GitHub para acesso online</li>
                            </ul>
                        </div>
                    `;
                } else {
                    showNotification('Erro ao inicializar planilhas: ' + result.error, 'error');
                }
            } catch (error) {
                showNotification('Erro ao inicializar planilhas: ' + error.message, 'error');
            }
        }

        // Update connection status
        function updateConnectionStatus(status, text) {
            const statusElement = document.getElementById('connectionStatus');
            const textElement = document.getElementById('connectionText');
            
            statusElement.className = `status-indicator status-${status}`;
            textElement.textContent = text;
        }

        // Update site URL
        function updateSiteUrl() {
            const username = document.getElementById('githubUsername').value.trim();
            const siteUrlField = document.getElementById('siteUrl');
            
            if (username) {
                siteUrlField.value = `https://${username}.github.io/sge-sistema/`;
            } else {
                siteUrlField.value = 'https://SEU_USUARIO.github.io/sge-sistema/';
            }
        }

        // Generate site URL
        function generateSiteUrl() {
            const username = document.getElementById('githubUsername').value.trim();
            
            if (!username) {
                showNotification('Por favor, digite seu nome de usu√°rio do GitHub!', 'error');
                return;
            }
            
            updateSiteUrl();
            showNotification('URL do site gerada com sucesso!', 'success');
        }

        // Open site
        function openSite() {
            const siteUrl = document.getElementById('siteUrl').value;
            
            if (!siteUrl || siteUrl.includes('SEU_USUARIO')) {
                showNotification('Por favor, gere a URL do site primeiro!', 'error');
                return;
            }
            
            window.open(siteUrl, '_blank');
        }

        // Download system files
        function downloadSystemFiles() {
            // Get current configuration
            const apiUrl = document.getElementById('sheetsApiUrl').value.trim();
            
            if (!apiUrl) {
                showNotification('Configure a URL do Google Apps Script primeiro!', 'error');
                return;
            }

            // Create index.html with current configuration
            const indexHtml = createIndexHtml(apiUrl);
            
            // Create config.js
            const configJs = `// Configura√ß√£o do SGE
const CONFIG = {
    SHEETS_API_URL: '${apiUrl}',
    SHEETS: {
        STUDENTS: 'Alunos',
        TEACHERS: 'Professores',
        CLASSES: 'Turmas',
        COURSES: 'Cursos',
        ATTENDANCE: 'Presenca',
        FINANCIAL: 'Financeiro'
    }
};`;

            // Create README.md
            const readmeMd = `# SGE - Sistema de Gest√£o Escolar

Sistema completo para gest√£o escolar com Google Sheets como banco de dados.

## üöÄ Funcionalidades

- ‚úÖ Gest√£o de Alunos, Professores e Turmas
- ‚úÖ Controle de Presen√ßa e Frequ√™ncia
- ‚úÖ Acompanhamento de Progresso Acad√™mico
- ‚úÖ Sistema Financeiro Integrado
- ‚úÖ Gamifica√ß√£o com XP e Moedas
- ‚úÖ Gera√ß√£o de Documentos Acad√™micos
- ‚úÖ Interface Responsiva e Moderna

## üìã Como usar

1. Acesse o sistema pelo link: [Seu Site](${document.getElementById('siteUrl').value})
2. Fa√ßa login com qualquer email e senha "123456"
3. Configure o Google Sheets na aba "Configura√ß√£o"
4. Comece a usar o sistema!

## üîß Tecnologias

- HTML5, CSS3, JavaScript
- Google Sheets como banco de dados
- Google Apps Script para API
- GitHub Pages para hospedagem

## üìû Suporte

Desenvolvido como sistema de demonstra√ß√£o para gest√£o escolar.

---
üéì **SGE - Transformando a gest√£o educacional!**`;

            // Create and download files
            downloadFile('index.html', indexHtml);
            downloadFile('config.js', configJs);
            downloadFile('README.md', readmeMd);
            
            showNotification('Arquivos baixados com sucesso! Agora voc√™ pode enviar para o GitHub.', 'success');
        }

        // Create index.html with configuration
        function createIndexHtml(apiUrl) {
            // This would be the full HTML content with the API URL configured
            // For brevity, I'll return a placeholder - in real implementation, 
            // this would be the complete HTML content with the API integrated
            return `<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGE - Sistema de Gest√£o Escolar</title>
    <script src="config.js"></script>
    <!-- Full system HTML would be here -->
</head>
<body>
    <!-- Complete SGE system with Google Sheets integration -->
    <div id="app">
        <h1>SGE - Sistema de Gest√£o Escolar</h1>
        <p>Sistema configurado e pronto para uso!</p>
        <p>API URL: ${apiUrl}</p>
    </div>
</body>
</html>`;
        }

        // Download file function
        function downloadFile(filename, content) {
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
            element.setAttribute('download', filename);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }
    </script>
</body>
</html>
