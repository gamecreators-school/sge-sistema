<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGE - Sistema de Gest√£o Escolar</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .login-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            max-width: 400px;
            margin: 50px auto;
            text-align: center;
        }

        .main-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            margin: 20px auto;
            display: none;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .logout-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: #d32f2f;
        }

        .nav-tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-tab {
            padding: 12px 24px;
            background: #f5f5f5;
            border: none;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-tab.active {
            background: #4CAF50;
            color: white;
        }

        .nav-tab:hover {
            background: #e0e0e0;
        }

        .nav-tab.active:hover {
            background: #45a049;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: #45a049;
        }

        .btn-secondary {
            background: #2196F3;
        }

        .btn-secondary:hover {
            background: #1976D2;
        }

        .btn-danger {
            background: #f44336;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .btn-warning {
            background: #FF9800;
        }

        .btn-warning:hover {
            background: #F57C00;
        }

        .btn-info {
            background: #9C27B0;
        }

        .btn-info:hover {
            background: #7B1FA2;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .table th {
            background: #f5f5f5;
            font-weight: 600;
            color: #333;
        }

        .table tr:hover {
            background: #f9f9f9;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .search-box {
            width: 300px;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #4CAF50;
        }

        .notification.error {
            background: #f44336;
        }

        .notification.info {
            background: #2196F3;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-size: 12px;
            font-weight: 500;
        }

        .status-matriculado {
            background: #4CAF50;
        }

        .status-formado {
            background: #2196F3;
        }

        .status-cancelado {
            background: #f44336;
        }

        .status-trancado {
            background: #FF9800;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .nav-tab {
                border-radius: 8px;
                margin-bottom: 5px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .search-box {
                width: 100%;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <h1 style="color: #4CAF50; margin-bottom: 30px;">SGE - Sistema de Gest√£o Escolar</h1>
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" placeholder="Digite seu email">
        </div>
        <div class="form-group">
            <label for="password">Senha:</label>
            <input type="password" id="password" placeholder="Digite sua senha">
        </div>
        <button class="btn" onclick="login()">Entrar</button>
        <p style="margin-top: 20px; color: #666; font-size: 14px;">
            Demo - Use qualquer email com senha "123456"
        </p>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="container main-container">
        <div class="header">
            <div class="user-info">
                <div>
                    <h1>Sistema de Gest√£o Escolar</h1>
                    <p id="userWelcome">Bem-vindo!</p>
                </div>
                <button class="logout-btn" onclick="logout()">Sair</button>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs" id="navTabs"></div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid" id="statsGrid"></div>
            <div class="card">
                <h3 class="card-title">Atividades Recentes</h3>
                <div id="recentActivities"></div>
            </div>
        </div>

        <!-- Students Tab -->
        <div id="students" class="tab-content">
            <div class="action-buttons">
                <h2>Gest√£o de Alunos</h2>
                <button class="btn" onclick="openModal('studentModal')">Novo Aluno</button>
            </div>
            <input type="text" class="search-box" placeholder="Buscar aluno..." onkeyup="searchTable('studentsTable', this.value)">
            <table class="table" id="studentsTable">
                <thead>
                    <tr>
                        <th>RA</th>
                        <th>Nome</th>
                        <th>Email</th>
                        <th>Curso</th>
                        <th>Status</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="studentsTableBody"></tbody>
            </table>
        </div>

        <!-- Teachers Tab -->
        <div id="teachers" class="tab-content">
            <div class="action-buttons">
                <h2>Gest√£o de Professores</h2>
                <button class="btn" onclick="openModal('teacherModal')">Novo Professor</button>
            </div>
            <table class="table" id="teachersTable">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Email</th>
                        <th>Disciplinas</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="teachersTableBody"></tbody>
            </table>
        </div>

        <!-- Classes Tab -->
        <div id="classes" class="tab-content">
            <div class="action-buttons">
                <h2>Gest√£o de Turmas</h2>
                <button class="btn" onclick="openModal('classModal')">Nova Turma</button>
            </div>
            <div class="grid-2" id="classesGrid"></div>
        </div>

        <!-- Configuration Tab -->
        <div id="configuracao" class="tab-content">
            <div class="card">
                <h3 class="card-title">‚öôÔ∏è Configura√ß√£o do Google Sheets</h3>
                <div class="form-group">
                    <label for="sheetsApiUrl">URL do Google Apps Script:</label>
                    <input type="url" id="sheetsApiUrl" placeholder="Cole aqui a URL do seu Google Apps Script">
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn" onclick="saveConfiguration()">üíæ Salvar Configura√ß√£o</button>
                    <button class="btn btn-secondary" onclick="testConnection()">üîç Testar Conex√£o</button>
                </div>
                <div id="configResult"></div>
            </div>
        </div>
    </div>

    <!-- Student Modal -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('studentModal')">&times;</span>
            <h2 id="studentModalTitle">Cadastro de Aluno</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Nome Completo:</label>
                    <input type="text" id="studentName">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="studentEmail">
                </div>
                <div class="form-group">
                    <label>Telefone:</label>
                    <input type="tel" id="studentPhone">
                </div>
                <div class="form-group">
                    <label>CPF:</label>
                    <input type="text" id="studentCPF">
                </div>
            </div>
            <div class="form-group">
                <label>Curso:</label>
                <select id="studentCourse">
                    <option value="">Selecione um curso</option>
                    <option value="Inform√°tica B√°sica">Inform√°tica B√°sica</option>
                    <option value="Programa√ß√£o Web">Programa√ß√£o Web</option>
                    <option value="Design Gr√°fico">Design Gr√°fico</option>
                    <option value="Marketing Digital">Marketing Digital</option>
                </select>
            </div>
            <button class="btn" onclick="saveStudent()">Salvar Aluno</button>
            <input type="hidden" id="editingStudentId">
        </div>
    </div>

    <!-- Teacher Modal -->
    <div id="teacherModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('teacherModal')">&times;</span>
            <h2 id="teacherModalTitle">Cadastro de Professor</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Nome Completo:</label>
                    <input type="text" id="teacherName">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="teacherEmail">
                </div>
                <div class="form-group">
                    <label>Telefone:</label>
                    <input type="tel" id="teacherPhone">
                </div>
                <div class="form-group">
                    <label>CPF:</label>
                    <input type="text" id="teacherCPF">
                </div>
            </div>
            <div class="form-group">
                <label>Disciplinas:</label>
                <input type="text" id="teacherSubjects" placeholder="Ex: Matem√°tica, F√≠sica">
            </div>
            <button class="btn" onclick="saveTeacher()">Salvar Professor</button>
            <input type="hidden" id="editingTeacherId">
        </div>
    </div>

    <!-- Class Modal -->
    <div id="classModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('classModal')">&times;</span>
            <h2 id="classModalTitle">Criar Nova Turma</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Nome da Turma:</label>
                    <input type="text" id="className">
                </div>
                <div class="form-group">
                    <label>Curso:</label>
                    <select id="classCourse">
                        <option value="">Selecione um curso</option>
                        <option value="Inform√°tica B√°sica">Inform√°tica B√°sica</option>
                        <option value="Programa√ß√£o Web">Programa√ß√£o Web</option>
                        <option value="Design Gr√°fico">Design Gr√°fico</option>
                        <option value="Marketing Digital">Marketing Digital</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Hor√°rio:</label>
                    <input type="text" id="classSchedule" placeholder="Ex: Segunda a Sexta - 19h √†s 22h">
                </div>
                <div class="form-group">
                    <label>Capacidade:</label>
                    <input type="number" id="classCapacity" value="20">
                </div>
            </div>
            <button class="btn" onclick="saveClass()">Salvar Turma</button>
            <input type="hidden" id="editingClassId">
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            SHEETS_API_URL: localStorage.getItem('sheetsApiUrl') || '',
            SHEETS: {
                STUDENTS: 'Alunos',
                TEACHERS: 'Professores',
                CLASSES: 'Turmas',
                COURSES: 'Cursos'
            }
        };

        // Global variables
        let currentUser = null;
        let currentUserRole = null;
        let studentsData = [];
        let teachersData = [];
        let classesData = [];

        // Initialize demo data
        function initializeDemoData() {
            studentsData = [
                {
                    id: 1,
                    ra: 'ALU001',
                    nome: 'Jo√£o Silva',
                    email: 'joao@email.com',
                    telefone: '(11) 99999-9999',
                    cpf: '123.456.789-00',
                    curso: 'Programa√ß√£o Web',
                    status: 'Matriculado'
                },
                {
                    id: 2,
                    ra: 'ALU002',
                    nome: 'Maria Santos',
                    email: 'maria@email.com',
                    telefone: '(11) 88888-8888',
                    cpf: '987.654.321-00',
                    curso: 'Design Gr√°fico',
                    status: 'Matriculado'
                }
            ];

            teachersData = [
                {
                    id: 1,
                    nome: 'Ana Paula Santos',
                    email: 'ana@escola.com',
                    telefone: '(11) 91234-5678',
                    cpf: '111.222.333-44',
                    disciplinas: 'Programa√ß√£o Web, JavaScript'
                },
                {
                    id: 2,
                    nome: 'Carlos Roberto Silva',
                    email: 'carlos@escola.com',
                    telefone: '(11) 98765-4321',
                    cpf: '555.666.777-88',
                    disciplinas: 'Design Gr√°fico, Photoshop'
                }
            ];

            classesData = [
                {
                    id: 1,
                    nome: 'Turma A - Manh√£',
                    curso: 'Programa√ß√£o Web',
                    horario: 'Segunda a Sexta - 08h √†s 12h',
                    capacidade: 20,
                    matriculados: 15
                },
                {
                    id: 2,
                    nome: 'Turma B - Noite',
                    curso: 'Design Gr√°fico',
                    horario: 'Segunda a Sexta - 19h √†s 22h',
                    capacidade: 15,
                    matriculados: 12
                }
            ];
        }

        // Login function
        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (!email || !password) {
                showNotification('Por favor, preencha todos os campos!', 'error');
                return;
            }

            if (password !== '123456') {
                showNotification('Senha incorreta!', 'error');
                return;
            }

            currentUserRole = 'admin';
            currentUser = email;
            
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            setupUserInterface();
            initializeDemoData();
            loadDashboard();
            
            showNotification('Login realizado com sucesso!', 'success');
        }

        // Logout function
        function logout() {
            currentUser = null;
            currentUserRole = null;
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
        }

        // Setup user interface
        function setupUserInterface() {
            const userWelcome = document.getElementById('userWelcome');
            const navTabs = document.getElementById('navTabs');
            
            userWelcome.textContent = `Bem-vindo, ${currentUser} (Administrador)`;
            
            navTabs.innerHTML = '';
            
            const tabs = [
                { id: 'dashboard', label: 'Dashboard' },
                { id: 'students', label: 'Alunos' },
                { id: 'teachers', label: 'Professores' },
                { id: 'classes', label: 'Turmas' },
                { id: 'configuracao', label: '‚öôÔ∏è Configura√ß√£o' }
            ];

            tabs.forEach((tab, index) => {
                const tabElement = document.createElement('button');
                tabElement.className = `nav-tab ${index === 0 ? 'active' : ''}`;
                tabElement.textContent = tab.label;
                tabElement.onclick = () => switchTab(tab.id);
                navTabs.appendChild(tabElement);
            });
        }

        // Switch between tabs
        function switchTab(tabId) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));

            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => tab.classList.remove('active'));

            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');

            switch(tabId) {
                case 'students':
                    loadStudents();
                    break;
                case 'teachers':
                    loadTeachers();
                    break;
                case 'classes':
                    loadClasses();
                    break;
                case 'configuracao':
                    loadConfiguration();
                    break;
            }
        }

        // Load dashboard
        function loadDashboard() {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${studentsData.length}</div>
                    <div class="stat-label">Total de Alunos</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);">
                    <div class="stat-number">${teachersData.length}</div>
                    <div class="stat-label">Professores</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);">
                    <div class="stat-number">${classesData.length}</div>
                    <div class="stat-label">Turmas Ativas</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);">
                    <div class="stat-number">98%</div>
                    <div class="stat-label">Taxa de Aprova√ß√£o</div>
                </div>
            `;

            const recentActivities = document.getElementById('recentActivities');
            recentActivities.innerHTML = `
                <div style="padding: 20px; text-align: center; color: #666;">
                    <p>‚Ä¢ Novo aluno cadastrado: Jo√£o Silva</p>
                    <p>‚Ä¢ Turma de Design Gr√°fico iniciada</p>
                    <p>‚Ä¢ Professor Carlos Roberto adicionado</p>
                    <p>‚Ä¢ Sistema conectado ao Google Sheets</p>
                </div>
            `;
        }

        // Load students
        function loadStudents() {
            const tbody = document.getElementById('studentsTableBody');
            tbody.innerHTML = studentsData.map(student => `
                <tr>
                    <td>${student.ra}</td>
                    <td>${student.nome}</td>
                    <td>${student.email}</td>
                    <td>${student.curso}</td>
                    <td><span class="status-badge status-${student.status.toLowerCase()}">${student.status}</span></td>
                    <td>
                        <button class="btn btn-small" onclick="editStudent(${student.id})">Editar</button>
                        <button class="btn btn-danger btn-small" onclick="deleteStudent(${student.id})">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        // Load teachers
        function loadTeachers() {
            const tbody = document.getElementById('teachersTableBody');
            tbody.innerHTML = teachersData.map(teacher => `
                <tr>
                    <td>${teacher.nome}</td>
                    <td>${teacher.email}</td>
                    <td>${teacher.disciplinas}</td>
                    <td>
                        <button class="btn btn-small" onclick="editTeacher(${teacher.id})">Editar</button>
                        <button class="btn btn-danger btn-small" onclick="deleteTeacher(${teacher.id})">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        // Load classes
        function loadClasses() {
            const grid = document.getElementById('classesGrid');
            grid.innerHTML = classesData.map(classItem => `
                <div class="card">
                    <h3 class="card-title">${classItem.nome}</h3>
                    <p><strong>Curso:</strong> ${classItem.curso}</p>
                    <p><strong>Hor√°rio:</strong> ${classItem.horario}</p>
                    <p><strong>Alunos:</strong> ${classItem.matriculados}/${classItem.capacidade}</p>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-small" onclick="editClass(${classItem.id})">Editar</button>
                        <button class="btn btn-danger btn-small" onclick="deleteClass(${classItem.id})">Excluir</button>
                    </div>
                </div>
            `).join('');
        }

        // Load configuration
        function loadConfiguration() {
            const apiUrl = localStorage.getItem('sheetsApiUrl') || '';
            document.getElementById('sheetsApiUrl').value = apiUrl;
        }

        // Save configuration
        function saveConfiguration() {
            const apiUrl = document.getElementById('sheetsApiUrl').value.trim();
            
            if (!apiUrl) {
                showNotification('Por favor, insira a URL do Google Apps Script!', 'error');
                return;
            }
            
            localStorage.setItem('sheetsApiUrl', apiUrl);
            CONFIG.SHEETS_API_URL = apiUrl;
            
            showNotification('Configura√ß√£o salva com sucesso!', 'success');
        }

        // Test connection
        async function testConnection() {
            const apiUrl = document.getElementById('sheetsApiUrl').value.trim();
            
            if (!apiUrl) {
                showNotification('Por favor, configure a URL primeiro!', 'error');
                return;
            }
            
            try {
                const response = await fetch(apiUrl + '?action=test');
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Conex√£o estabelecida com sucesso!', 'success');
                    
                    const configResult = document.getElementById('configResult');
                    configResult.innerHTML = `
                        <div style="background: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 15px; border-radius: 8px; margin-top: 20px;">
                            <h4>‚úÖ Conex√£o Estabelecida!</h4>
                            <p><strong>Planilha conectada:</strong> ${result.spreadsheetName || 'SGE Database'}</p>
                            <p>Sistema pronto para uso!</p>
                        </div>
                    `;
                } else {
                    showNotification('Erro na conex√£o: ' + result.error, 'error');
                }
            } catch (error) {
                showNotification('Erro ao testar conex√£o: ' + error.message, 'error');
            }
        }

        // Save student
        async function saveStudent() {
            const isEditing = document.getElementById('editingStudentId').value;
            const studentData = {
                nome: document.getElementById('studentName').value,
                email: document.getElementById('studentEmail').value,
                telefone: document.getElementById('studentPhone').value,
                cpf: document.getElementById('studentCPF').value,
                curso: document.getElementById('studentCourse').value
            };

            if (!studentData.nome || !studentData.email || !studentData.curso) {
                showNotification('Preencha todos os campos obrigat√≥rios!', 'error');
                return;
            }

            if (CONFIG.SHEETS_API_URL) {
                // Save to Google Sheets
                try {
                    const response = await fetch(CONFIG.SHEETS_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: isEditing ? 'update' : 'write',
                            sheet: CONFIG.SHEETS.STUDENTS,
                            ...studentData,
                            ...(isEditing && { id: parseInt(isEditing) })
                        })
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        showNotification(isEditing ? 'Aluno atualizado com sucesso!' : 'Aluno cadastrado com sucesso!', 'success');
                        closeModal('studentModal');
                        loadStudentsFromAPI();
                        clearStudentForm();
                    } else {
                        showNotification('Erro ao salvar: ' + result.error, 'error');
                    }
                } catch (error) {
                    showNotification('Erro de conex√£o!', 'error');
                }
            } else {
                // Save locally (demo mode)
                if (isEditing) {
                    const student = studentsData.find(s => s.id == isEditing);
                    Object.assign(student, studentData);
                } else {
                    const newStudent = {
                        id: studentsData.length + 1,
                        ra: `ALU${String(studentsData.length + 1).padStart(3, '0')}`,
                        status: 'Matriculado',
                        ...studentData
                    };
                    studentsData.push(newStudent);
                }
                
                showNotification(isEditing ? 'Aluno atualizado!' : 'Aluno cadastrado!', 'success');
                closeModal('studentModal');
                loadStudents();
                clearStudentForm();
            }
        }

        // Save teacher
        async function saveTeacher() {
            const isEditing = document.getElementById('editingTeacherId').value;
            const teacherData = {
                nome: document.getElementById('teacherName').value,
                email: document.getElementById('teacherEmail').value,
                telefone: document.getElementById('teacherPhone').value,
                cpf: document.getElementById('teacherCPF').value,
                disciplinas: document.getElementById('teacherSubjects').value
            };

            if (!teacherData.nome || !teacherData.email) {
                showNotification('Preencha todos os campos obrigat√≥rios!', 'error');
                return;
            }

            if (CONFIG.SHEETS_API_URL) {
                // Save to Google Sheets
                try {
                    const response = await fetch(CONFIG.SHEETS_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: isEditing ? 'update' : 'write',
                            sheet: CONFIG.SHEETS.TEACHERS,
                            ...teacherData,
                            ...(isEditing && { id: parseInt(isEditing) })
                        })
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        showNotification(isEditing ? 'Professor atualizado!' : 'Professor cadastrado!', 'success');
                        closeModal('teacherModal');
                        loadTeachersFromAPI();
                        clearTeacherForm();
                    } else {
                        showNotification('Erro ao salvar: ' + result.error, 'error');
                    }
                } catch (error) {
                    showNotification('Erro de conex√£o!', 'error');
                }
            } else {
                // Save locally (demo mode)
                if (isEditing) {
                    const teacher = teachersData.find(t => t.id == isEditing);
                    Object.assign(teacher, teacherData);
                } else {
                    const newTeacher = {
                        id: teachersData.length + 1,
                        ...teacherData
                    };
                    teachersData.push(newTeacher);
                }
                
                showNotification(isEditing ? 'Professor atualizado!' : 'Professor cadastrado!', 'success');
                closeModal('teacherModal');
                loadTeachers();
                clearTeacherForm();
            }
        }

        // Save class
        async function saveClass() {
            const isEditing = document.getElementById('editingClassId').value;
            const classData = {
                nome: document.getElementById('className').value,
                curso: document.getElementById('classCourse').value,
                horario: document.getElementById('classSchedule').value,
                capacidade: parseInt(document.getElementById('classCapacity').value)
            };

            if (!classData.nome || !classData.curso) {
                showNotification('Preencha todos os campos obrigat√≥rios!', 'error');
                return;
            }

            if (CONFIG.SHEETS_API_URL) {
                // Save to Google Sheets
                try {
                    const response = await fetch(CONFIG.SHEETS_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: isEditing ? 'update' : 'write',
                            sheet: CONFIG.SHEETS.CLASSES,
                            ...classData,
                            matriculados: 0,
                            ...(isEditing && { id: parseInt(isEditing) })
                        })
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        showNotification(isEditing ? 'Turma atualizada!' : 'Turma criada!', 'success');
                        closeModal('classModal');
                        loadClassesFromAPI();
                        clearClassForm();
                    } else {
                        showNotification('Erro ao salvar: ' + result.error, 'error');
                    }
                } catch (error) {
                    showNotification('Erro de conex√£o!', 'error');
                }
            } else {
                // Save locally (demo mode)
                if (isEditing) {
                    const classItem = classesData.find(c => c.id == isEditing);
                    Object.assign(classItem, classData);
                } else {
                    const newClass = {
                        id: classesData.length + 1,
                        matriculados: 0,
                        ...classData
                    };
                    classesData.push(newClass);
                }
                
                showNotification(isEditing ? 'Turma atualizada!' : 'Turma criada!', 'success');
                closeModal('classModal');
                loadClasses();
                clearClassForm();
            }
        }

        // Load data from API
        async function loadStudentsFromAPI() {
            if (!CONFIG.SHEETS_API_URL) return;
            
            try {
                const response = await fetch(CONFIG.SHEETS_API_URL + '?action=read&sheet=' + CONFIG.SHEETS.STUDENTS);
                const result = await response.json();
                
                if (result.success) {
                    studentsData = result.data;
                    loadStudents();
                }
            } catch (error) {
                console.error('Erro ao carregar alunos:', error);
            }
        }

        async function loadTeachersFromAPI() {
            if (!CONFIG.SHEETS_API_URL) return;
            
            try {
                const response = await fetch(CONFIG.SHEETS_API_URL + '?action=read&sheet=' + CONFIG.SHEETS.TEACHERS);
                const result = await response.json();
                
                if (result.success) {
                    teachersData = result.data;
                    loadTeachers();
                }
            } catch (error) {
                console.error('Erro ao carregar professores:', error);
            }
        }

        async function loadClassesFromAPI() {
            if (!CONFIG.SHEETS_API_URL) return;
            
            try {
                const response = await fetch(CONFIG.SHEETS_API_URL + '?action=read&sheet=' + CONFIG.SHEETS.CLASSES);
                const result = await response.json();
                
                if (result.success) {
                    classesData = result.data;
                    loadClasses();
                }
            } catch (error) {
                console.error('Erro ao carregar turmas:', error);
            }
        }

        // Edit functions
        function editStudent(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            if (!student) return;

            document.getElementById('studentModalTitle').textContent = 'Editar Aluno';
            document.getElementById('studentName').value = student.nome;
            document.getElementById('studentEmail').value = student.email;
            document.getElementById('studentPhone').value = student.telefone;
            document.getElementById('studentCPF').value = student.cpf;
            document.getElementById('studentCourse').value = student.curso;
            document.getElementById('editingStudentId').value = student.id;

            openModal('studentModal');
        }

        function editTeacher(teacherId) {
            const teacher = teachersData.find(t => t.id === teacherId);
            if (!teacher) return;

            document.getElementById('teacherModalTitle').textContent = 'Editar Professor';
            document.getElementById('teacherName').value = teacher.nome;
            document.getElementById('teacherEmail').value = teacher.email;
            document.getElementById('teacherPhone').value = teacher.telefone;
            document.getElementById('teacherCPF').value = teacher.cpf;
            document.getElementById('teacherSubjects').value = teacher.disciplinas;
            document.getElementById('editingTeacherId').value = teacher.id;

            openModal('teacherModal');
        }

        function editClass(classId) {
            const classItem = classesData.find(c => c.id === classId);
            if (!classItem) return;

            document.getElementById('classModalTitle').textContent = 'Editar Turma';
            document.getElementById('className').value = classItem.nome;
            document.getElementById('classCourse').value = classItem.curso;
            document.getElementById('classSchedule').value = classItem.horario;
            document.getElementById('classCapacity').value = classItem.capacidade;
            document.getElementById('editingClassId').value = classItem.id;

            openModal('classModal');
        }

        // Delete functions
        async function deleteStudent(studentId) {
            if (!confirm('Tem certeza que deseja excluir este aluno?')) return;

            if (CONFIG.SHEETS_API_URL) {
                try {
                    const response = await fetch(CONFIG.SHEETS_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'delete',
                            sheet: CONFIG.SHEETS.STUDENTS,
                            id: studentId
                        })
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        showNotification('Aluno exclu√≠do com sucesso!', 'success');
                        loadStudentsFromAPI();
                    } else {
                        showNotification('Erro ao excluir: ' + result.error, 'error');
                    }
                } catch (error) {
                    showNotification('Erro de conex√£o!', 'error');
                }
            } else {
                studentsData = studentsData.filter(s => s.id !== studentId);
                loadStudents();
                showNotification('Aluno exclu√≠do!', 'success');
            }
        }

        async function deleteTeacher(teacherId) {
            if (!confirm('Tem certeza que deseja excluir este professor?')) return;

            if (CONFIG.SHEETS_API_URL) {
                try {
                    const response = await fetch(CONFIG.SHEETS_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'delete',
                            sheet: CONFIG.SHEETS.TEACHERS,
                            id: teacherId
                        })
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        showNotification('Professor exclu√≠do com sucesso!', 'success');
                        loadTeachersFromAPI();
                    } else {
                        showNotification('Erro ao excluir: ' + result.error, 'error');
                    }
                } catch (error) {
                    showNotification('Erro de conex√£o!', 'error');
                }
            } else {
                teachersData = teachersData.filter(t => t.id !== teacherId);
                loadTeachers();
                showNotification('Professor exclu√≠do!', 'success');
            }
        }

        async function deleteClass(classId) {
            if (!confirm('Tem certeza que deseja excluir esta turma?')) return;

            if (CONFIG.SHEETS_API_URL) {
                try {
                    const response = await fetch(CONFIG.SHEETS_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'delete',
                            sheet: CONFIG.SHEETS.CLASSES,
                            id: classId
                        })
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        showNotification('Turma exclu√≠da com sucesso!', 'success');
                        loadClassesFromAPI();
                    } else {
                        showNotification('Erro ao excluir: ' + result.error, 'error');
                    }
                } catch (error) {
                    showNotification('Erro de conex√£o!', 'error');
                }
            } else {
                classesData = classesData.filter(c => c.id !== classId);
                loadClasses();
                showNotification('Turma exclu√≠da!', 'success');
            }
        }

        // Clear form functions
        function clearStudentForm() {
            document.getElementById('studentName').value = '';
            document.getElementById('studentEmail').value = '';
            document.getElementById('studentPhone').value = '';
            document.getElementById('studentCPF').value = '';
            document.getElementById('studentCourse').value = '';
            document.getElementById('editingStudentId').value = '';
            document.getElementById('studentModalTitle').textContent = 'Cadastro de Aluno';
        }

        function clearTeacherForm() {
            document.getElementById('teacherName').value = '';
            document.getElementById('teacherEmail').value = '';
            document.getElementById('teacherPhone').value = '';
            document.getElementById('teacherCPF').value = '';
            document.getElementById('teacherSubjects').value = '';
            document.getElementById('editingTeacherId').value = '';
            document.getElementById('teacherModalTitle').textContent = 'Cadastro de Professor';
        }

        function clearClassForm() {
            document.getElementById('className').value = '';
            document.getElementById('classCourse').value = '';
            document.getElementById('classSchedule').value = '';
            document.getElementById('classCapacity').value = '20';
            document.getElementById('editingClassId').value = '';
            document.getElementById('classModalTitle').textContent = 'Criar Nova Turma';
        }

        // Utility functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            
            // Clear forms when closing
            if (modalId === 'studentModal') clearStudentForm();
            else if (modalId === 'teacherModal') clearTeacherForm();
            else if (modalId === 'classModal') clearClassForm();
        }

        function searchTable(tableId, searchTerm) {
            const table = document.getElementById(tableId);
            const rows = table.getElementsByTagName('tr');
            
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm.toLowerCase()) ? '' : 'none';
            }
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('mainApp').style.display = 'none';
            
            // Add enter key support for login
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });

            // Close modals when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });

            // Load saved configuration
            const savedApiUrl = localStorage.getItem('sheetsApiUrl');
            if (savedApiUrl) {
                CONFIG.SHEETS_API_URL = savedApiUrl;
            }
        });
    </script>
</body>
</html>
