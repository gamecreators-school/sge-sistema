<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameCreators - Sistema de Gest√£o</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .login-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .main-app {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 5px;
        }

        .nav-tab {
            padding: 12px 20px;
            background: #f5f5f5;
            border: none;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 14px;
        }

        .nav-tab.active {
            background: #2196F3;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2196F3;
        }

        .btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: #1976D2;
        }

        .btn-secondary { background: #FF9800; }
        .btn-danger { background: #f44336; }
        .btn-success { background: #4CAF50; }
        .btn-warning { background: #FF9800; }
        .btn-info { background: #2196F3; }
        .btn-small { padding: 6px 12px; font-size: 12px; }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .table th {
            background: #f5f5f5;
            font-weight: 600;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
        }

        .modal-content {
            background: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10001;
            transform: translateX(400px);
            transition: transform 0.3s;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: #4CAF50; }
        .notification.error { background: #f44336; }
        .notification.info { background: #2196F3; }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-size: 12px;
            font-weight: 500;
        }

        .status-ativo { background: #4CAF50; }
        .status-inadimplente { background: #f44336; }
        .status-cancelado { background: #9E9E9E; }
        .status-trancado { background: #FF9800; }
        .status-formado { background: #4CAF50; }
        .status-pago { background: #4CAF50; }
        .status-pendente { background: #FF9800; }
        .status-vencido { background: #f44336; }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            transition: width 0.3s;
        }

        .document-preview {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 30px;
            margin: 20px 0;
            font-family: 'Times New Roman', serif;
            line-height: 1.6;
        }

        .document-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #333;
            padding-bottom: 20px;
        }

        .points-display {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
        }

        .achievement-badge {
            background: #4CAF50;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin: 2px;
            display: inline-block;
        }

        .store-item {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .store-item:hover {
            border-color: #2196F3;
            background: #f8f9ff;
        }

        .commission-card {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .turma-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
        }

        .turma-card:hover {
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .turma-students {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        .student-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            margin: 5px 0;
            border-radius: 5px;
        }

        .attendance-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #e0e0e0;
            margin: 5px 0;
            border-radius: 8px;
        }

        .attendance-controls {
            display: flex;
            gap: 10px;
        }

        .attendance-controls label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .boleto-item {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .mission-card {
            background: #f0f8ff;
            border: 2px solid #2196F3;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .inventory-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid #e0e0e0;
            margin: 5px 0;
            border-radius: 6px;
            background: #f9f9f9;
        }

        .cash-flow-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-left: 4px solid #2196F3;
            background: #f8f9fa;
            margin: 8px 0;
            border-radius: 0 6px 6px 0;
        }

        .cash-flow-item.expense {
            border-left-color: #f44336;
        }

        .level-indicator {
            background: linear-gradient(135deg, #9C27B0, #673AB7);
            color: white;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            margin: 10px 0;
        }

        .hidden { display: none !important; }

        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .nav-tabs { flex-direction: column; }
            .nav-tab { border-radius: 8px; margin-bottom: 5px; }
        }

        @media print {
            body * { visibility: hidden; }
            .document-preview, .document-preview * { visibility: visible; }
            .document-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <h1 style="color: #2196F3; margin-bottom: 30px;">GameCreators</h1>
            <h2 style="color: #666; margin-bottom: 30px;">Sistema de Gest√£o</h2>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" placeholder="Digite seu email">
            </div>
            <div class="form-group">
                <label for="password">Senha:</label>
                <input type="password" id="password" placeholder="Digite sua senha">
            </div>
            <button class="btn" onclick="login()">Entrar</button>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app">
        <div class="header">
            <div>
                <h1>GameCreators - Sistema de Gest√£o</h1>
                <p id="userWelcome">Bem-vindo!</p>
            </div>
            <button class="btn" onclick="logout()" style="background: #f44336;">Sair</button>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs" id="navTabs"></div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div id="alerts"></div>
            <div class="stats-grid" id="statsGrid"></div>
            <div class="card">
                <h3 class="card-title">Resumo Financeiro</h3>
                <div class="grid-3">
                    <div class="stat-card" style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);">
                        <div class="stat-number" id="totalReceita">R$ 0,00</div>
                        <div class="stat-label">Receita Total</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);">
                        <div class="stat-number" id="totalVencido">R$ 0,00</div>
                        <div class="stat-label">Vencidos</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);">
                        <div class="stat-number" id="totalPendente">R$ 0,00</div>
                        <div class="stat-label">Pendentes</div>
                    </div>
                </div>
            </div>
            <div class="card">
                <h3 class="card-title">Atividades Recentes</h3>
                <div id="recentActivities"></div>
            </div>
        </div>

        <!-- Students Tab -->
        <div id="students" class="tab-content">
            <div class="action-buttons">
                <h2>Gest√£o de Participantes</h2>
                <button class="btn" onclick="openModal('studentModal')">Novo Participante</button>
                <button class="btn btn-secondary" onclick="openModal('advancedSearchModal')">üîç Busca</button>
                <button class="btn btn-warning" onclick="openModal('statusModal')">Alterar Status</button>
            </div>
            <input type="text" id="studentSearch" placeholder="Buscar participante..." onkeyup="searchTable(this.value)" style="width: 300px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 20px;">
            <table class="table" id="studentsTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Email</th>
                        <th>Curso</th>
                        <th>Turma</th>
                        <th>Status</th>
                        <th>Progresso</th>
                        <th>Pontos</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="studentsTableBody"></tbody>
            </table>
        </div>

        <!-- Classes Tab -->
        <div id="turmas" class="tab-content">
            <div class="action-buttons">
                <h2>Gest√£o de Turmas</h2>
                <button class="btn" onclick="openModal('turmaModal')">Nova Turma</button>
            </div>
            <div id="turmasContainer"></div>
        </div>

        <!-- Financial Tab -->
        <div id="financeiro" class="tab-content">
            <h2>Controle Financeiro</h2>
            <div class="stats-grid">
                <div class="stat-card" style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);">
                    <div class="stat-number" id="totalReceita2">R$ 0,00</div>
                    <div class="stat-label">Receita Total</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);">
                    <div class="stat-number" id="totalVencido2">R$ 0,00</div>
                    <div class="stat-label">Vencidos</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);">
                    <div class="stat-number" id="totalPendente2">R$ 0,00</div>
                    <div class="stat-label">Pendentes</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);">
                    <div class="stat-number" id="proximoMes">R$ 0,00</div>
                    <div class="stat-label">Pr√≥ximo M√™s</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn" onclick="openModal('paymentModal')">Registrar Pagamento</button>
                <button class="btn btn-secondary" onclick="generateFinancialReport()">Relat√≥rio</button>
                <button class="btn btn-success" onclick="openModal('boletoModal')">Gerar Boleto</button>
                <button class="btn btn-info" onclick="openModal('cashFlowModal')">Fluxo de Caixa</button>
                <button class="btn btn-warning" onclick="openModal('inventoryModal')">Estoque</button>
            </div>

            <div class="grid-2">
                <div class="card">
                    <h3 class="card-title">Controle de Pagamentos</h3>
                    <table class="table" id="paymentsTable">
                        <thead>
                            <tr>
                                <th>Participante</th>
                                <th>Parcela</th>
                                <th>Valor</th>
                                <th>Vencimento</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="paymentsTableBody"></tbody>
                    </table>
                </div>

                <div class="card">
                    <h3 class="card-title">Boletos</h3>
                    <div id="boletosContainer"></div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Fluxo de Caixa</h3>
                <div id="cashFlowContainer"></div>
            </div>
        </div>

        <!-- Documents Tab -->
        <div id="documentos" class="tab-content">
            <h2>Documentos e Contratos</h2>
            <div class="action-buttons">
                <button class="btn" onclick="openModal('documentModal')">Gerar Documento</button>
                <button class="btn btn-secondary" onclick="openModal('templateModal')">Templates</button>
            </div>
            <div id="documentPreview"></div>
        </div>

        <!-- Progress Tab -->
        <div id="progresso" class="tab-content">
            <h2>Acompanhamento Acad√™mico</h2>
            <div class="action-buttons">
                <button class="btn" onclick="openModal('progressModal')">Atualizar Progresso</button>
                <button class="btn btn-secondary" onclick="generateProgressReport()">Relat√≥rio</button>
            </div>
            <div id="progressContainer"></div>
        </div>

        <!-- Attendance Tab -->
        <div id="chamada" class="tab-content">
            <h2>Controle de Presen√ßa</h2>
            <div class="card">
                <h3 class="card-title">Chamada da Turma</h3>
                <div class="grid-3">
                    <div class="form-group">
                        <label>Turma:</label>
                        <select id="attendanceClass">
                            <option value="">Selecione uma turma</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Data:</label>
                        <input type="date" id="attendanceDate">
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="btn" onclick="loadAttendanceList()">Carregar Lista</button>
                    </div>
                </div>
            </div>
            <div id="attendanceList" class="card hidden">
                <h3 class="card-title">Lista de Presen√ßa</h3>
                <div id="attendanceStudents"></div>
                <button class="btn" onclick="saveAttendance()">Salvar Presen√ßa</button>
            </div>
            <div class="card">
                <h3 class="card-title">Relat√≥rio de Frequ√™ncia</h3>
                <div id="attendanceReport"></div>
            </div>
        </div>

        <!-- Gamification Tab -->
        <div id="gamificacao" class="tab-content">
            <h2>Sistema de Gamifica√ß√£o</h2>
            
            <div class="grid-2">
                <div class="card">
                    <h3 class="card-title">Ranking Geral</h3>
                    <div id="rankingList"></div>
                </div>
                
                <div class="card">
                    <h3 class="card-title">Miss√µes Ativas</h3>
                    <div class="action-buttons">
                        <button class="btn" onclick="openModal('missionModal')">Nova Miss√£o</button>
                        <button class="btn btn-secondary" onclick="openModal('pointsModal')">Dar Pontos</button>
                    </div>
                    <div id="missionsList"></div>
                </div>
            </div>
            
            <div class="card">
                <h3 class="card-title">Loja de Recompensas</h3>
                <div class="action-buttons">
                    <button class="btn" onclick="openModal('storeItemModal')">Novo Item</button>
                </div>
                <div id="storeItems"></div>
            </div>
        </div>

        <!-- Commission Tab -->
        <div id="comissoes" class="tab-content">
            <h2>Sistema de Comiss√µes</h2>
            <div class="action-buttons">
                <button class="btn" onclick="openModal('commissionModal')">Nova Comiss√£o</button>
                <button class="btn btn-secondary" onclick="calculateCommissions()">Calcular Per√≠odo</button>
            </div>
            
            <div class="grid-2">
                <div class="card">
                    <h3 class="card-title">Comiss√µes por Vendedor</h3>
                    <div id="commissionsList"></div>
                </div>
                
                <div class="card">
                    <h3 class="card-title">Resumo do Per√≠odo</h3>
                    <div id="commissionSummary"></div>
                </div>
            </div>
        </div>

        <!-- Configuration Tab -->
        <div id="configuracao" class="tab-content">
            <div class="card">
                <h3 class="card-title">‚öôÔ∏è Configura√ß√µes</h3>
                
                <h4>Cursos Dispon√≠veis</h4>
                <div id="coursesList"></div>
                <div style="margin-top: 10px;">
                    <input type="text" id="newCourse" placeholder="Nome do novo curso" style="width: 300px;">
                    <button class="btn" onclick="addCourse()">Adicionar</button>
                </div>

                <h4 style="margin-top: 30px;">Backup e Restore</h4>
                <div class="action-buttons">
                    <button class="btn" onclick="exportData()">üì• Exportar Dados</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì§ Importar Dados</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                </div>
            </div>
        </div>
    </div>

    <!-- Student Modal -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('studentModal')">&times;</span>
            <h2 id="studentModalTitle">Cadastro de Participante</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Nome Completo: *</label>
                    <input type="text" id="studentName" required>
                </div>
                <div class="form-group">
                    <label>Email: *</label>
                    <input type="email" id="studentEmail" required>
                </div>
                <div class="form-group">
                    <label>Telefone:</label>
                    <input type="tel" id="studentPhone">
                </div>
                <div class="form-group">
                    <label>CPF:</label>
                    <input type="text" id="studentCPF">
                </div>
                <div class="form-group">
                    <label>Data de Nascimento:</label>
                    <input type="date" id="studentBirth">
                </div>
                <div class="form-group">
                    <label>Curso: *</label>
                    <select id="studentCourse" required>
                        <option value="">Selecione um curso</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Turma: *</label>
                    <select id="studentTurma" required>
                        <option value="">Selecione uma turma</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Vendedor:</label>
                    <select id="studentVendedor">
                        <option value="">Selecione um vendedor</option>
                        <option value="vendedor1">Jo√£o Vendedor</option>
                        <option value="vendedor2">Maria Vendedora</option>
                        <option value="gerente1">Carlos Gerente</option>
                    </select>
                </div>
            </div>
            
            <h3>Respons√°vel Financeiro</h3>
            <div class="grid-2">
                <div class="form-group">
                    <label>Nome do Respons√°vel: *</label>
                    <input type="text" id="responsibleName" required>
                </div>
                <div class="form-group">
                    <label>Email do Respons√°vel: *</label>
                    <input type="email" id="responsibleEmail" required>
                </div>
                <div class="form-group">
                    <label>Telefone:</label>
                    <input type="tel" id="responsiblePhone">
                </div>
                <div class="form-group">
                    <label>CPF:</label>
                    <input type="text" id="responsibleCPF">
                </div>
            </div>
            
            <h3>Dados do Contrato</h3>
            <div class="grid-3">
                <div class="form-group">
                    <label>Valor Total: *</label>
                    <input type="number" id="contractValue" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Forma de Pagamento:</label>
                    <select id="paymentMethod">
                        <option value="avista">√Ä Vista</option>
                        <option value="parcelado">Parcelado</option>
                        <option value="cartao">Cart√£o</option>
                        <option value="boleto">Boleto</option>
                        <option value="semestral">Semestral</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>N√∫mero de Parcelas:</label>
                    <input type="number" id="installments" value="1" min="1" max="24">
                </div>
                <div class="form-group">
                    <label>Data de In√≠cio:</label>
                    <input type="date" id="contractStartDate">
                </div>
                <div class="form-group">
                    <label>Dura√ß√£o (meses):</label>
                    <input type="number" id="contractDuration" value="12" min="1" max="36">
                </div>
                <div class="form-group">
                    <label>M√≥dulo Atual:</label>
                    <input type="text" id="currentModule" placeholder="Ex: M√≥dulo 1">
                </div>
            </div>
            
            <button class="btn" onclick="saveStudent()">Salvar Participante</button>
            <input type="hidden" id="editingStudentId">
        </div>
    </div>

    <!-- Turma Modal -->
    <div id="turmaModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('turmaModal')">&times;</span>
            <h2 id="turmaModalTitle">Nova Turma</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Nome da Turma:</label>
                    <input type="text" id="turmaName">
                </div>
                <div class="form-group">
                    <label>Curso:</label>
                    <select id="turmaCourse">
                        <option value="">Selecione um curso</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Data de In√≠cio:</label>
                    <input type="date" id="turmaStart">
                </div>
                <div class="form-group">
                    <label>Data de Fim:</label>
                    <input type="date" id="turmaEnd">
                </div>
                <div class="form-group">
                    <label>Hor√°rio:</label>
                    <input type="time" id="turmaHorario">
                </div>
                <div class="form-group">
                    <label>Dias da Semana:</label>
                    <select id="turmaDias" multiple>
                        <option value="segunda">Segunda</option>
                        <option value="terca">Ter√ßa</option>
                        <option value="quarta">Quarta</option>
                        <option value="quinta">Quinta</option>
                        <option value="sexta">Sexta</option>
                        <option value="sabado">S√°bado</option>
                    </select>
                </div>
            </div>
            <button class="btn" onclick="saveTurma()">Salvar</button>
            <input type="hidden" id="editingTurmaId">
        </div>
    </div>

    <!-- Edit Student in Turma Modal -->
    <div id="editTurmaStudentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editTurmaStudentModal')">&times;</span>
            <h2>Editar Aluno na Turma</h2>
            <div class="form-group">
                <label>Nome:</label>
                <input type="text" id="editTurmaStudentName" readonly>
            </div>
            <div class="form-group">
                <label>Nova Turma:</label>
                <select id="editTurmaStudentNewTurma">
                    <option value="">Selecione uma turma</option>
                </select>
            </div>
            <div class="action-buttons">
                <button class="btn" onclick="saveStudentTurmaEdit()">Salvar</button>
                <button class="btn btn-warning" onclick="transferStudent()">Transferir</button>
                <button class="btn btn-danger" onclick="removeStudentFromTurma()">Remover da Turma</button>
            </div>
            <input type="hidden" id="editTurmaStudentId">
        </div>
    </div>

    <!-- Advanced Search Modal -->
    <div id="advancedSearchModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('advancedSearchModal')">&times;</span>
            <h2>Busca Avan√ßada</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Nome:</label>
                    <input type="text" id="searchName">
                </div>
                <div class="form-group">
                    <label>Status:</label>
                    <select id="searchStatus">
                        <option value="">Todos</option>
                        <option value="ativo">Ativo</option>
                        <option value="trancado">Trancado</option>
                        <option value="cancelado">Cancelado</option>
                        <option value="formado">Formado</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Curso:</label>
                    <select id="searchCourse">
                        <option value="">Todos</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Situa√ß√£o Financeira:</label>
                    <select id="searchFinancial">
                        <option value="">Todas</option>
                        <option value="pago">Em Dia</option>
                        <option value="pendente">Pendente</option>
                        <option value="vencido">Vencido</option>
                    </select>
                </div>
            </div>
            <button class="btn" onclick="performAdvancedSearch()">Buscar</button>
            <button class="btn btn-secondary" onclick="clearAdvancedSearch()">Limpar</button>
        </div>
    </div>

    <!-- Document Generation Modal -->
    <div id="documentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('documentModal')">&times;</span>
            <h2>Gerar Documento</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Tipo de Documento:</label>
                    <select id="documentType">
                        <option value="declaracao">Declara√ß√£o</option>
                        <option value="trancamento">Trancamento</option>
                        <option value="cancelamento">Cancelamento</option>
                        <option value="contrato">Contrato</option>
                        <option value="certificado">Certificado</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Participante:</label>
                    <select id="documentStudent">
                        <option value="">Selecione um participante</option>
                    </select>
                </div>
            </div>
            <button class="btn" onclick="generateDocument()">Gerar</button>
        </div>
    </div>

    <!-- Template Modal -->
    <div id="templateModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('templateModal')">&times;</span>
            <h2>Templates de Documentos</h2>
            <div class="card">
                <h4>Templates Dispon√≠veis</h4>
                <div class="action-buttons">
                    <button class="btn" onclick="useTemplate('contrato')">Usar Template de Contrato</button>
                    <button class="btn" onclick="useTemplate('declaracao')">Usar Template de Declara√ß√£o</button>
                    <button class="btn" onclick="useTemplate('certificado')">Usar Template de Certificado</button>
                </div>
            </div>
            <div class="form-group">
                <label>Personalizar Template:</label>
                <textarea id="templateContent" rows="10" placeholder="Digite o conte√∫do do template..."></textarea>
            </div>
            <button class="btn" onclick="saveTemplate()">Salvar Template</button>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('paymentModal')">&times;</span>
            <h2>Registrar Pagamento</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Participante:</label>
                    <select id="paymentStudent">
                        <option value="">Selecione um participante</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Valor:</label>
                    <input type="number" id="paymentValue" step="0.01">
                </div>
                <div class="form-group">
                    <label>Data do Pagamento:</label>
                    <input type="date" id="paymentDate">
                </div>
                <div class="form-group">
                    <label>M√©todo:</label>
                    <select id="paymentMethodPayment">
                        <option value="dinheiro">Dinheiro</option>
                        <option value="cartao">Cart√£o</option>
                        <option value="pix">PIX</option>
                        <option value="transferencia">Transfer√™ncia</option>
                        <option value="boleto">Boleto</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Observa√ß√µes:</label>
                <textarea id="paymentNotes" rows="3"></textarea>
            </div>
            <button class="btn" onclick="savePayment()">Salvar</button>
        </div>
    </div>

    <!-- Boleto Modal -->
    <div id="boletoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('boletoModal')">&times;</span>
            <h2>Gerar Boleto</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Participante:</label>
                    <select id="boletoStudent">
                        <option value="">Selecione um participante</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Valor:</label>
                    <input type="number" id="boletoValue" step="0.01">
                </div>
                <div class="form-group">
                    <label>Data de Vencimento:</label>
                    <input type="date" id="boletoDueDate">
                </div>
                <div class="form-group">
                    <label>Parcela:</label>
                    <input type="number" id="boletoInstallment" min="1">
                </div>
            </div>
            <button class="btn" onclick="generateBoleto()">Gerar Boleto</button>
        </div>
    </div>

    <!-- Cash Flow Modal -->
    <div id="cashFlowModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('cashFlowModal')">&times;</span>
            <h2>Controle de Fluxo de Caixa</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Tipo:</label>
                    <select id="cashFlowType">
                        <option value="entrada">Entrada</option>
                        <option value="saida">Sa√≠da</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Valor:</label>
                    <input type="number" id="cashFlowValue" step="0.01">
                </div>
                <div class="form-group">
                    <label>Categoria:</label>
                    <select id="cashFlowCategory">
                        <option value="mensalidade">Mensalidade</option>
                        <option value="matricula">Matr√≠cula</option>
                        <option value="material">Material</option>
                        <option value="aluguel">Aluguel</option>
                        <option value="salario">Sal√°rio</option>
                        <option value="marketing">Marketing</option>
                        <option value="outros">Outros</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Data:</label>
                    <input type="date" id="cashFlowDate">
                </div>
            </div>
            <div class="form-group">
                <label>Descri√ß√£o:</label>
                <textarea id="cashFlowDescription" rows="3"></textarea>
            </div>
            <button class="btn" onclick="saveCashFlow()">Salvar</button>
        </div>
    </div>

    <!-- Inventory Modal -->
    <div id="inventoryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('inventoryModal')">&times;</span>
            <h2>Controle de Estoque</h2>
            <div class="action-buttons">
                <button class="btn" onclick="openModal('addProductModal')">Adicionar Produto</button>
                <button class="btn btn-secondary" onclick="openModal('saleModal')">Registrar Venda</button>
            </div>
            <div id="inventoryList"></div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addProductModal')">&times;</span>
            <h2>Adicionar Produto</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Nome do Produto:</label>
                    <input type="text" id="productName">
                </div>
                <div class="form-group">
                    <label>Pre√ßo:</label>
                    <input type="number" id="productPrice" step="0.01">
                </div>
                <div class="form-group">
                    <label>Quantidade:</label>
                    <input type="number" id="productQuantity" min="0">
                </div>
                <div class="form-group">
                    <label>Categoria:</label>
                    <select id="productCategory">
                        <option value="bebida">Bebida</option>
                        <option value="snack">Snack</option>
                        <option value="material">Material</option>
                        <option value="servico">Servi√ßo</option>
                    </select>
                </div>
            </div>
            <button class="btn" onclick="saveProduct()">Salvar Produto</button>
        </div>
    </div>

    <!-- Sale Modal -->
    <div id="saleModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('saleModal')">&times;</span>
            <h2>Registrar Venda</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Produto:</label>
                    <select id="saleProduct">
                        <option value="">Selecione um produto</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Quantidade:</label>
                    <input type="number" id="saleQuantity" min="1" value="1">
                </div>
                <div class="form-group">
                    <label>Vendedor:</label>
                    <select id="saleVendedor">
                        <option value="">Selecione um vendedor</option>
                        <option value="vendedor1">Jo√£o Vendedor</option>
                        <option value="vendedor2">Maria Vendedora</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Data:</label>
                    <input type="date" id="saleDate">
                </div>
            </div>
            <button class="btn" onclick="saveSale()">Registrar Venda</button>
        </div>
    </div>

    <!-- Progress Modal -->
    <div id="progressModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('progressModal')">&times;</span>
            <h2>Atualizar Progresso</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Participante:</label>
                    <select id="progressStudent">
                        <option value="">Selecione um participante</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Progresso (%):</label>
                    <input type="number" id="progressValue" min="0" max="100">
                </div>
                <div class="form-group">
                    <label>M√≥dulo Atual:</label>
                    <input type="text" id="progressModule">
                </div>
                <div class="form-group">
                    <label>Aula Atual:</label>
                    <input type="text" id="progressLesson">
                </div>
            </div>
            <div class="form-group">
                <label>Observa√ß√µes:</label>
                <textarea id="progressNotes" rows="3"></textarea>
            </div>
            <button class="btn" onclick="saveProgress()">Salvar</button>
        </div>
    </div>

    <!-- Mission Modal -->
    <div id="missionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('missionModal')">&times;</span>
            <h2>Nova Miss√£o</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>T√≠tulo da Miss√£o:</label>
                    <input type="text" id="missionTitle">
                </div>
                <div class="form-group">
                    <label>Pontos de Recompensa:</label>
                    <input type="number" id="missionPoints" min="1">
                </div>
                <div class="form-group">
                    <label>Data de Expira√ß√£o:</label>
                    <input type="date" id="missionExpiry">
                </div>
                <div class="form-group">
                    <label>Tipo:</label>
                    <select id="missionType">
                        <option value="presenca">Presen√ßa</option>
                        <option value="entrega">Entrega de Projeto</option>
                        <option value="participacao">Participa√ß√£o</option>
                        <option value="nota">Nota M√≠nima</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Descri√ß√£o:</label>
                <textarea id="missionDescription" rows="3"></textarea>
            </div>
            <button class="btn" onclick="saveMission()">Criar Miss√£o</button>
        </div>
    </div>

    <!-- Points Modal -->
    <div id="pointsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('pointsModal')">&times;</span>
            <h2>Dar Pontos</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Participante:</label>
                    <select id="pointsStudent">
                        <option value="">Selecione um participante</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Pontos:</label>
                    <input type="number" id="pointsValue" min="1">
                </div>
            </div>
            <div class="form-group">
                <label>Motivo:</label>
                <input type="text" id="pointsReason" placeholder="Ex: Participa√ß√£o em aula">
            </div>
            <button class="btn" onclick="givePoints()">Dar Pontos</button>
        </div>
    </div>

    <!-- Store Item Modal -->
    <div id="storeItemModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('storeItemModal')">&times;</span>
            <h2>Novo Item da Loja</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Nome do Item:</label>
                    <input type="text" id="storeItemName">
                </div>
                <div class="form-group">
                    <label>Custo em Pontos:</label>
                    <input type="number" id="storeItemCost" min="1">
                </div>
                <div class="form-group">
                    <label>Categoria:</label>
                    <select id="storeItemCategory">
                        <option value="desconto">Desconto</option>
                        <option value="material">Material Extra</option>
                        <option value="certificado">Certificado</option>
                        <option value="brinde">Brinde</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Estoque:</label>
                    <input type="number" id="storeItemStock" min="0">
                </div>
            </div>
            <div class="form-group">
                <label>Descri√ß√£o:</label>
                <textarea id="storeItemDescription" rows="3"></textarea>
            </div>
            <button class="btn" onclick="saveStoreItem()">Salvar Item</button>
        </div>
    </div>

    <!-- Status Change Modal -->
    <div id="statusModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('statusModal')">&times;</span>
            <h2>Alterar Status</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Participante:</label>
                    <select id="statusStudent">
                        <option value="">Selecione um participante</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Novo Status:</label>
                    <select id="newStatus">
                        <option value="ativo">Ativo</option>
                        <option value="trancado">Trancado</option>
                        <option value="cancelado">Cancelado</option>
                        <option value="formado">Formado</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Motivo:</label>
                <textarea id="statusReason" rows="3"></textarea>
            </div>
            <button class="btn" onclick="changeStatus()">Alterar Status</button>
        </div>
    </div>

    <!-- Commission Modal -->
    <div id="commissionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('commissionModal')">&times;</span>
            <h2>Nova Comiss√£o</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Vendedor:</label>
                    <select id="commissionVendedor">
                        <option value="">Selecione um vendedor</option>
                        <option value="vendedor1">Jo√£o Vendedor</option>
                        <option value="vendedor2">Maria Vendedora</option>
                        <option value="gerente1">Carlos Gerente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Tipo:</label>
                    <select id="commissionType">
                        <option value="matricula">Matr√≠cula</option>
                        <option value="bonus_dia">B√¥nus Di√°rio</option>
                        <option value="blackin">Blackin</option>
                        <option value="black">Black</option>
                        <option value="faturamento">Faturamento</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Valor da Venda:</label>
                    <input type="number" id="commissionSaleValue" step="0.01">
                </div>
                <div class="form-group">
                    <label>Data:</label>
                    <input type="date" id="commissionDate">
                </div>
            </div>
            <button class="btn" onclick="saveCommission()">Salvar</button>
        </div>
    </div>

    <script>
        // Sistema de dados local
        const data = {
            students: [],
            courses: ['Desenvolvimento de Jogos', 'Design Gr√°fico', 'Programa√ß√£o Web', 'Mobile Development'],
            payments: [],
            turmas: [],
            attendance: [],
            achievements: [],
            missions: [],
            storeItems: [],
            commissions: [],
            cashFlow: [],
            inventory: [],
            sales: [],
            boletos: [],
            templates: {},
            currentUser: null
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            loadStoredData();
            initializeTabs();
            populateSelects();
            document.getElementById('attendanceDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('cashFlowDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('saleDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('commissionDate').value = new Date().toISOString().split('T')[0];
        });

        // Sistema de autentica√ß√£o
        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email) {
                showNotification('Por favor, digite um email', 'error');
                return;
            }
            
            if (password !== '123456') {
                showNotification('Senha incorreta', 'error');
                return;
            }
            
            data.currentUser = { email, name: email.split('@')[0] };
            document.getElementById('userWelcome').textContent = `Bem-vindo, ${data.currentUser.name}!`;
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            updateDashboard();
            loadStudentsTable();
            showNotification('Login realizado com sucesso!', 'success');
        }

        function logout() {
            data.currentUser = null;
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
        }

        // Sistema de tabs
        function initializeTabs() {
            const tabs = [
                { id: 'dashboard', label: 'üìä Dashboard' },
                { id: 'students', label: 'üë• Participantes' },
                { id: 'turmas', label: 'üè´ Turmas' },
                { id: 'financeiro', label: 'üí∞ Financeiro' },
                { id: 'documentos', label: 'üìÑ Documentos' },
                { id: 'progresso', label: 'üìà Progresso' },
                { id: 'chamada', label: '‚úÖ Chamada' },
                { id: 'gamificacao', label: 'üèÜ Gamifica√ß√£o' },
                { id: 'comissoes', label: 'üíº Comiss√µes' },
                { id: 'configuracao', label: '‚öôÔ∏è Config' }
            ];

            const tabsContainer = document.getElementById('navTabs');
            tabs.forEach(tab => {
                const button = document.createElement('button');
                button.className = 'nav-tab';
                button.textContent = tab.label;
                button.onclick = () => switchTab(tab.id);
                if (tab.id === 'dashboard') button.classList.add('active');
                tabsContainer.appendChild(button);
            });
        }

        function switchTab(tabId) {
            // Remove active class from all tabs and content
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab and content
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
            
            // Load specific tab content
            switch(tabId) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'students':
                    loadStudentsTable();
                    break;
                case 'turmas':
                    loadTurmas();
                    break;
                case 'financeiro':
                    loadFinancialData();
                    break;
                case 'progresso':
                    loadProgressData();
                    break;
                case 'chamada':
                    loadAttendanceClasses();
                    break;
                case 'gamificacao':
                    loadGamificationData();
                    break;
                case 'comissoes':
                    loadCommissionsData();
                    break;
                case 'configuracao':
                    loadConfigurationData();
                    break;
            }
        }

        // Sistema de modais
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            
            // Populate selects based on modal
            if (modalId === 'studentModal') {
                populateCoursesSelect('studentCourse');
                populateTurmasSelect('studentTurma');
            } else if (modalId === 'documentModal') {
                populateStudentsSelect('documentStudent');
            } else if (modalId === 'paymentModal') {
                populateStudentsSelect('paymentStudent');
            } else if (modalId === 'boletoModal') {
                populateStudentsSelect('boletoStudent');
            } else if (modalId === 'progressModal') {
                populateStudentsSelect('progressStudent');
            } else if (modalId === 'pointsModal') {
                populateStudentsSelect('pointsStudent');
            } else if (modalId === 'statusModal') {
                populateStudentsSelect('statusStudent');
            } else if (modalId === 'turmaModal') {
                populateCoursesSelect('turmaCourse');
            } else if (modalId === 'saleModal') {
                populateProductsSelect('saleProduct');
            } else if (modalId === 'editTurmaStudentModal') {
                populateTurmasSelect('editTurmaStudentNewTurma');
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            clearModalForms();
        }

        function clearModalForms() {
            document.querySelectorAll('.modal input, .modal select, .modal textarea').forEach(input => {
                if (input.type !== 'hidden') {
                    input.value = '';
                }
            });
        }

        // Sistema de notifica√ß√µes
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Gest√£o de participantes
        function saveStudent() {
            const studentData = {
                id: document.getElementById('editingStudentId').value || Date.now().toString(),
                name: document.getElementById('studentName').value,
                email: document.getElementById('studentEmail').value,
                phone: document.getElementById('studentPhone').value,
                cpf: document.getElementById('studentCPF').value,
                birth: document.getElementById('studentBirth').value,
                course: document.getElementById('studentCourse').value,
                turma: document.getElementById('studentTurma').value,
                vendedor: document.getElementById('studentVendedor').value,
                responsible: {
                    name: document.getElementById('responsibleName').value,
                    email: document.getElementById('responsibleEmail').value,
                    phone: document.getElementById('responsiblePhone').value,
                    cpf: document.getElementById('responsibleCPF').value
                },
                contract: {
                    value: parseFloat(document.getElementById('contractValue').value),
                    paymentMethod: document.getElementById('paymentMethod').value,
                    installments: parseInt(document.getElementById('installments').value),
                    startDate: document.getElementById('contractStartDate').value,
                    duration: parseInt(document.getElementById('contractDuration').value),
                    endDate: calculateEndDate(document.getElementById('contractStartDate').value, parseInt(document.getElementById('contractDuration').value))
                },
                academic: {
                    currentModule: document.getElementById('currentModule').value || 'M√≥dulo 1',
                    currentLesson: 'Aula 1'
                },
                status: 'ativo',
                progress: 0,
                points: 0,
                createdAt: new Date().toISOString()
            };

            if (!studentData.name || !studentData.email || !studentData.course || !studentData.responsible.name || !studentData.turma) {
                showNotification('Preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            const existingIndex = data.students.findIndex(s => s.id === studentData.id);
            if (existingIndex !== -1) {
                data.students[existingIndex] = { ...data.students[existingIndex], ...studentData };
                showNotification('Participante atualizado com sucesso!', 'success');
            } else {
                data.students.push(studentData);
                showNotification('Participante cadastrado com sucesso!', 'success');
                
                // Criar parcelas se necess√°rio
                if (studentData.contract.installments > 1) {
                    createInstallments(studentData);
                }
                
                // Registrar comiss√£o para o vendedor
                if (studentData.vendedor) {
                    registerSaleCommission(studentData);
                }
            }

            saveData();
            closeModal('studentModal');
            loadStudentsTable();
            loadTurmas();
            updateDashboard();
        }

        function calculateEndDate(startDate, durationMonths) {
            if (!startDate || !durationMonths) return '';
            const start = new Date(startDate);
            start.setMonth(start.getMonth() + durationMonths);
            return start.toISOString().split('T')[0];
        }

        function registerSaleCommission(student) {
            const commission = {
                id: Date.now().toString(),
                vendedor: student.vendedor,
                type: 'matricula',
                saleValue: student.contract.value,
                studentId: student.id,
                studentName: student.name,
                date: new Date().toISOString().split('T')[0],
                paymentMethod: student.contract.paymentMethod,
                calculated: false
            };
            
            data.commissions.push(commission);
        }

        function createInstallments(student) {
            const installmentValue = student.contract.value / student.contract.installments;
            const startDate = new Date(student.contract.startDate || new Date());
            
            for (let i = 0; i < student.contract.installments; i++) {
                const dueDate = new Date(startDate);
                dueDate.setMonth(startDate.getMonth() + i);
                
                const payment = {
                    id: Date.now().toString() + i,
                    studentId: student.id,
                    studentName: student.name,
                    installment: i + 1,
                    value: installmentValue,
                    dueDate: dueDate.toISOString().split('T')[0],
                    status: 'pendente',
                    paymentDate: null,
                    method: null
                };
                
                data.payments.push(payment);
                
                // Criar boleto automaticamente
                createBoleto(payment);
            }
        }

        function createBoleto(payment) {
            const boleto = {
                id: Date.now().toString() + '_' + Math.random().toString(36).substr(2, 9),
                studentId: payment.studentId,
                studentName: payment.studentName,
                paymentId: payment.id,
                value: payment.value,
                dueDate: payment.dueDate,
                installment: payment.installment,
                status: 'pendente',
                barcodeNumber: generateBarcodeNumber(),
                createdAt: new Date().toISOString()
            };
            
            data.boletos.push(boleto);
        }

        function generateBarcodeNumber() {
            return '00190' + Math.random().toString().substr(2, 39);
        }

        function loadStudentsTable() {
            const tbody = document.getElementById('studentsTableBody');
            tbody.innerHTML = '';

            data.students.forEach(student => {
                const turmaName = data.turmas.find(t => t.id === student.turma)?.name || 'Sem turma';
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td>${student.email}</td>
                    <td>${student.course}</td>
                    <td>${turmaName}</td>
                    <td><span class="status-badge status-${student.status}">${student.status.toUpperCase()}</span></td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${student.progress}%"></div>
                        </div>
                        ${student.progress}%
                    </td>
                    <td><span class="points-display">${student.points} pts</span></td>
                    <td>
                        <button class="btn btn-small" onclick="editStudent('${student.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-small btn-danger" onclick="deleteStudent('${student.id}')">üóëÔ∏è</button>
                        <button class="btn btn-small btn-secondary" onclick="viewStudent('${student.id}')">üëÅÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function editStudent(studentId) {
            const student = data.students.find(s => s.id === studentId);
            if (!student) return;

            document.getElementById('editingStudentId').value = student.id;
            document.getElementById('studentName').value = student.name;
            document.getElementById('studentEmail').value = student.email;
            document.getElementById('studentPhone').value = student.phone || '';
            document.getElementById('studentCPF').value = student.cpf || '';
            document.getElementById('studentBirth').value = student.birth || '';
            document.getElementById('studentCourse').value = student.course;
            document.getElementById('studentTurma').value = student.turma || '';
            document.getElementById('studentVendedor').value = student.vendedor || '';
            document.getElementById('responsibleName').value = student.responsible.name;
            document.getElementById('responsibleEmail').value = student.responsible.email;
            document.getElementById('responsiblePhone').value = student.responsible.phone || '';
            document.getElementById('responsibleCPF').value = student.responsible.cpf || '';
            document.getElementById('contractValue').value = student.contract.value;
            document.getElementById('paymentMethod').value = student.contract.paymentMethod;
            document.getElementById('installments').value = student.contract.installments;
            document.getElementById('contractStartDate').value = student.contract.startDate || '';
            document.getElementById('contractDuration').value = student.contract.duration || 12;
            document.getElementById('currentModule').value = student.academic?.currentModule || '';

            document.getElementById('studentModalTitle').textContent = 'Editar Participante';
            openModal('studentModal');
        }

        function deleteStudent(studentId) {
            if (confirm('Tem certeza que deseja excluir este participante?')) {
                data.students = data.students.filter(s => s.id !== studentId);
                data.payments = data.payments.filter(p => p.studentId !== studentId);
                data.boletos = data.boletos.filter(b => b.studentId !== studentId);
                saveData();
                loadStudentsTable();
                updateDashboard();
                showNotification('Participante exclu√≠do com sucesso!', 'success');
            }
        }

        function viewStudent(studentId) {
            const student = data.students.find(s => s.id === studentId);
            if (!student) return;

            const studentPayments = data.payments.filter(p => p.studentId === studentId);
            const turmaName = data.turmas.find(t => t.id === student.turma)?.name || 'Sem turma';
            
            alert(`
Detalhes do Participante:
Nome: ${student.name}
Email: ${student.email}
Curso: ${student.course}
Turma: ${turmaName}
Status: ${student.status}
Progresso: ${student.progress}%
Pontos: ${student.points}
M√≥dulo Atual: ${student.academic?.currentModule || 'N/A'}
Respons√°vel: ${student.responsible.name}
Valor do Contrato: R$ ${student.contract.value.toFixed(2)}
Parcelas: ${studentPayments.length}
Data de In√≠cio: ${student.contract.startDate ? new Date(student.contract.startDate).toLocaleDateString('pt-BR') : 'N/A'}
Data de T√©rmino: ${student.contract.endDate ? new Date(student.contract.endDate).toLocaleDateString('pt-BR') : 'N/A'}
            `.trim());
        }

        // Sistema de turmas
        function loadTurmas() {
            const container = document.getElementById('turmasContainer');
            container.innerHTML = '';

            data.turmas.forEach(turma => {
                const studentsInClass = data.students.filter(s => s.turma === turma.id);
                const card = document.createElement('div');
                card.className = 'turma-card';
                card.innerHTML = `
                    <div onclick="toggleTurmaStudents('${turma.id}')">
                        <h4>${turma.name}</h4>
                        <p>Curso: ${turma.course}</p>
                        <p>Hor√°rio: ${turma.horario || 'N√£o definido'} - ${turma.dias ? turma.dias.join(', ') : 'Sem dias definidos'}</p>
                        <p>In√≠cio: ${new Date(turma.startDate).toLocaleDateString('pt-BR')} - Fim: ${new Date(turma.endDate).toLocaleDateString('pt-BR')}</p>
                        <p>Participantes: ${studentsInClass.length}</p>
                        <div class="action-buttons">
                            <button class="btn btn-small" onclick="event.stopPropagation(); editTurma('${turma.id}')">‚úèÔ∏è Editar</button>
                            <button class="btn btn-small btn-danger" onclick="event.stopPropagation(); deleteTurma('${turma.id}')">üóëÔ∏è Excluir</button>
                        </div>
                    </div>
                    <div id="students_${turma.id}" class="turma-students">
                        <h5>Alunos da Turma:</h5>
                        ${studentsInClass.map(student => `
                            <div class="student-item">
                                <span>${student.name} - ${student.email}</span>
                                <div>
                                    <button class="btn btn-small" onclick="editTurmaStudent('${student.id}')">‚úèÔ∏è</button>
                                    <button class="btn btn-small btn-warning" onclick="transferTurmaStudent('${student.id}')">üîÑ</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function toggleTurmaStudents(turmaId) {
            const studentsDiv = document.getElementById(`students_${turmaId}`);
            studentsDiv.style.display = studentsDiv.style.display === 'block' ? 'none' : 'block';
        }

        function editTurmaStudent(studentId) {
            const student = data.students.find(s => s.id === studentId);
            if (!student) return;

            document.getElementById('editTurmaStudentId').value = studentId;
            document.getElementById('editTurmaStudentName').value = student.name;
            document.getElementById('editTurmaStudentNewTurma').value = student.turma;
            
            openModal('editTurmaStudentModal');
        }

        function saveStudentTurmaEdit() {
            const studentId = document.getElementById('editTurmaStudentId').value;
            const newTurmaId = document.getElementById('editTurmaStudentNewTurma').value;
            
            const student = data.students.find(s => s.id === studentId);
            if (student && newTurmaId) {
                student.turma = newTurmaId;
                saveData();
                closeModal('editTurmaStudentModal');
                loadTurmas();
                loadStudentsTable();
                showNotification('Aluno atualizado com sucesso!', 'success');
            }
        }

        function transferStudent() {
            saveStudentTurmaEdit();
        }

        function removeStudentFromTurma() {
            const studentId = document.getElementById('editTurmaStudentId').value;
            const student = data.students.find(s => s.id === studentId);
            
            if (student && confirm('Tem certeza que deseja remover este aluno da turma?')) {
                student.turma = '';
                saveData();
                closeModal('editTurmaStudentModal');
                loadTurmas();
                loadStudentsTable();
                showNotification('Aluno removido da turma!', 'success');
            }
        }

        function saveTurma() {
            const turmaData = {
                id: document.getElementById('editingTurmaId').value || Date.now().toString(),
                name: document.getElementById('turmaName').value,
                course: document.getElementById('turmaCourse').value,
                startDate: document.getElementById('turmaStart').value,
                endDate: document.getElementById('turmaEnd').value,
                horario: document.getElementById('turmaHorario').value,
                dias: Array.from(document.getElementById('turmaDias').selectedOptions).map(option => option.value),
                createdAt: new Date().toISOString()
            };

            if (!turmaData.name || !turmaData.course) {
                showNotification('Preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            const existingIndex = data.turmas.findIndex(t => t.id === turmaData.id);
            if (existingIndex !== -1) {
                data.turmas[existingIndex] = { ...data.turmas[existingIndex], ...turmaData };
                showNotification('Turma atualizada com sucesso!', 'success');
            } else {
                data.turmas.push(turmaData);
                showNotification('Turma criada com sucesso!', 'success');
            }

            saveData();
            closeModal('turmaModal');
            loadTurmas();
        }

        function editTurma(turmaId) {
            const turma = data.turmas.find(t => t.id === turmaId);
            if (!turma) return;

            document.getElementById('editingTurmaId').value = turma.id;
            document.getElementById('turmaName').value = turma.name;
            document.getElementById('turmaCourse').value = turma.course;
            document.getElementById('turmaStart').value = turma.startDate;
            document.getElementById('turmaEnd').value = turma.endDate;
            document.getElementById('turmaHorario').value = turma.horario || '';
            
            // Select multiple days
            const diasSelect = document.getElementById('turmaDias');
            Array.from(diasSelect.options).forEach(option => {
                option.selected = turma.dias && turma.dias.includes(option.value);
            });

            document.getElementById('turmaModalTitle').textContent = 'Editar Turma';
            openModal('turmaModal');
        }

        function deleteTurma(turmaId) {
            const studentsInTurma = data.students.filter(s => s.turma === turmaId);
            
            if (studentsInTurma.length > 0) {
                if (!confirm(`Esta turma possui ${studentsInTurma.length} aluno(s). Tem certeza que deseja exclu√≠-la? Os alunos ficar√£o sem turma.`)) {
                    return;
                }
                // Remove turma dos alunos
                studentsInTurma.forEach(student => {
                    student.turma = '';
                });
            }
            
            data.turmas = data.turmas.filter(t => t.id !== turmaId);
            saveData();
            loadTurmas();
            loadStudentsTable();
            showNotification('Turma exclu√≠da com sucesso!', 'success');
        }

        // Sistema financeiro
        function loadFinancialData() {
            updateFinancialSummary();
            loadPaymentsTable();
            loadBoletos();
            loadCashFlow();
        }

        function updateFinancialSummary() {
            const totalReceita = data.payments.filter(p => p.status === 'pago').reduce((sum, p) => sum + p.value, 0);
            const totalVencido = data.payments.filter(p => p.status === 'vencido').reduce((sum, p) => sum + p.value, 0);
            const totalPendente = data.payments.filter(p => p.status === 'pendente').reduce((sum, p) => sum + p.value, 0);
            
            // Calcular pr√≥ximo m√™s
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            const nextMonthStart = new Date(nextMonth.getFullYear(), nextMonth.getMonth(), 1);
            const nextMonthEnd = new Date(nextMonth.getFullYear(), nextMonth.getMonth() + 1, 0);
            
            const proximoMes = data.payments.filter(p => {
                const dueDate = new Date(p.dueDate);
                return dueDate >= nextMonthStart && dueDate <= nextMonthEnd && p.status === 'pendente';
            }).reduce((sum, p) => sum + p.value, 0);

            document.getElementById('totalReceita').textContent = `R$ ${totalReceita.toFixed(2)}`;
            document.getElementById('totalVencido').textContent = `R$ ${totalVencido.toFixed(2)}`;
            document.getElementById('totalPendente').textContent = `R$ ${totalPendente.toFixed(2)}`;
            document.getElementById('proximoMes').textContent = `R$ ${proximoMes.toFixed(2)}`;
            
            // Duplicar para a aba financeira
            document.getElementById('totalReceita2').textContent = `R$ ${totalReceita.toFixed(2)}`;
            document.getElementById('totalVencido2').textContent = `R$ ${totalVencido.toFixed(2)}`;
            document.getElementById('totalPendente2').textContent = `R$ ${totalPendente.toFixed(2)}`;
        }

        function loadPaymentsTable() {
            const tbody = document.getElementById('paymentsTableBody');
            tbody.innerHTML = '';

            // Check for overdue payments
            const today = new Date();
            data.payments.forEach(payment => {
                if (payment.status === 'pendente' && new Date(payment.dueDate) < today) {
                    payment.status = 'vencido';
                }
            });

            data.payments.forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${payment.studentName}</td>
                    <td>${payment.installment}</td>
                    <td>R$ ${payment.value.toFixed(2)}</td>
                    <td>${new Date(payment.dueDate).toLocaleDateString('pt-BR')}</td>
                    <td><span class="status-badge status-${payment.status}">${payment.status.toUpperCase()}</span></td>
                    <td>
                        <button class="btn btn-small btn-success" onclick="markAsPaid('${payment.id}')">üí∞</button>
                        <button class="btn btn-small btn-warning" onclick="editPayment('${payment.id}')">‚úèÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadBoletos() {
            const container = document.getElementById('boletosContainer');
            container.innerHTML = '';

            data.boletos.forEach(boleto => {
                const div = document.createElement('div');
                div.className = 'boleto-item';
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${boleto.studentName}</strong><br>
                            Parcela ${boleto.installment} - R$ ${boleto.value.toFixed(2)}<br>
                            Vencimento: ${new Date(boleto.dueDate).toLocaleDateString('pt-BR')}<br>
                            <small>C√≥digo: ${boleto.barcodeNumber}</small>
                        </div>
                        <div class="action-buttons">
                            <span class="status-badge status-${boleto.status}">${boleto.status.toUpperCase()}</span>
                            <button class="btn btn-small" onclick="printBoleto('${boleto.id}')">üñ®Ô∏è</button>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function generateBoleto() {
            const boletoData = {
                id: Date.now().toString(),
                studentId: document.getElementById('boletoStudent').value,
                studentName: data.students.find(s => s.id === document.getElementById('boletoStudent').value)?.name || '',
                value: parseFloat(document.getElementById('boletoValue').value),
                dueDate: document.getElementById('boletoDueDate').value,
                installment: parseInt(document.getElementById('boletoInstallment').value),
                status: 'pendente',
                barcodeNumber: generateBarcodeNumber(),
                createdAt: new Date().toISOString()
            };

            if (!boletoData.studentId || !boletoData.value) {
                showNotification('Preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            data.boletos.push(boletoData);
            saveData();
            closeModal('boletoModal');
            loadBoletos();
            showNotification('Boleto gerado com sucesso!', 'success');
        }

        function printBoleto(boletoId) {
            const boleto = data.boletos.find(b => b.id === boletoId);
            if (!boleto) return;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head><title>Boleto - ${boleto.studentName}</title></head>
                <body style="font-family: Arial, sans-serif; padding: 20px;">
                    <h2>GameCreators - Boleto de Pagamento</h2>
                    <p><strong>Benefici√°rio:</strong> GameCreators Instituto de Tecnologia</p>
                    <p><strong>Pagador:</strong> ${boleto.studentName}</p>
                    <p><strong>Valor:</strong> R$ ${boleto.value.toFixed(2)}</p>
                    <p><strong>Vencimento:</strong> ${new Date(boleto.dueDate).toLocaleDateString('pt-BR')}</p>
                    <p><strong>Parcela:</strong> ${boleto.installment}</p>
                    <hr>
                    <p><strong>C√≥digo de Barras:</strong></p>
                    <p style="font-family: monospace; font-size: 12px;">${boleto.barcodeNumber}</p>
                    <hr>
                    <p><small>Ap√≥s o vencimento cobrar multa de 2% + juros de 1% ao m√™s</small></p>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function savePayment() {
            const paymentData = {
                id: Date.now().toString(),
                studentId: document.getElementById('paymentStudent').value,
                studentName: data.students.find(s => s.id === document.getElementById('paymentStudent').value)?.name || '',
                value: parseFloat(document.getElementById('paymentValue').value),
                paymentDate: document.getElementById('paymentDate').value,
                method: document.getElementById('paymentMethodPayment').value,
                notes: document.getElementById('paymentNotes').value,
                status: 'pago',
                installment: 1
            };

            if (!paymentData.studentId || !paymentData.value) {
                showNotification('Preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            data.payments.push(paymentData);
            
            // Add to cash flow
            data.cashFlow.push({
                id: Date.now().toString(),
                type: 'entrada',
                value: paymentData.value,
                category: 'mensalidade',
                description: `Pagamento - ${paymentData.studentName}`,
                date: paymentData.paymentDate
            });

            saveData();
            closeModal('paymentModal');
            loadPaymentsTable();
            updateFinancialSummary();
            loadCashFlow();
            showNotification('Pagamento registrado com sucesso!', 'success');
        }

        function markAsPaid(paymentId) {
            const payment = data.payments.find(p => p.id === paymentId);
            if (payment) {
                payment.status = 'pago';
                payment.paymentDate = new Date().toISOString().split('T')[0];
                
                // Update boleto status
                const boleto = data.boletos.find(b => b.paymentId === paymentId);
                if (boleto) {
                    boleto.status = 'pago';
                }
                
                // Add to cash flow
                data.cashFlow.push({
                    id: Date.now().toString(),
                    type: 'entrada',
                    value: payment.value,
                    category: 'mensalidade',
                    description: `Pagamento - ${payment.studentName}`,
                    date: payment.paymentDate
                });
                
                saveData();
                loadPaymentsTable();
                loadBoletos();
                updateFinancialSummary();
                loadCashFlow();
                showNotification('Pagamento marcado como pago!', 'success');
            }
        }

        // Sistema de fluxo de caixa
        function saveCashFlow() {
            const cashFlowData = {
                id: Date.now().toString(),
                type: document.getElementById('cashFlowType').value,
                value: parseFloat(document.getElementById('cashFlowValue').value),
                category: document.getElementById('cashFlowCategory').value,
                description: document.getElementById('cashFlowDescription').value,
                date: document.getElementById('cashFlowDate').value
            };

            if (!cashFlowData.value || !cashFlowData.description) {
                showNotification('Preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            data.cashFlow.push(cashFlowData);
            saveData();
            closeModal('cashFlowModal');
            loadCashFlow();
            showNotification('Registro de fluxo de caixa salvo!', 'success');
        }

        function loadCashFlow() {
            const container = document.getElementById('cashFlowContainer');
            container.innerHTML = '';

            const sortedCashFlow = [...data.cashFlow].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedCashFlow.forEach(item => {
                const div = document.createElement('div');
                div.className = `cash-flow-item ${item.type === 'saida' ? 'expense' : ''}`;
                div.innerHTML = `
                    <div>
                        <strong>${item.type === 'entrada' ? '+' : '-'} R$ ${item.value.toFixed(2)}</strong><br>
                        <span>${item.description}</span><br>
                        <small>${item.category} - ${new Date(item.date).toLocaleDateString('pt-BR')}</small>
                    </div>
                    <button class="btn btn-small btn-danger" onclick="deleteCashFlow('${item.id}')">üóëÔ∏è</button>
                `;
                container.appendChild(div);
            });

            // Calculate totals
            const totalEntradas = data.cashFlow.filter(i => i.type === 'entrada').reduce((sum, i) => sum + i.value, 0);
            const totalSaidas = data.cashFlow.filter(i => i.type === 'saida').reduce((sum, i) => sum + i.value, 0);
            const saldo = totalEntradas - totalSaidas;

            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'card';
            summaryDiv.innerHTML = `
                <h4>Resumo do Fluxo de Caixa</h4>
                <div class="grid-3">
                    <div class="stat-card" style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);">
                        <div class="stat-number">R$ ${totalEntradas.toFixed(2)}</div>
                        <div class="stat-label">Total Entradas</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);">
                        <div class="stat-number">R$ ${totalSaidas.toFixed(2)}</div>
                        <div class="stat-label">Total Sa√≠das</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, ${saldo >= 0 ? '#4CAF50' : '#f44336'} 0%, ${saldo >= 0 ? '#45a049' : '#d32f2f'} 100%);">
                        <div class="stat-number">R$ ${saldo.toFixed(2)}</div>
                        <div class="stat-label">Saldo</div>
                    </div>
                </div>
            `;
            container.insertBefore(summaryDiv, container.firstChild);
        }

        function deleteCashFlow(itemId) {
            if (confirm('Tem certeza que deseja excluir este registro?')) {
                data.cashFlow = data.cashFlow.filter(i => i.id !== itemId);
                saveData();
                loadCashFlow();
                showNotification('Registro exclu√≠do com sucesso!', 'success');
            }
        }

        // Sistema de estoque
        function saveProduct() {
            const productData = {
                id: Date.now().toString(),
                name: document.getElementById('productName').value,
                price: parseFloat(document.getElementById('productPrice').value),
                quantity: parseInt(document.getElementById('productQuantity').value),
                category: document.getElementById('productCategory').value,
                createdAt: new Date().toISOString()
            };

            if (!productData.name || !productData.price || productData.quantity < 0) {
                showNotification('Preencha todos os campos corretamente', 'error');
                return;
            }

            data.inventory.push(productData);
            saveData();
            closeModal('addProductModal');
            loadInventory();
            showNotification('Produto adicionado com sucesso!', 'success');
        }

        function loadInventory() {
            const container = document.getElementById('inventoryList');
            container.innerHTML = '';

            data.inventory.forEach(product => {
                const div = document.createElement('div');
                div.className = 'inventory-item';
                div.innerHTML = `
                    <div>
                        <strong>${product.name}</strong><br>
                        <span>R$ ${product.price.toFixed(2)} - Estoque: ${product.quantity}</span><br>
                        <small>${product.category}</small>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-small" onclick="addStock('${product.id}')">‚ûï</button>
                        <button class="btn btn-small btn-warning" onclick="editProduct('${product.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-small btn-danger" onclick="deleteProduct('${product.id}')">üóëÔ∏è</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function addStock(productId) {
            const quantity = prompt('Quantidade a adicionar:');
            if (quantity && !isNaN(quantity)) {
                const product = data.inventory.find(p => p.id === productId);
                if (product) {
                    product.quantity += parseInt(quantity);
                    saveData();
                    loadInventory();
                    showNotification('Estoque atualizado!', 'success');
                }
            }
        }

        function deleteProduct(productId) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                data.inventory = data.inventory.filter(p => p.id !== productId);
                saveData();
                loadInventory();
                showNotification('Produto exclu√≠do!', 'success');
            }
        }

        function saveSale() {
            const productId = document.getElementById('saleProduct').value;
            const quantity = parseInt(document.getElementById('saleQuantity').value);
            const vendedor = document.getElementById('saleVendedor').value;
            const date = document.getElementById('saleDate').value;

            const product = data.inventory.find(p => p.id === productId);
            if (!product || !quantity || !vendedor) {
                showNotification('Preencha todos os campos', 'error');
                return;
            }

            if (product.quantity < quantity) {
                showNotification('Estoque insuficiente!', 'error');
                return;
            }

            const saleData = {
                id: Date.now().toString(),
                productId,
                productName: product.name,
                quantity,
                unitPrice: product.price,
                totalValue: product.price * quantity,
                vendedor,
                date,
                createdAt: new Date().toISOString()
            };

            // Update stock
            product.quantity -= quantity;

            // Save sale
            data.sales.push(saleData);

            // Add to cash flow
            data.cashFlow.push({
                id: Date.now().toString(),
                type: 'entrada',
                value: saleData.totalValue,
                category: 'material',
                description: `Venda - ${saleData.productName} (${quantity}x)`,
                date: date
            });

            saveData();
            closeModal('saleModal');
            loadInventory();
            loadCashFlow();
            showNotification('Venda registrada com sucesso!', 'success');
        }

        function populateProductsSelect(selectId) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            select.innerHTML = '<option value="">Selecione um produto</option>';
            
            data.inventory.filter(p => p.quantity > 0).forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = `${product.name} - R$ ${product.price.toFixed(2)} (${product.quantity} dispon√≠vel)`;
                select.appendChild(option);
            });
        }

        // Sistema de progresso acad√™mico
        function loadProgressData() {
            const container = document.getElementById('progressContainer');
            container.innerHTML = '';

            data.students.forEach(student => {
                const card = document.createElement('div');
                card.className = 'card';
                
                const startDate = student.contract?.startDate ? new Date(student.contract.startDate) : new Date();
                const endDate = student.contract?.endDate ? new Date(student.contract.endDate) : new Date();
                const today = new Date();
                const totalDays = (endDate - startDate) / (1000 * 60 * 60 * 24);
                const elapsedDays = (today - startDate) / (1000 * 60 * 60 * 24);
                const timeProgress = Math.max(0, Math.min(100, (elapsedDays / totalDays) * 100));

                card.innerHTML = `
                    <h4>${student.name}</h4>
                    <p>Curso: ${student.course}</p>
                    <p>M√≥dulo Atual: ${student.academic?.currentModule || 'M√≥dulo 1'}</p>
                    <p>Aula Atual: ${student.academic?.currentLesson || 'Aula 1'}</p>
                    <p>In√≠cio: ${startDate.toLocaleDateString('pt-BR')} - T√©rmino: ${endDate.toLocaleDateString('pt-BR')}</p>
                    
                    <div style="margin: 15px 0;">
                        <label>Progresso Acad√™mico:</label>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${student.progress}%"></div>
                        </div>
                        <span>${student.progress}%</span>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <label>Progresso Temporal:</label>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${timeProgress}%; background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%)"></div>
                        </div>
                        <span>${timeProgress.toFixed(1)}%</span>
                    </div>
                    
                    <button class="btn btn-small" onclick="updateStudentProgress('${student.id}')">Atualizar</button>
                `;
                container.appendChild(card);
            });
        }

        function updateStudentProgress(studentId) {
            const student = data.students.find(s => s.id === studentId);
            if (student) {
                document.getElementById('progressStudent').value = studentId;
                document.getElementById('progressModule').value = student.academic?.currentModule || '';
                document.getElementById('progressLesson').value = student.academic?.currentLesson || '';
                openModal('progressModal');
            }
        }

        function saveProgress() {
            const studentId = document.getElementById('progressStudent').value;
            const progress = parseInt(document.getElementById('progressValue').value);
            const module = document.getElementById('progressModule').value;
            const lesson = document.getElementById('progressLesson').value;
            const notes = document.getElementById('progressNotes').value;

            const student = data.students.find(s => s.id === studentId);
            if (student) {
                student.progress = progress;
                if (!student.academic) student.academic = {};
                student.academic.currentModule = module;
                student.academic.currentLesson = lesson;
                
                saveData();
                closeModal('progressModal');
                loadProgressData();
                loadStudentsTable();
                showNotification('Progresso atualizado com sucesso!', 'success');
            }
        }

        function generateProgressReport() {
            const studentsWithProgress = data.students.map(student => ({
                name: student.name,
                course: student.course,
                progress: student.progress,
                status: student.status,
                module: student.academic?.currentModule || 'N/A',
                lesson: student.academic?.currentLesson || 'N/A',
                startDate: student.contract?.startDate || 'N/A',
                endDate: student.contract?.endDate || 'N/A'
            }));

            console.log('Relat√≥rio de Progresso:', studentsWithProgress);
            
            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <html>
                <head><title>Relat√≥rio de Progresso</title></head>
                <body style="font-family: Arial, sans-serif; padding: 20px;">
                    <h2>Relat√≥rio de Progresso Acad√™mico</h2>
                    <table border="1" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f5f5f5;">
                                <th>Nome</th>
                                <th>Curso</th>
                                <th>Progresso</th>
                                <th>M√≥dulo</th>
                                <th>Aula</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${studentsWithProgress.map(student => `
                                <tr>
                                    <td>${student.name}</td>
                                    <td>${student.course}</td>
                                    <td>${student.progress}%</td>
                                    <td>${student.module}</td>
                                    <td>${student.lesson}</td>
                                    <td>${student.status}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </body>
                </html>
            `);
            reportWindow.document.close();
        }

        // Sistema de presen√ßa
        function loadAttendanceClasses() {
            const select = document.getElementById('attendanceClass');
            select.innerHTML = '<option value="">Selecione uma turma</option>';
            
            data.turmas.forEach(turma => {
                const option = document.createElement('option');
                option.value = turma.id;
                option.textContent = turma.name;
                select.appendChild(option);
            });
        }

        function loadAttendanceList() {
            const classId = document.getElementById('attendanceClass').value;
            const date = document.getElementById('attendanceDate').value;

            if (!classId || !date) {
                showNotification('Selecione uma turma e data', 'error');
                return;
            }

            const studentsInClass = data.students.filter(s => s.turma === classId);
            const attendanceContainer = document.getElementById('attendanceStudents');
            
            // Check if attendance already exists for this date
            const existingAttendance = data.attendance.find(a => a.classId === classId && a.date === date);
            
            attendanceContainer.innerHTML = studentsInClass.map(student => {
                const existingRecord = existingAttendance?.students.find(s => s.studentId === student.id);
                const isPresent = existingRecord ? existingRecord.present : true;
                
                return `
                    <div class="attendance-item">
                        <span>${student.name}</span>
                        <div class="attendance-controls">
                            <label>
                                <input type="radio" name="attendance_${student.id}" value="presente" ${isPresent ? 'checked' : ''}> Presente
                            </label>
                            <label>
                                <input type="radio" name="attendance_${student.id}" value="falta" ${!isPresent ? 'checked' : ''}> Falta
                            </label>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('attendanceList').classList.remove('hidden');
        }

        function saveAttendance() {
            const classId = document.getElementById('attendanceClass').value;
            const date = document.getElementById('attendanceDate').value;
            const studentsInClass = data.students.filter(s => s.turma === classId);

            const attendanceData = {
                id: Date.now().toString(),
                classId,
                date,
                students: []
            };

            studentsInClass.forEach(student => {
                const presentRadio = document.querySelector(`input[name="attendance_${student.id}"][value="presente"]`);
                const isPresent = presentRadio && presentRadio.checked;
                
                attendanceData.students.push({
                    studentId: student.id,
                    studentName: student.name,
                    present: isPresent
                });

                // Send notification to parent if absent
                if (!isPresent) {
                    sendAbsenceNotification(student);
                }
            });

            // Remove existing attendance for same date/class
            data.attendance = data.attendance.filter(a => !(a.classId === classId && a.date === date));
            data.attendance.push(attendanceData);

            saveData();
            showNotification('Presen√ßa salva com sucesso!', 'success');
            loadAttendanceReport();
            document.getElementById('attendanceList').classList.add('hidden');
        }

        function sendAbsenceNotification(student) {
            // Simulate sending notification
            console.log(`Notifica√ß√£o enviada para ${student.responsible.name} (${student.responsible.email}): ${student.name} faltou √† aula de ${new Date().toLocaleDateString('pt-BR')}`);
            showNotification(`Notifica√ß√£o de falta enviada para respons√°vel de ${student.name}`, 'info');
        }

        function loadAttendanceReport() {
            const container = document.getElementById('attendanceReport');
            container.innerHTML = '';

            // Calculate attendance statistics
            const attendanceStats = data.students.map(student => {
                const studentAttendances = data.attendance.reduce((total, attendance) => {
                    const studentRecord = attendance.students.find(s => s.studentId === student.id);
                    return total + (studentRecord ? 1 : 0);
                }, 0);

                const studentPresences = data.attendance.reduce((total, attendance) => {
                    const studentRecord = attendance.students.find(s => s.studentId === student.id);
                    return total + (studentRecord && studentRecord.present ? 1 : 0);
                }, 0);

                const attendanceRate = studentAttendances > 0 ? (studentPresences / studentAttendances) * 100 : 0;

                return {
                    ...student,
                    totalClasses: studentAttendances,
                    presences: studentPresences,
                    absences: studentAttendances - studentPresences,
                    attendanceRate
                };
            });

            const table = document.createElement('table');
            table.className = 'table';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Aluno</th>
                        <th>Total Aulas</th>
                        <th>Presen√ßas</th>
                        <th>Faltas</th>
                        <th>Taxa Presen√ßa</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    ${attendanceStats.map(student => `
                        <tr>
                            <td>${student.name}</td>
                            <td>${student.totalClasses}</td>
                            <td>${student.presences}</td>
                            <td>${student.absences}</td>
                            <td>${student.attendanceRate.toFixed(1)}%</td>
                            <td>
                                <span class="status-badge ${student.attendanceRate >= 75 ? 'status-ativo' : 'status-vencido'}">
                                    ${student.attendanceRate >= 75 ? 'Regular' : 'Baixa Frequ√™ncia'}
                                </span>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
            container.appendChild(table);
        }

        // Sistema de gamifica√ß√£o
        function loadGamificationData() {
            loadRanking();
            loadMissions();
            loadStoreItems();
        }

        function loadRanking() {
            const sortedStudents = [...data.students].sort((a, b) => b.points - a.points);
            const container = document.getElementById('rankingList');
            
            container.innerHTML = sortedStudents.slice(0, 10).map((student, index) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: ${index < 3 ? '#fff3cd' : '#f8f9fa'}; margin: 5px 0; border-radius: 5px;">
                    <span>${index + 1}¬∫ ${student.name}</span>
                    <span class="points-display">${student.points} pts</span>
                </div>
            `).join('');
        }

        function loadMissions() {
            const container = document.getElementById('missionsList');
            container.innerHTML = '';

            data.missions.forEach(mission => {
                const div = document.createElement('div');
                div.className = 'mission-card';
                div.innerHTML = `
                    <h4>${mission.title}</h4>
                    <p>${mission.description}</p>
                    <p><strong>Recompensa:</strong> ${mission.points} pontos</p>
                    <p><strong>Expira em:</strong> ${new Date(mission.expiry).toLocaleDateString('pt-BR')}</p>
                    <p><strong>Tipo:</strong> ${mission.type}</p>
                    <button class="btn btn-small btn-danger" onclick="deleteMission('${mission.id}')">Excluir</button>
                `;
                container.appendChild(div);
            });
        }

        function saveMission() {
            const missionData = {
                id: Date.now().toString(),
                title: document.getElementById('missionTitle').value,
                description: document.getElementById('missionDescription').value,
                points: parseInt(document.getElementById('missionPoints').value),
                expiry: document.getElementById('missionExpiry').value,
                type: document.getElementById('missionType').value,
                active: true,
                createdAt: new Date().toISOString()
            };

            if (!missionData.title || !missionData.description || !missionData.points) {
                showNotification('Preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            data.missions.push(missionData);
            saveData();
            closeModal('missionModal');
            loadMissions();
            showNotification('Miss√£o criada com sucesso!', 'success');
        }

        function deleteMission(missionId) {
            if (confirm('Tem certeza que deseja excluir esta miss√£o?')) {
                data.missions = data.missions.filter(m => m.id !== missionId);
                saveData();
                loadMissions();
                showNotification('Miss√£o exclu√≠da!', 'success');
            }
        }

        function loadStoreItems() {
            const container = document.getElementById('storeItems');
            container.innerHTML = '';

            data.storeItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'store-item';
                div.innerHTML = `
                    <div>
                        <h4>${item.name}</h4>
                        <p>${item.description}</p>
                        <small>Categoria: ${item.category} | Estoque: ${item.stock}</small>
                    </div>
                    <div style="text-align: center;">
                        <span class="points-display">${item.cost} pts</span><br>
                        <button class="btn btn-small" onclick="redeemItem('${item.id}')">Trocar</button>
                        <button class="btn btn-small btn-warning" onclick="editStoreItem('${item.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-small btn-danger" onclick="deleteStoreItem('${item.id}')">üóëÔ∏è</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function saveStoreItem() {
            const itemData = {
                id: document.getElementById('editingStoreItemId')?.value || Date.now().toString(),
                name: document.getElementById('storeItemName').value,
                description: document.getElementById('storeItemDescription').value,
                cost: parseInt(document.getElementById('storeItemCost').value),
                category: document.getElementById('storeItemCategory').value,
                stock: parseInt(document.getElementById('storeItemStock').value),
                createdAt: new Date().toISOString()
            };

            if (!itemData.name || !itemData.cost || itemData.stock < 0) {
                showNotification('Preencha todos os campos corretamente', 'error');
                return;
            }

            const existingIndex = data.storeItems.findIndex(i => i.id === itemData.id);
            if (existingIndex !== -1) {
                data.storeItems[existingIndex] = itemData;
                showNotification('Item atualizado com sucesso!', 'success');
            } else {
                data.storeItems.push(itemData);
                showNotification('Item adicionado com sucesso!', 'success');
            }

            saveData();
            closeModal('storeItemModal');
            loadStoreItems();
        }

        function redeemItem(itemId) {
            const item = data.storeItems.find(i => i.id === itemId);
            if (!item) return;

            const studentId = prompt('ID do estudante que quer trocar:');
            const student = data.students.find(s => s.id === studentId);

            if (!student) {
                showNotification('Estudante n√£o encontrado', 'error');
                return;
            }

            if (student.points < item.cost) {
                showNotification('Pontos insuficientes', 'error');
                return;
            }

            if (item.stock <= 0) {
                showNotification('Item fora de estoque', 'error');
                return;
            }

            student.points -= item.cost;
            item.stock -= 1;

            saveData();
            loadStoreItems();
            loadRanking();
            loadStudentsTable();
            showNotification(`${student.name} trocou ${item.name} por ${item.cost} pontos!`, 'success');
        }

        function deleteStoreItem(itemId) {
            if (confirm('Tem certeza que deseja excluir este item?')) {
                data.storeItems = data.storeItems.filter(i => i.id !== itemId);
                saveData();
                loadStoreItems();
                showNotification('Item exclu√≠do!', 'success');
            }
        }

        function givePoints() {
            const studentId = document.getElementById('pointsStudent').value;
            const points = parseInt(document.getElementById('pointsValue').value);
            const reason = document.getElementById('pointsReason').value;

            if (!studentId || !points) {
                showNotification('Preencha todos os campos', 'error');
                return;
            }

            const student = data.students.find(s => s.id === studentId);
            if (student) {
                student.points += points;
                saveData();
                closeModal('pointsModal');
                loadStudentsTable();
                loadRanking();
                showNotification(`${points} pontos dados para ${student.name}!`, 'success');
            }
        }

        // Sistema de comiss√µes (com c√°lculos corretos)
        function loadCommissionsData() {
            calculateAllCommissions();
            displayCommissions();
        }

        function calculateAllCommissions() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            // Group sales by salesperson and month
            const salesBySalesperson = {};
            
            data.commissions.forEach(commission => {
                const commissionDate = new Date(commission.date);
                if (commissionDate.getMonth() === currentMonth && commissionDate.getFullYear() === currentYear) {
                    if (!salesBySalesperson[commission.vendedor]) {
                        salesBySalesperson[commission.vendedor] = {
                            matriculas: 0,
                            totalValue: 0,
                            dailyBonus: 0,
                            blackin: 0,
                            black: 0,
                            commission: 0
                        };
                    }
                    
                    if (commission.type === 'matricula') {
                        salesBySalesperson[commission.vendedor].matriculas++;
                        salesBySalesperson[commission.vendedor].totalValue += commission.saleValue;
                    }
                }
            });

            // Calculate commissions based on rules
            Object.keys(salesBySalesperson).forEach(vendedor => {
                const sales = salesBySalesperson[vendedor];
                
                // Determine salesperson type
                const isGerente = vendedor.includes('gerente');
                const isAssistente = vendedor.includes('assistente');
                
                if (isGerente) {
                    // Ger√™ncia rules
                    if (sales.matriculas >= 26) {
                        if (sales.matriculas <= 52) {
                            sales.commission = sales.matriculas * 50;
                        } else if (sales.matriculas <= 78) {
                            sales.commission = sales.matriculas * 80;
                        } else {
                            sales.commission = sales.matriculas * 80; // Continue with highest rate
                        }
                    }
                } else if (isAssistente) {
                    // Assistente Comercial rules
                    if (sales.matriculas >= 10) {
                        if (sales.matriculas <= 20) {
                            sales.commission = sales.matriculas * 10;
                        } else if (sales.matriculas <= 30) {
                            sales.commission = sales.matriculas * 15;
                        } else if (sales.matriculas <= 40) {
                            sales.commission = sales.matriculas * 25;
                        } else {
                            sales.commission = sales.matriculas * 30;
                        }
                    }
                } else {
                    // Vendedor rules
                    if (sales.matriculas >= 10) {
                        if (sales.matriculas <= 20) {
                            sales.commission = sales.matriculas * 35;
                        } else if (sales.matriculas <= 30) {
                            sales.commission = sales.matriculas * 50;
                        } else if (sales.matriculas <= 40) {
                            sales.commission = sales.matriculas * 60;
                        } else {
                            sales.commission = sales.matriculas * 70;
                        }
                    }
                }
                
                salesBySalesperson[vendedor] = sales;
            });
            
            return salesBySalesperson;
        }

        function displayCommissions() {
            const commissions = calculateAllCommissions();
            const container = document.getElementById('commissionsList');
            container.innerHTML = '';

            Object.keys(commissions).forEach(vendedor => {
                const data = commissions[vendedor];
                const div = document.createElement('div');
                div.className = 'commission-card';
                div.innerHTML = `
                    <h4>${vendedor}</h4>
                    <p>Matr√≠culas: ${data.matriculas}</p>
                    <p>Valor Total Vendas: R$ ${data.totalValue.toFixed(2)}</p>
                    <p>Comiss√£o: R$ ${data.commission.toFixed(2)}</p>
                    <p>Status: ${data.matriculas >= 10 ? 'Qualificado' : 'N√£o Qualificado'}</p>
                `;
                container.appendChild(div);
            });

            // Summary
            const totalCommissions = Object.values(commissions).reduce((sum, data) => sum + data.commission, 0);
            const totalSales = Object.values(commissions).reduce((sum, data) => sum + data.totalValue, 0);
            
            document.getElementById('commissionSummary').innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">R$ ${totalSales.toFixed(2)}</div>
                    <div class="stat-label">Total Vendas</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);">
                    <div class="stat-number">R$ ${totalCommissions.toFixed(2)}</div>
                    <div class="stat-label">Total Comiss√µes</div>
                </div>
            `;
        }

        function saveCommission() {
            const commissionData = {
                id: Date.now().toString(),
                vendedor: document.getElementById('commissionVendedor').value,
                type: document.getElementById('commissionType').value,
                saleValue: parseFloat(document.getElementById('commissionSaleValue').value),
                date: document.getElementById('commissionDate').value,
                calculated: false
            };

            if (!commissionData.vendedor || !commissionData.saleValue) {
                showNotification('Preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            data.commissions.push(commissionData);
            saveData();
            closeModal('commissionModal');
            loadCommissionsData();
            showNotification('Comiss√£o registrada com sucesso!', 'success');
        }

        function calculateCommissions() {
            loadCommissionsData();
            showNotification('Comiss√µes calculadas para o per√≠odo!', 'success');
        }

        // Sistema de documentos e templates
        function generateDocument() {
            const studentId = document.getElementById('documentStudent').value;
            const docType = document.getElementById('documentType').value;

            if (!studentId) {
                showNotification('Selecione um participante', 'error');
                return;
            }

            const student = data.students.find(s => s.id === studentId);
            if (!student) return;

            let documentHTML = '';
            const today = new Date().toLocaleDateString('pt-BR');

            switch(docType) {
                case 'declaracao':
                    documentHTML = generateDeclaracao(student, today);
                    break;
                case 'contrato':
                    documentHTML = generateContrato(student, today);
                    break;
                case 'certificado':
                    documentHTML = generateCertificado(student, today);
                    break;
                case 'trancamento':
                    documentHTML = generateTrancamento(student, today);
                    break;
                case 'cancelamento':
                    documentHTML = generateCancelamento(student, today);
                    break;
            }

            document.getElementById('documentPreview').innerHTML = documentHTML;
            closeModal('documentModal');
            showNotification('Documento gerado com sucesso!', 'success');
        }

        function generateDeclaracao(student, today) {
            return `
                <div class="document-preview">
                    <div class="document-header">
                        <h2>DECLARA√á√ÉO</h2>
                        <p>GameCreators - Instituto de Tecnologia</p>
                    </div>
                    <p>Declaramos para os devidos fins que <strong>${student.name}</strong>, 
                    portador do email ${student.email}, est√° regularmente matriculado(a) 
                    no curso de <strong>${student.course}</strong> nesta institui√ß√£o.</p>
                    
                    <p>O referido aluno encontra-se com situa√ß√£o acad√™mica <strong>${student.status}</strong> 
                    e progresso de <strong>${student.progress}%</strong> no curso.</p>
                    
                    <p>M√≥dulo atual: <strong>${student.academic?.currentModule || 'M√≥dulo 1'}</strong></p>
                    <p>Aula atual: <strong>${student.academic?.currentLesson || 'Aula 1'}</strong></p>
                    
                    <p>Por ser verdade, firmamos a presente declara√ß√£o.</p>
                    
                    <br><br>
                    <p style="text-align: center;">
                        _________________________________<br>
                        GameCreators<br>
                        ${today}
                    </p>
                </div>
                <div class="no-print">
                    <button class="btn" onclick="window.print()">üñ®Ô∏è Imprimir</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('documentPreview').innerHTML=''">Fechar</button>
                </div>
            `;
        }

        function generateContrato(student, today) {
            return `
                <div class="document-preview">
                    <div class="document-header">
                        <h2>CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS EDUCACIONAIS</h2>
                        <p>GameCreators - Instituto de Tecnologia</p>
                    </div>
                    <p><strong>CONTRATANTE:</strong> ${student.responsible.name}<br>
                    <strong>CONTRATADO:</strong> GameCreators</p>
                    
                    <p><strong>PARTICIPANTE:</strong> ${student.name}<br>
                    <strong>CURSO:</strong> ${student.course}<br>
                    <strong>VALOR:</strong> R$ ${student.contract.value.toFixed(2)}<br>
                    <strong>PARCELAS:</strong> ${student.contract.installments}x<br>
                    <strong>DURA√á√ÉO:</strong> ${student.contract.duration || 12} meses</p>
                    
                    <p>O presente contrato tem por objetivo a presta√ß√£o de servi√ßos educacionais 
                    na √°rea de ${student.course}, conforme grade curricular estabelecida.</p>
                    
                    <p><strong>PER√çODO:</strong> ${student.contract.startDate ? new Date(student.contract.startDate).toLocaleDateString('pt-BR') : 'A definir'} 
                    at√© ${student.contract.endDate ? new Date(student.contract.endDate).toLocaleDateString('pt-BR') : 'A definir'}</p>
                    
                    <br><br>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 50px; text-align: center;">
                        <div>
                            _________________________________<br>
                            ${student.responsible.name}<br>
                            Contratante
                        </div>
                        <div>
                            _________________________________<br>
                            GameCreators<br>
                            Contratado
                        </div>
                    </div>
                    <p style="text-align: center; margin-top: 20px;">${today}</p>
                </div>
                <div class="no-print">
                    <button class="btn" onclick="window.print()">üñ®Ô∏è Imprimir</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('documentPreview').innerHTML=''">Fechar</button>
                </div>
            `;
        }

        function generateCertificado(student, today) {
            return `
                <div class="document-preview">
                    <div class="document-header">
                        <h2>CERTIFICADO DE CONCLUS√ÉO</h2>
                        <p>GameCreators - Instituto de Tecnologia</p>
                    </div>
                    <div style="text-align: center; margin: 40px 0;">
                        <p style="font-size: 18px;">Certificamos que</p>
                        <h3 style="font-size: 24px; margin: 20px 0;">${student.name}</h3>
                        <p style="font-size: 18px;">concluiu com aproveitamento o curso de</p>
                        <h3 style="font-size: 22px; margin: 20px 0;">${student.course}</h3>
                        <p>com carga hor√°ria de 120 horas, realizado no per√≠odo de 
                        ${student.contract.startDate ? new Date(student.contract.startDate).toLocaleDateString('pt-BR') : 'N/A'} 
                        a ${student.contract.endDate ? new Date(student.contract.endDate).toLocaleDateString('pt-BR') : 'N/A'}.</p>
                    </div>
                    
                    <br><br>
                    <p style="text-align: center;">
                        _________________________________<br>
                        GameCreators<br>
                        ${today}
                    </p>
                </div>
                <div class="no-print">
                    <button class="btn" onclick="window.print()">üñ®Ô∏è Imprimir</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('documentPreview').innerHTML=''">Fechar</button>
                </div>
            `;
        }

        function generateTrancamento(student, today) {
            return `
                <div class="document-preview">
                    <div class="document-header">
                        <h2>DECLARA√á√ÉO DE TRANCAMENTO</h2>
                        <p>GameCreators - Instituto de Tecnologia</p>
                    </div>
                    <p>Declaramos que <strong>${student.name}</strong>, 
                    regularmente matriculado(a) no curso de <strong>${student.course}</strong>, 
                    solicitou o trancamento de sua matr√≠cula nesta data.</p>
                    
                    <p>O aluno encontrava-se com <strong>${student.progress}%</strong> 
                    de progresso no curso no momento do trancamento.</p>
                    
                    <p>Por ser verdade, firmamos a presente declara√ß√£o.</p>
                    
                    <br><br>
                    <p style="text-align: center;">
                        _________________________________<br>
                        GameCreators<br>
                        ${today}
                    </p>
                </div>
                <div class="no-print">
                    <button class="btn" onclick="window.print()">üñ®Ô∏è Imprimir</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('documentPreview').innerHTML=''">Fechar</button>
                </div>
            `;
        }

        function generateCancelamento(student, today) {
            return `
                <div class="document-preview">
                    <div class="document-header">
                        <h2>DECLARA√á√ÉO DE CANCELAMENTO</h2>
                        <p>GameCreators - Instituto de Tecnologia</p>
                    </div>
                    <p>Declaramos que <strong>${student.name}</strong>, 
                    que estava matriculado(a) no curso de <strong>${student.course}</strong>, 
                    teve sua matr√≠cula cancelada nesta data.</p>
                    
                    <p>O cancelamento foi solicitado pelo respons√°vel 
                    <strong>${student.responsible.name}</strong>.</p>
                    
                    <p>Por ser verdade, firmamos a presente declara√ß√£o.</p>
                    
                    <br><br>
                    <p style="text-align: center;">
                        _________________________________<br>
                        GameCreators<br>
                        ${today}
                    </p>
                </div>
                <div class="no-print">
                    <button class="btn" onclick="window.print()">üñ®Ô∏è Imprimir</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('documentPreview').innerHTML=''">Fechar</button>
                </div>
            `;
        }

        function useTemplate(templateType) {
            const templates = {
                contrato: `
CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS EDUCACIONAIS

CONTRATANTE: [NOME_RESPONSAVEL]
CONTRATADO: GameCreators

PARTICIPANTE: [NOME_ESTUDANTE]
CURSO: [CURSO]
VALOR: R$ [VALOR]
PARCELAS: [PARCELAS]

O presente contrato tem por objetivo...
                `,
                declaracao: `
DECLARA√á√ÉO

Declaramos que [NOME_ESTUDANTE] est√° regularmente matriculado(a) no curso de [CURSO].

GameCreators
                `,
                certificado: `
CERTIFICADO DE CONCLUS√ÉO

Certificamos que [NOME_ESTUDANTE] concluiu o curso de [CURSO].

GameCreators
                `
            };

            document.getElementById('templateContent').value = templates[templateType] || '';
        }

        function saveTemplate() {
            const content = document.getElementById('templateContent').value;
            if (content.trim()) {
                data.templates.custom = content;
                saveData();
                showNotification('Template salvo com sucesso!', 'success');
            }
        }

        // Sistema de busca
        function searchTable(searchTerm) {
            const tbody = document.getElementById('studentsTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm.toLowerCase()) ? '' : 'none';
            }
        }

        function performAdvancedSearch() {
            const searchCriteria = {
                name: document.getElementById('searchName').value.toLowerCase(),
                status: document.getElementById('searchStatus').value,
                course: document.getElementById('searchCourse').value,
                financial: document.getElementById('searchFinancial').value
            };

            const filteredStudents = data.students.filter(student => {
                const nameMatch = !searchCriteria.name || student.name.toLowerCase().includes(searchCriteria.name);
                const statusMatch = !searchCriteria.status || student.status === searchCriteria.status;
                const courseMatch = !searchCriteria.course || student.course === searchCriteria.course;
                
                let financialMatch = true;
                if (searchCriteria.financial) {
                    const studentPayments = data.payments.filter(p => p.studentId === student.id);
                    if (searchCriteria.financial === 'pago') {
                        financialMatch = studentPayments.every(p => p.status === 'pago');
                    } else if (searchCriteria.financial === 'pendente') {
                        financialMatch = studentPayments.some(p => p.status === 'pendente');
                    } else if (searchCriteria.financial === 'vencido') {
                        financialMatch = studentPayments.some(p => p.status === 'vencido');
                    }
                }

                return nameMatch && statusMatch && courseMatch && financialMatch;
            });

            displayFilteredStudents(filteredStudents);
            closeModal('advancedSearchModal');
        }

        function clearAdvancedSearch() {
            document.getElementById('searchName').value = '';
            document.getElementById('searchStatus').value = '';
            document.getElementById('searchCourse').value = '';
            document.getElementById('searchFinancial').value = '';
            loadStudentsTable();
        }

        function displayFilteredStudents(students) {
            const tbody = document.getElementById('studentsTableBody');
            tbody.innerHTML = '';

            students.forEach(student => {
                const turmaName = data.turmas.find(t => t.id === student.turma)?.name || 'Sem turma';
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td>${student.email}</td>
                    <td>${student.course}</td>
                    <td>${turmaName}</td>
                    <td><span class="status-badge status-${student.status}">${student.status.toUpperCase()}</span></td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${student.progress}%"></div>
                        </div>
                        ${student.progress}%
                    </td>
                    <td><span class="points-display">${student.points} pts</span></td>
                    <td>
                        <button class="btn btn-small" onclick="editStudent('${student.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-small btn-danger" onclick="deleteStudent('${student.id}')">üóëÔ∏è</button>
                        <button class="btn btn-small btn-secondary" onclick="viewStudent('${student.id}')">üëÅÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Sistema de status
        function changeStatus() {
            const studentId = document.getElementById('statusStudent').value;
            const newStatus = document.getElementById('newStatus').value;
            const reason = document.getElementById('statusReason').value;

            if (!studentId || !newStatus) {
                showNotification('Preencha todos os campos', 'error');
                return;
            }

            const student = data.students.find(s => s.id === studentId);
            if (student) {
                student.status = newStatus;
                saveData();
                closeModal('statusModal');
                loadStudentsTable();
                updateDashboard();
                showNotification(`Status alterado para ${newStatus}!`, 'success');
            }
        }

        // Dashboard
        function updateDashboard() {
            // Estat√≠sticas gerais
            const totalStudents = data.students.length;
            const activeStudents = data.students.filter(s => s.status === 'ativo').length;
            const totalCourses = data.courses.length;
            const totalClasses = data.turmas.length;

            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalStudents}</div>
                    <div class="stat-label">Total Participantes</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);">
                    <div class="stat-number">${activeStudents}</div>
                    <div class="stat-label">Ativos</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);">
                    <div class="stat-number">${totalCourses}</div>
                    <div class="stat-label">Cursos</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);">
                    <div class="stat-number">${totalClasses}</div>
                    <div class="stat-label">Turmas</div>
                </div>
            `;

            // Resumo financeiro
            updateFinancialSummary();
            loadRecentActivities();
        }

        function loadRecentActivities() {
            const activities = [
                'Novo participante cadastrado: Jo√£o Silva',
                'Pagamento recebido: R$ 450,00',
                'Turma "Desenvolvimento Mobile" criada',
                'Progresso atualizado: Maria Santos - 85%'
            ];

            document.getElementById('recentActivities').innerHTML = activities.map(activity => 
                `<div style="padding: 10px; border-left: 3px solid #2196F3; margin-bottom: 10px; background: #f8f9ff;">
                    ${activity}
                </div>`
            ).join('');
        }

        function generateFinancialReport() {
            const report = {
                totalReceita: data.payments.filter(p => p.status === 'pago').reduce((sum, p) => sum + p.value, 0),
                totalVencido: data.payments.filter(p => p.status === 'vencido').reduce((sum, p) => sum + p.value, 0),
                totalPendente: data.payments.filter(p => p.status === 'pendente').reduce((sum, p) => sum + p.value, 0),
                totalStudents: data.students.length,
                activeStudents: data.students.filter(s => s.status === 'ativo').length
            };

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <html>
                <head><title>Relat√≥rio Financeiro</title></head>
                <body style="font-family: Arial, sans-serif; padding: 20px;">
                    <h2>RELAT√ìRIO FINANCEIRO</h2>
                    <p><strong>Receita Total:</strong> R$ ${report.totalReceita.toFixed(2)}</p>
                    <p><strong>Valores Vencidos:</strong> R$ ${report.totalVencido.toFixed(2)}</p>
                    <p><strong>Valores Pendentes:</strong> R$ ${report.totalPendente.toFixed(2)}</p>
                    <hr>
                    <p><strong>Total de Participantes:</strong> ${report.totalStudents}</p>
                    <p><strong>Participantes Ativos:</strong> ${report.activeStudents}</p>
                </body>
                </html>
            `);
            reportWindow.document.close();
        }

        // Sistema de configura√ß√£o
        function loadConfigurationData() {
            const container = document.getElementById('coursesList');
            container.innerHTML = data.courses.map(course => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border: 1px solid #e0e0e0; margin: 5px 0; border-radius: 5px;">
                    <span>${course}</span>
                    <button class="btn btn-small btn-danger" onclick="removeCourse('${course}')">Remover</button>
                </div>
            `).join('');
        }

        function addCourse() {
            const courseName = document.getElementById('newCourse').value.trim();
            if (!courseName) {
                showNotification('Digite o nome do curso', 'error');
                return;
            }

            if (data.courses.includes(courseName)) {
                showNotification('Curso j√° existe', 'error');
                return;
            }

            data.courses.push(courseName);
            saveData();
            loadConfigurationData();
            populateSelects();
            document.getElementById('newCourse').value = '';
            showNotification('Curso adicionado com sucesso!', 'success');
        }

        function removeCourse(courseName) {
            if (confirm(`Tem certeza que deseja remover o curso "${courseName}"?`)) {
                data.courses = data.courses.filter(course => course !== courseName);
                saveData();
                loadConfigurationData();
                populateSelects();
                showNotification('Curso removido com sucesso!', 'success');
            }
        }

        // Sistema de backup
        function exportData() {
            const dataToExport = {
                ...data,
                exportDate: new Date().toISOString(),
                version: '2.0'
            };

            const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `gamecreators_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Dados exportados com sucesso!', 'success');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (confirm('Isso ir√° substituir todos os dados atuais. Deseja continuar?')) {
                        Object.assign(data, importedData);
                        saveData();
                        loadStudentsTable();
                        updateDashboard();
                        loadConfigurationData();
                        populateSelects();
                        showNotification('Dados importados com sucesso!', 'success');
                    }
                } catch (error) {
                    showNotification('Erro ao importar dados. Verifique o arquivo.', 'error');
                }
            };
            reader.readAsText(file);
        }

        // Utilit√°rios
        function populateSelects() {
            populateCoursesSelect('studentCourse');
            populateCoursesSelect('searchCourse');
            populateCoursesSelect('turmaCourse');
        }

        function populateCoursesSelect(selectId) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            const currentValue = select.value;
            select.innerHTML = '<option value="">Selecione um curso</option>';
            
            data.courses.forEach(course => {
                const option = document.createElement('option');
                option.value = course;
                option.textContent = course;
                select.appendChild(option);
            });
            
            select.value = currentValue;
        }

        function populateTurmasSelect(selectId) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            const currentValue = select.value;
            select.innerHTML = '<option value="">Selecione uma turma</option>';
            
            data.turmas.forEach(turma => {
                const option = document.createElement('option');
                option.value = turma.id;
                option.textContent = turma.name;
                select.appendChild(option);
            });
            
            select.value = currentValue;
        }

        function populateStudentsSelect(selectId) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            select.innerHTML = '<option value="">Selecione um participante</option>';
            
            data.students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = student.name;
                select.appendChild(option);
            });
        }

        // Sistema de armazenamento
        function saveData() {
            localStorage.setItem('gamecreators_data', JSON.stringify(data));
        }

        function loadStoredData() {
            const stored = localStorage.getItem('gamecreators_data');
            if (stored) {
                try {
                    const parsedData = JSON.parse(stored);
                    Object.assign(data, parsedData);
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                }
            } else {
                // Dados de exemplo apenas se n√£o houver dados salvos
                loadExampleData();
            }
        }

        function loadExampleData() {
            data.students = [
                {
                    id: '1',
                    name: 'Jo√£o Silva',
                    email: 'joao@email.com',
                    phone: '(11) 99999-9999',
                    course: 'Desenvolvimento de Jogos',
                    turma: '1',
                    vendedor: 'vendedor1',
                    status: 'ativo',
                    progress: 65,
                    points: 120,
                    responsible: {
                        name: 'Maria Silva',
                        email: 'maria@email.com'
                    },
                    contract: {
                        value: 1200.00,
                        paymentMethod: 'parcelado',
                        installments: 12,
                        startDate: '2024-01-01',
                        duration: 12,
                        endDate: '2024-12-31'
                    },
                    academic: {
                        currentModule: 'M√≥dulo 1',
                        currentLesson: 'Aula 5'
                    }
                },
                {
                    id: '2',
                    name: 'Ana Santos',
                    email: 'ana@email.com',
                    phone: '(11) 88888-8888',
                    course: 'Design Gr√°fico',
                    turma: '2',
                    vendedor: 'vendedor2',
                    status: 'ativo',
                    progress: 80,
