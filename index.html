} else if (input.id === 'studentXP' || input.id === 'studentPoints') {
                        input.value = '0';
                    } else {
                        input.value = '';
                    }
                });
            }
        }

        // Sistema de notifica√ß√µes
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        // Dashboard functions
        function updateDashboard() {
            document.getElementById('totalStudents').textContent = data.students.length;
            document.getElementById('activeStudents').textContent = data.students.filter(s => s.status === 'ativo').length;
            document.getElementById('totalClasses').textContent = data.turmas.length;
            document.getElementById('totalCourses').textContent = data.courses.length;

            const totalReceita = data.payments.filter(p => p.status === 'pago').reduce((sum, p) => sum + p.value, 0);
            const totalVencido = data.payments.filter(p => {
                return p.status === 'pendente' && new Date(p.dueDate) < new Date();
            }).reduce((sum, p) => sum + p.value, 0);
            
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            const totalProximoMes = data.payments.filter(p => {
                const dueDate = new Date(p.dueDate);
                return p.status === 'pendente' && 
                       dueDate.getMonth() === nextMonth.getMonth() && 
                       dueDate.getFullYear() === nextMonth.getFullYear();
            }).reduce((sum, p) => sum + p.value, 0);

            const avgProgress = data.students.length > 0 ? 
                data.students.reduce((sum, s) => sum + (s.progress || 0), 0) / data.students.length : 0;

            document.getElementById('totalReceita').textContent = formatCurrency(totalReceita);
            document.getElementById('totalVencido').textContent = formatCurrency(totalVencido);
            document.getElementById('totalPendente').textContent = formatCurrency(totalProximoMes);
            document.getElementById('avgProgress').textContent = Math.round(avgProgress) + '%';

            updateLeaderboard();
            updateRecentActivities();
        }

        function updateLeaderboard() {
            const container = document.getElementById('leaderboard');
            if (data.students.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>Dados de ranking aparecer√£o aqui</p>
                    </div>
                `;
                return;
            }

            const sortedStudents = [...data.students]
                .sort((a, b) => (b.xp || 0) - (a.xp || 0))
                .slice(0, 5);

            container.innerHTML = sortedStudents.map((student, index) => {
                const rank = index + 1;
                const rankClass = rank <= 3 ? `top-${rank}` : '';
                const badgeClass = rank <= 3 ? `rank-${rank}` : '';
                
                return `
                    <div class="leaderboard-item ${rankClass}">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div class="rank-badge ${badgeClass}">${rank}</div>
                            <div>
                                <strong>${student.name}</strong><br>
                                <small>${student.course}</small>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="level-badge" style="font-size: 12px; padding: 4px 8px;">
                                N√≠vel ${student.level || 1}
                            </div>
                            <div style="font-size: 12px; color: #666; margin-top: 4px;">
                                ${student.xp || 0} XP
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateRecentActivities() {
            const container = document.getElementById('recentActivities');
            if (data.activities.length === 0) {
                container.innerHTML = `
                    <div class="recent-activity">
                        <strong>Sistema iniciado</strong><br>
                        <small>Bem-vindo ao GameCreators! üéÆ</small>
                    </div>
                `;
                return;
            }

            container.innerHTML = data.activities
                .slice(-5)
                .reverse()
                .map(activity => `
                    <div class="recent-activity">
                        <strong>${activity.action}</strong><br>
                        <small>${new Date(activity.timestamp).toLocaleString('pt-BR')}</small>
                    </div>
                `).join('');
        }

        function addActivity(action) {
            data.activities.push({
                action,
                timestamp: new Date().toISOString(),
                user: data.currentUser?.name || 'Sistema'
            });
            saveData();
        }

        // Students functions
        function loadStudentsView() {
            if (!requirePermission('students')) {
                document.getElementById('students').innerHTML = `
                    <div class="card">
                        <h3>‚ùå Acesso Negado</h3>
                        <p>Voc√™ n√£o tem permiss√£o para acessar a gest√£o de participantes.</p>
                    </div>
                `;
                return;
            }
            populateStudentsContainer();
        }

        function populateStudentsContainer() {
            const container = document.getElementById('studentsContainer');
            
            if (data.students.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>üìö Nenhum participante cadastrado</h3>
                        <p>Clique em "Novo Participante" para come√ßar a cadastrar seus alunos</p>
                    </div>
                `;
                return;
            }

            const studentsHTML = data.students.map(student => {
                const turma = data.turmas.find(t => t.id === student.turmaId);
                const turmaName = turma ? turma.name : 'Sem turma definida';
                
                return `
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="flex: 1;">
                                <h4>${student.name}</h4>
                                <p><strong>üìß Email:</strong> ${student.email}</p>
                                <p><strong>üìö Curso:</strong> ${student.course}</p>
                                <p><strong>üè´ Turma:</strong> ${turmaName}</p>
                                <p><strong>üìû Telefone:</strong> ${student.phone || 'N√£o informado'}</p>
                                
                                <!-- Informa√ß√µes de Gamifica√ß√£o -->
                                <div class="gamification-panel" style="margin: 15px 0; padding: 15px;">
                                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                                        <div class="level-badge">N√≠vel ${student.level || 1}</div>
                                        <div class="points-display">${student.xp || 0} XP</div>
                                        <div class="achievement-badge">üî• ${student.streak || 0} dias</div>
                                    </div>
                                    
                                    <div class="xp-bar" style="margin: 10px 0;">
                                        <div class="xp-fill" style="width: ${getXPPercentage(student.xp, student.level)}%"></div>
                                        <div class="xp-text">${student.xp || 0} / ${getXPForLevel(student.level || 1)} XP</div>
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: right; min-width: 200px;">
                                <span class="status-badge status-${student.status}">${student.status.toUpperCase()}</span>
                                <div style="margin: 10px 0;">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${student.progress || 0}%"></div>
                                        <div class="progress-text">Progresso: ${student.progress || 0}%</div>
                                    </div>
                                </div>
                                <div class="points-display" style="margin-bottom: 10px;">
                                    üèÜ ${student.points || 0} pontos
                                </div>
                                <div>
                                    <button class="btn btn-small" onclick="editStudent('${student.id}')" title="Editar">
                                        ‚úèÔ∏è Editar
                                    </button>
                                    <button class="btn btn-small btn-success" onclick="openProgressModal('${student.id}')" title="Progresso">
                                        üìà Progresso
                                    </button>
                                    <button class="btn btn-small btn-danger" onclick="deleteStudent('${student.id}')" title="Excluir">
                                        üóëÔ∏è Excluir
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                            <div class="grid-2">
                                <div>
                                    <strong>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Respons√°vel:</strong> ${student.responsible.name}<br>
                                    <strong>üìß Email Resp.:</strong> ${student.responsible.email}
                                </div>
                                <div>
                                    <strong>üí∞ Valor Total:</strong> ${formatCurrency(student.contract.value)}<br>
                                    <strong>üìä Parcelas:</strong> ${student.contract.installments}x
                                </div>
                            </div>

                            <!-- Conquistas do Estudante -->
                            ${(student.achievements && student.achievements.length > 0) ? `
                                <div style="margin-top: 15px;">
                                    <strong>üèÜ Conquistas:</strong><br>
                                    <div style="margin-top: 8px;">
                                        ${student.achievements.map(achievementId => {
                                            const achievement = data.achievements.find(a => a.id === achievementId);
                                            return achievement ? `<span class="achievement-badge">${achievement.icon} ${achievement.name}</span>` : '';
                                        }).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = studentsHTML;
        }

        function openProgressModal(studentId) {
            const student = data.students.find(s => s.id === studentId);
            if (!student) return;

            document.getElementById('progressStudent').value = studentId;
            loadStudentProgress();
            openModal('progressModal');
        }

        function searchStudents() {
            const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
            const filteredStudents = data.students.filter(student => 
                student.name.toLowerCase().includes(searchTerm) ||
                student.email.toLowerCase().includes(searchTerm) ||
                student.course.toLowerCase().includes(searchTerm)
            );
            
            const originalStudents = [...data.students];
            data.students = filteredStudents;
            populateStudentsContainer();
            data.students = originalStudents;
        }

        function saveStudent(event) {
            event.preventDefault();
            
            if (!requirePermission('students')) return;
            
            const studentData = {
                id: document.getElementById('editingStudentId').value || Date.now().toString(),
                name: document.getElementById('studentName').value.trim(),
                email: document.getElementById('studentEmail').value.trim(),
                phone: document.getElementById('studentPhone').value.trim(),
                course: document.getElementById('studentCourse').value,
                responsible: {
                    name: document.getElementById('responsibleName').value.trim(),
                    email: document.getElementById('responsibleEmail').value.trim()
                },
                contract: {
                    value: parseFloat(document.getElementById('contractValue').value) || 0,
                    paymentMethod: document.getElementById('paymentMethod').value,
                    installments: parseInt(document.getElementById('installments').value) || 1
                },
                status: 'ativo',
                progress: 0,
                points: parseInt(document.getElementById('studentPoints').value) || 0,
                xp: parseInt(document.getElementById('studentXP').value) || 0,
                level: parseInt(document.getElementById('studentLevel').value) || 1,
                streak: 0,
                lastActivity: new Date().toISOString(),
                moduleProgress: {},
                achievements: ['first_login'],
                createdAt: new Date().toISOString()
            };

            // Valida√ß√£o
            if (!studentData.name || !studentData.email || !studentData.course || 
                !studentData.responsible.name || !studentData.responsible.email) {
                showNotification('‚ùå Preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            // Validar email √∫nico
            const existingStudent = data.students.find(s => s.email === studentData.email && s.id !== studentData.id);
            if (existingStudent) {
                showNotification('‚ùå Este email j√° est√° cadastrado', 'error');
                return;
            }

            const existingIndex = data.students.findIndex(s => s.id === studentData.id);
            if (existingIndex !== -1) {
                // Preservar dados de gamifica√ß√£o no edit
                const existing = data.students[existingIndex];
                studentData.moduleProgress = existing.moduleProgress || {};
                studentData.achievements = existing.achievements || ['first_login'];
                studentData.streak = existing.streak || 0;
                studentData.lastActivity = existing.lastActivity;
                
                data.students[existingIndex] = { ...existing, ...studentData };
                showNotification('‚úÖ Participante atualizado com sucesso!', 'success');
                addActivity(`Participante ${studentData.name} foi atualizado por ${data.currentUser.name}`);
            } else {
                // Inicializar progresso do m√≥dulo para novo estudante
                initializeStudentModuleProgress(studentData);
                
                data.students.push(studentData);
                showNotification('‚úÖ Participante cadastrado com sucesso!', 'success');
                addActivity(`Novo participante cadastrado: ${studentData.name} por ${data.currentUser.name}`);
                
                createInstallments(studentData);
            }

            saveData();
            closeModal('studentModal');
            loadStudentsView();
            updateDashboard();
            updateGamificationStats();
        }

        function initializeStudentModuleProgress(student) {
            const courseModules = data.courseModules[student.course] || [];
            student.moduleProgress = {};
            
            courseModules.forEach(module => {
                student.moduleProgress[module.name] = {
                    completed: 0,
                    total: module.lessons.length
                };
            });
        }

        function editStudent(studentId) {
            const student = data.students.find(s => s.id === studentId);
            if (!student) return;

            document.getElementById('editingStudentId').value = student.id;
            document.getElementById('studentName').value = student.name;
            document.getElementById('studentEmail').value = student.email;
            document.getElementById('studentPhone').value = student.phone || '';
            document.getElementById('studentCourse').value = student.course;
            document.getElementById('responsibleName').value = student.responsible.name;
            document.getElementById('responsibleEmail').value = student.responsible.email;
            document.getElementById('contractValue').value = student.contract.value;
            document.getElementById('paymentMethod').value = student.contract.paymentMethod;
            document.getElementById('installments').value = student.contract.installments;
            document.getElementById('studentPoints').value = student.points || 0;
            document.getElementById('studentXP').value = student.xp || 0;
            document.getElementById('studentLevel').value = student.level || 1;
            
            document.getElementById('studentModalTitle').textContent = '‚úèÔ∏è Editar Participante';
            openModal('studentModal');
        }

        function deleteStudent(studentId) {
            const student = data.students.find(s => s.id === studentId);
            if (!student) return;
            
            if (confirm(`‚ùå Tem certeza que deseja excluir ${student.name}?\n\nEsta a√ß√£o n√£o pode ser desfeita e todos os dados relacionados ser√£o removidos.`)) {
                data.students = data.students.filter(s => s.id !== studentId);
                data.payments = data.payments.filter(p => p.studentId !== studentId);
                
                saveData();
                loadStudentsView();
                updateDashboard();
                updateGamificationStats();
                addActivity(`Participante ${student.name} foi removido do sistema`);
                showNotification(`‚úÖ ${student.name} foi exclu√≠do com sucesso`, 'success');
            }
        }

        // Gamification functions
        function loadGamificationView() {
            if (!requirePermission('gamification')) {
                document.getElementById('gamificacao').innerHTML = `
                    <div class="card">
                        <h3>‚ùå Acesso Negado</h3>
                        <p>Voc√™ n√£o tem permiss√£o para acessar a gamifica√ß√£o.</p>
                    </div>
                `;
                return;
            }
            
            updateGamificationStats();
            loadAchievements();
            loadTopPerformers();
        }

        function loadAchievements() {
            const container = document.getElementById('achievementGrid');
            if (!container) return;
            
            if (data.achievements.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>üèÜ Nenhuma conquista criada</h3>
                        <p>Clique em "Nova Conquista" para come√ßar</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = data.achievements.map(achievement => `
                <div class="achievement-card unlocked">
                    <div class="achievement-icon">${achievement.icon}</div>
                    <strong>${achievement.name}</strong>
                    <p style="font-size: 12px; margin: 8px 0;">${achievement.description}</p>
                    <div style="font-size: 12px; color: #666;">+${achievement.xpReward} XP</div>
                    <button class="btn btn-small btn-danger" onclick="deleteAchievement('${achievement.id}')" style="margin-top: 8px;">
                        üóëÔ∏è Excluir
                    </button>
                </div>
            `).join('');
        }

        function loadTopPerformers() {
            const container = document.getElementById('topPerformers');
            if (data.students.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>Os melhores desempenhos aparecer√£o aqui</p>
                    </div>
                `;
                return;
            }

            const topStudents = [...data.students]
                .sort((a, b) => (b.xp || 0) - (a.xp || 0))
                .slice(0, 10);

            container.innerHTML = topStudents.map((student, index) => {
                const rank = index + 1;
                const rankClass = rank <= 3 ? `top-${rank}` : '';
                const badgeClass = rank <= 3 ? `rank-${rank}` : '';
                
                return `
                    <div class="leaderboard-item ${rankClass}">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div class="rank-badge ${badgeClass}">${rank}</div>
                            <div>
                                <strong>${student.name}</strong><br>
                                <small>${student.course} ‚Ä¢ ${student.achievements?.length || 0} conquistas</small>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="level-badge" style="font-size: 12px; padding: 4px 8px;">
                                N√≠vel ${student.level || 1}
                            </div>
                            <div style="font-size: 12px; color: #666; margin-top: 4px;">
                                ${student.xp || 0} XP ‚Ä¢ üî• ${student.streak || 0} dias
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function saveAchievement(event) {
            event.preventDefault();
            
            const achievementData = {
                id: document.getElementById('editingAchievementId').value || Date.now().toString(),
                name: document.getElementById('achievementName').value.trim(),
                icon: document.getElementById('achievementIcon').value,
                description: document.getElementById('achievementDescription').value.trim(),
                xpReward: parseInt(document.getElementById('achievementXP').value),
                type: document.getElementById('achievementType').value,
                criteria: document.getElementById('achievementCriteria').value.trim()
            };

            if (!achievementData.name || !achievementData.icon || !achievementData.description) {
                showNotification('‚ùå Preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            const existingIndex = data.achievements.findIndex(a => a.id === achievementData.id);
            if (existingIndex !== -1) {
                data.achievements[existingIndex] = achievementData;
                showNotification('‚úÖ Conquista atualizada!', 'success');
            } else {
                data.achievements.push(achievementData);
                showNotification('‚úÖ Conquista criada!', 'success');
            }

            saveData();
            closeModal('achievementModal');
            loadGamificationView();
            addActivity(`Conquista "${achievementData.name}" foi criada`);
        }

        function deleteAchievement(achievementId) {
            const achievement = data.achievements.find(a => a.id === achievementId);
            if (!achievement) return;
            
            if (confirm(`üóëÔ∏è Deseja excluir a conquista "${achievement.name}"?`)) {
                data.achievements = data.achievements.filter(a => a.id !== achievementId);
                
                // Remover das conquistas dos estudantes
                data.students.forEach(student => {
                    if (student.achievements) {
                        student.achievements = student.achievements.filter(id => id !== achievementId);
                    }
                });
                
                saveData();
                loadGamificationView();
                addActivity(`Conquista "${achievement.name}" foi removida`);
                showNotification('‚úÖ Conquista exclu√≠da!', 'success');
            }
        }

        function unlockRandomAchievement() {
            if (data.students.length === 0) {
                showNotification('‚ùå Nenhum participante para desbloquear conquista', 'error');
                return;
            }

            const randomStudent = data.students[Math.floor(Math.random() * data.students.length)];
            const availableAchievements = data.achievements.filter(a => 
                !randomStudent.achievements?.includes(a.id)
            );

            if (availableAchievements.length === 0) {
                showNotification('‚ùå Todos os participantes j√° t√™m todas as conquistas!', 'error');
                return;
            }

            const randomAchievement = availableAchievements[Math.floor(Math.random() * availableAchievements.length)];
            
            if (!randomStudent.achievements) randomStudent.achievements = [];
            randomStudent.achievements.push(randomAchievement.id);
            randomStudent.xp = (randomStudent.xp || 0) + randomAchievement.xpReward;
            randomStudent.level = calculateLevel(randomStudent.xp);

            saveData();
            updateGamificationStats();
            addActivity(`${randomStudent.name} desbloqueou a conquista "${randomAchievement.name}"`);
            showNotification(`üéâ ${randomStudent.name} desbloqueou: ${randomAchievement.icon} ${randomAchievement.name}!`, 'success');
        }

        // Progress tracking functions
        function populateProgressStudentsSelect() {
            const select = document.getElementById('progressStudent');
            if (!select) return;
            
            select.innerHTML = '<option value="">Escolha um participante</option>';
            data.students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = `${student.name} - ${student.course}`;
                select.appendChild(option);
            });
        }

        function loadStudentProgress() {
            const studentId = document.getElementById('progressStudent').value;
            if (!studentId) {
                document.getElementById('progressContent').style.display = 'none';
                return;
            }

            const student = data.students.find(s => s.id === studentId);
            if (!student) return;

            document.getElementById('progressContent').style.display = 'block';

            // Atualizar informa√ß√µes do estudante
            document.getElementById('studentLevelDisplay').textContent = `N√≠vel ${student.level || 1}`;
            document.getElementById('studentPointsDisplay').textContent = `${student.points || 0} Pontos`;
            document.getElementById('studentStreakDisplay').textContent = student.streak || 0;

            // Atualizar barra de XP
            const xpBar = document.getElementById('studentXPBar');
            const xpText = document.getElementById('studentXPText');
            const currentXP = student.xp || 0;
            const nextLevelXP = getXPForLevel(student.level || 1);
            const xpPercentage = getXPPercentage(currentXP, student.level || 1);
            
            xpBar.style.width = xpPercentage + '%';
            xpText.textContent = `${currentXP} / ${nextLevelXP} XP`;

            // Carregar progresso por m√≥dulos
            loadModuleProgress(student);

            // Carregar conquistas do estudante
            loadStudentAchievements(student);
        }

        function loadModuleProgress(student) {
            const container = document.getElementById('moduleProgress');
            const courseModules = data.courseModules[student.course] || [];
            
            if (courseModules.length === 0) {
                container.innerHTML = '<p>Nenhum m√≥dulo encontrado para este curso.</p>';
                return;
            }

            container.innerHTML = courseModules.map(module => {
                const progress = student.moduleProgress?.[module.name] || { completed: 0, total: module.lessons.length };
                const percentage = Math.round((progress.completed / progress.total) * 100);
                
                return `
                    <div class="module-progress">
                        <div class="module-title">${module.name}</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%"></div>
                            <div class="progress-text">${progress.completed}/${progress.total} aulas</div>
                        </div>
                        <div style="margin-top: 10px;">
                            ${module.lessons.map((lesson, index) => {
                                const isCompleted = index < progress.completed;
                                const isCurrent = index === progress.completed;
                                const isLocked = index > progress.completed;
                                
                                let className = 'lesson-item ';
                                if (isCompleted) className += 'lesson-completed';
                                else if (isCurrent) className += 'lesson-current';
                                else className += 'lesson-locked';
                                
                                return `
                                    <div class="${className}">
                                        <span>${lesson}</span>
                                        <span>
                                            ${isCompleted ? '‚úÖ' : isCurrent ? 'üìç' : 'üîí'}
                                        </span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadStudentAchievements(student) {
            const container = document.getElementById('studentAchievements');
            const studentAchievements = student.achievements || [];
            
            if (studentAchievements.length === 0) {
                container.innerHTML = '<p>Nenhuma conquista desbloqueada ainda.</p>';
                return;
            }

            container.innerHTML = studentAchievements.map(achievementId => {
                const achievement = data.achievements.find(a => a.id === achievementId);
                if (!achievement) return '';
                
                return `
                    <div class="achievement-card unlocked">
                        <div class="achievement-icon">${achievement.icon}</div>
                        <strong>${achievement.name}</strong>
                        <p style="font-size: 12px; margin: 8px 0;">${achievement.description}</p>
                        <div style="font-size: 12px; color: #666;">+${achievement.xpReward} XP</div>
                    </div>
                `;
            }).join('');
        }

        function addXPToStudent() {
            const studentId = document.getElementById('progressStudent').value;
            if (!studentId) {
                showNotification('‚ùå Selecione um participante primeiro', 'error');
                return;
            }

            const xpAmount = prompt('Quantos pontos de XP deseja adicionar?', '50');
            if (!xpAmount || isNaN(xpAmount)) return;

            const student = data.students.find(s => s.id === studentId);
            if (!student) return;

            const oldLevel = student.level || 1;
            student.xp = (student.xp || 0) + parseInt(xpAmount);
            student.level = calculateLevel(student.xp);

            if (student.level > oldLevel) {
                showNotification(`üéâ ${student.name} subiu para o n√≠vel ${student.level}!`, 'success');
                addActivity(`${student.name} alcan√ßou o n√≠vel ${student.level}`);
            }

            saveData();
            loadStudentProgress();
            updateGamificationStats();
            showNotification(`‚úÖ ${xpAmount} XP adicionado para ${student.name}!`, 'success');
        }

        function updateStudentProgress() {
            const studentId = document.getElementById('progressStudent').value;
            if (!studentId) {
                showNotification('‚ùå Selecione um participante primeiro', 'error');
                return;
            }

            const student = data.students.find(s => s.id === studentId);
            if (!student) return;

            // Calcular progresso geral baseado nos m√≥dulos
            const courseModules = data.courseModules[student.course] || [];
            let totalLessons = 0;
            let completedLessons = 0;

            courseModules.forEach(module => {
                const progress = student.moduleProgress?.[module.name] || { completed: 0, total: module.lessons.length };
                totalLessons += progress.total;
                completedLessons += progress.completed;
            });

            student.progress = totalLessons > 0 ? Math.round((completedLessons / totalLessons) * 100) : 0;

            saveData();
            loadStudentProgress();
            populateStudentsContainer(); // Atualizar vista de estudantes
            showNotification(`‚úÖ Progresso de ${student.name} atualizado!`, 'success');
        }

        function completeLesson() {
            const studentId = document.getElementById('progressStudent').value;
            if (!studentId) {
                showNotification('‚ùå Selecione um participante primeiro', 'error');
                return;
            }

            const student = data.students.find(s => s.id === studentId);
            if (!student) return;

            // Encontrar pr√≥xima aula para completar
            const courseModules = data.courseModules[student.course] || [];
            let lessonCompleted = false;

            for (const module of courseModules) {
                const progress = student.moduleProgress?.[module.name] || { completed: 0, total: module.lessons.length };
                
                if (progress.completed < progress.total) {
                    progress.completed++;
                    if (!student.moduleProgress) student.moduleProgress = {};
                    student.moduleProgress[module.name] = progress;
                    
                    const xpGained = 25; // XP por aula
                    student.xp = (student.xp || 0) + xpGained;
                    student.level = calculateLevel(student.xp);
                    
                    lessonCompleted = true;
                    addActivity(`${student.name} completou a aula "${module.lessons[progress.completed - 1]}" do m√≥dulo "${module.name}"`);
                    showNotification(`‚úÖ Aula completada! +${xpGained} XP para ${student.name}`, 'success');
                    
                    // Verificar se completou o m√≥dulo
                    if (progress.completed === progress.total) {
                        const moduleXP = 100;
                        student.xp += moduleXP;
                        student.level = calculateLevel(student.xp);
                        showNotification(`üéâ ${student.name} completou o m√≥dulo "${module.name}"! +${moduleXP} XP b√¥nus!`, 'success');
                        addActivity(`${student.name} completou o m√≥dulo "${module.name}"`);
                    }
                    
                    break;
                }
            }

            if (!lessonCompleted) {
                showNotification('‚ùå Todas as aulas j√° foram completadas!', 'error');
                return;
            }

            updateStudentProgress();
            saveData();
            loadStudentProgress();
            updateGamificationStats();
        }

        // Utility functions for gamification
        function calculateLevel(xp) {
            // F√≥rmula: Level = floor(sqrt(XP / 100)) + 1
            return Math.floor(Math.sqrt((xp || 0) / 100)) + 1;
        }

        function getXPForLevel(level) {
            // XP necess√°rio para o n√≠vel: (level - 1)¬≤ * 100
            return Math.pow(level - 1, 2) * 100;
        }

        function getXPForNextLevel(level) {
            return Math.pow(level, 2) * 100;
        }

        function getXPPercentage(currentXP, level) {
            const currentLevelXP = getXPForLevel(level);
            const nextLevelXP = getXPForNextLevel(level);
            const xpInLevel = currentXP - currentLevelXP;
            const xpNeededForNext = nextLevelXP - currentLevelXP;
            return Math.min(100, Math.max(0, (xpInLevel / xpNeededForNext) * 100));
        }

        // Turmas functions
        function loadTurmasView() {
            if (!requirePermission('classes')) {
                document.getElementById('turmas').innerHTML = `
                    <div class="card">
                        <h3>‚ùå Acesso Negado</h3>
                        <p>Voc√™ n√£o tem permiss√£o para acessar a gest√£o de turmas.</p>
                    </div>
                `;
                return;
            }
            populateTurmasContainer();
        }

        function populateTurmasContainer() {
            const container = document.getElementById('turmasContainer');
            
            if (data.turmas.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>üè´ Nenhuma turma cadastrada</h3>
                        <p>Clique em "Nova Turma" para criar sua primeira turma</p>
                    </div>
                `;
                return;
            }

            const turmasHTML = data.turmas.map(turma => {
                const studentsInClass = data.students.filter(s => s.turmaId === turma.id);
                const occupancy = Math.round((studentsInClass.length / turma.capacity) * 100);
                
                return `
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="flex: 1;">
                                <h4>üè´ ${turma.name}</h4>
                                <p><strong>üìö Curso:</strong> ${turma.course}</p>
                                <p><strong>üìÖ Per√≠odo:</strong> ${formatDate(turma.startDate)} at√© ${formatDate(turma.endDate)}</p>
                                <p><strong>‚è∞ Hor√°rio:</strong> ${turma.schedule || 'N√£o definido'}</p>
                                <p><strong>üë• Ocupa√ß√£o:</strong> ${studentsInClass.length}/${turma.capacity} (${occupancy}%)</p>
                                
                                <div class="progress-bar" style="margin: 10px 0;">
                                    <div class="progress-fill" style="width: ${occupancy}%; background: ${occupancy > 80 ? '#f44336' : occupancy > 60 ? '#FF9800' : '#4CAF50'};"></div>
                                    <div class="progress-text">${occupancy}% ocupado</div>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <button class="btn btn-small" onclick="editTurma('${turma.id}')" title="Editar Turma">
                                    ‚úèÔ∏è Editar
                                </button>
                                <button class="btn btn-small btn-danger" onclick="deleteTurma('${turma.id}')" title="Excluir Turma">
                                    üóëÔ∏è Excluir
                                </button>
                            </div>
                        </div>
                        
                        ${studentsInClass.length > 0 ? `
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                                <h5>üë• Participantes da Turma:</h5>
                                <div style="max-height: 200px; overflow-y: auto;">
                                    ${studentsInClass.map(student => `
                                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; margin: 5px 0; background: #f8f9fa; border-radius: 5px;">
                                            <div>
                                                <strong>${student.name}</strong><br>
                                                <small>${student.email} ‚Ä¢ Progresso: ${student.progress || 0}% ‚Ä¢ N√≠vel: ${student.level || 1}</small>
                                            </div>
                                            <div style="display: flex; gap: 5px; align-items: center;">
                                                <div class="level-badge" style="font-size: 10px; padding: 2px 6px;">${student.level || 1}</div>
                                                <div class="points-display" style="font-size: 10px;">
                                                    ${student.xp || 0} XP
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');

            container.innerHTML = turmasHTML;
        }

        function saveTurma(event) {
            event.preventDefault();
            
            const turmaData = {
                id: document.getElementById('editingTurmaId').value || Date.now().toString(),
                name: document.getElementById('turmaName').value.trim(),
                course: document.getElementById('turmaCourse').value,
                startDate: document.getElementById('turmaStart').value,
                endDate: document.getElementById('turmaEnd').value,
                schedule: document.getElementById('turmaSchedule').value,
                capacity: parseInt(document.getElementById('turmaCapacity').value) || 20,
                createdAt: new Date().toISOString()
            };

            // Valida√ß√£o
            if (!turmaData.name || !turmaData.course || !turmaData.startDate || !turmaData.endDate) {
                showNotification('‚ùå Preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            // Validar datas
            if (new Date(turmaData.endDate) <= new Date(turmaData.startDate)) {
                showNotification('‚ùå A data de fim deve ser posterior √† data de in√≠cio', 'error');
                return;
            }

            const existingIndex = data.turmas.findIndex(t => t.id === turmaData.id);
            if (existingIndex !== -1) {
                data.turmas[existingIndex] = { ...data.turmas[existingIndex], ...turmaData };
                showNotification('‚úÖ Turma atualizada com sucesso!', 'success');
                addActivity(`Turma ${turmaData.name} foi atualizada`);
            } else {
                data.turmas.push(turmaData);
                showNotification('‚úÖ Turma criada com sucesso!', 'success');
                addActivity(`Nova turma criada: ${turmaData.name}`);
            }

            saveData();
            closeModal('turmaModal');
            loadTurmasView();
            updateDashboard();
        }

        function editTurma(turmaId) {
            const turma = data.turmas.find(t => t.id === turmaId);
            if (!turma) return;

            document.getElementById('editingTurmaId').value = turma.id;
            document.getElementById('turmaName').value = turma.name;
            document.getElementById('turmaCourse').value = turma.course;
            document.getElementById('turmaStart').value = turma.startDate;
            document.getElementById('turmaEnd').value = turma.endDate;
            document.getElementById('turmaSchedule').value = turma.schedule || '';
            document.getElementById('turmaCapacity').value = turma.capacity || 20;
            
            openModal('turmaModal');
        }

        function deleteTurma(turmaId) {
            const turma = data.turmas.find(t => t.id === turmaId);
            if (!turma) return;
            
            const studentsInTurma = data.students.filter(s => s.turmaId === turmaId);
            if (studentsInTurma.length > 0) {
                showNotification(`‚ùå N√£o √© poss√≠vel excluir a turma "${turma.name}" pois h√° ${studentsInTurma.length} participante(s) matriculado(s)`, 'error');
                return;
            }

            if (confirm(`‚ùå Tem certeza que deseja excluir a turma "${turma.name}"?\n\nEsta a√ß√£o n√£o pode ser desfeita.`)) {
                data.turmas = data.turmas.filter(t => t.id !== turmaId);
                
                saveData();
                loadTurmasView();
                updateDashboard();
                addActivity(`Turma ${turma.name} foi removida do sistema`);
                showNotification(`‚úÖ Turma "${turma.name}" foi exclu√≠da com sucesso`, 'success');
            }
        }

        // Financial functions
        function loadFinancialView() {
            if (!requirePermission('financial')) {
                document.getElementById('financeiro').innerHTML = `
                    <div class="card">
                        <h3>‚ùå Acesso Negado</h3>
                        <p>Voc√™ n√£o tem permiss√£o para acessar o controle financeiro.</p>
                    </div>
                `;
                return;
            }
            updateFinancialSummary();
            loadPaymentsView();
        }

        function updateFinancialSummary() {
            const totalReceita = data.payments.filter(p => p.status === 'pago').reduce((sum, p) => sum + p.value, 0);
            const totalVencido = data.payments.filter(p => {
                return p.status === 'pendente' && new Date(p.dueDate) < new Date();
            }).reduce((sum, p) => sum + p.value, 0);
            
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            const totalProximoMes = data.payments.filter(p => {
                const dueDate = new Date(p.dueDate);
                return p.status === 'pendente' && 
                       dueDate.getMonth() === nextMonth.getMonth() && 
                       dueDate.getFullYear() === nextMonth.getFullYear();
            }).reduce((sum, p) => sum + p.value, 0);

            const saldoCaixa = totalReceita;

            document.getElementById('totalReceita2').textContent = formatCurrency(totalReceita);
            document.getElementById('totalVencido2').textContent = formatCurrency(totalVencido);
            document.getElementById('totalPendente2').textContent = formatCurrency(totalProximoMes);
            document.getElementById('saldoCaixa').textContent = formatCurrency(saldoCaixa);
        }

        function loadPaymentsView() {
            const container = document.getElementById('paymentsContainer');
            
            if (data.payments.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>üí≥ Nenhum pagamento registrado</h3>
                        <p>Os pagamentos aparecer√£o automaticamente quando voc√™ cadastrar participantes com parcelas</p>
                    </div>
                `;
                return;
            }

            // Atualizar status vencido
            data.payments.forEach(payment => {
                if (payment.status === 'pendente' && new Date(payment.dueDate) < new Date()) {
                    payment.status = 'vencido';
                }
            });

            const paymentsHTML = data.payments
                .sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate))
                .map(payment => `
                    <div class="card" style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${payment.studentName}</strong><br>
                                <small>Parcela ${payment.installment} ‚Ä¢ Vencimento: ${formatDate(payment.dueDate)}</small>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 18px; font-weight: bold; margin-bottom: 5px;">
                                    ${formatCurrency(payment.value)}
                                </div>
                                <span class="status-badge status-${payment.status}">${payment.status.toUpperCase()}</span>
                                ${payment.status !== 'pago' ? `
                                    <br><button class="btn btn-small btn-success" onclick="markAsPaid('${payment.id}')" style="margin-top: 5px;">
                                        üí∞ Marcar como Pago
                                    </button>
                                ` : `
                                    <br><small>Pago em: ${formatDate(payment.paymentDate)}</small>
                                `}
                            </div>
                        </div>
                    </div>
                `).join('');

            container.innerHTML = paymentsHTML;
        }

        function populateStudentsSelect() {
            const select = document.getElementById('paymentStudent');
            if (!select) return;
            
            select.innerHTML = '<option value="">Selecione um participante</option>';
            
            data.students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = `${student.name} - ${student.course}`;
                select.appendChild(option);
            });
        }

        function savePayment(event) {
            event.preventDefault();
            
            const paymentData = {
                id: Date.now().toString(),
                studentId: document.getElementById('paymentStudent').value,
                value: parseFloat(document.getElementById('paymentValue').value) || 0,
                paymentDate: document.getElementById('paymentDate').value,
                method: document.getElementById('paymentMethodPayment').value,
                notes: document.getElementById('paymentNotes').value.trim(),
                status: 'pago',
                installment: 'Avulso',
                dueDate: document.getElementById('paymentDate').value
            };

            // Valida√ß√£o
            if (!paymentData.studentId || !paymentData.value || !paymentData.paymentDate) {
                showNotification('‚ùå Preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            const student = data.students.find(s => s.id === paymentData.studentId);
            if (student) {
                paymentData.studentName = student.name;
                
                data.payments.push(paymentData);
                
                saveData();
                closeModal('paymentModal');
                loadFinancialView();
                updateDashboard();
                addActivity(`Pagamento de ${formatCurrency(paymentData.value)} registrado para ${student.name}`);
                showNotification(`‚úÖ Pagamento de ${formatCurrency(paymentData.value)} registrado com sucesso!`, 'success');
            }
        }

        function markAsPaid(paymentId) {
            const payment = data.payments.find(p => p.id === paymentId);
            if (payment && confirm(`üí∞ Confirmar pagamento de ${formatCurrency(payment.value)} de ${payment.studentName}?`)) {
                payment.status = 'pago';
                payment.paymentDate = new Date().toISOString().split('T')[0];
                payment.method = 'manual';
                
                saveData();
                loadFinancialView();
                updateDashboard();
                addActivity(`Pagamento de ${formatCurrency(payment.value)} confirmado para ${payment.studentName}`);
                showNotification(`‚úÖ Pagamento de ${formatCurrency(payment.value)} confirmado!`, 'success');
            }
        }

        function createInstallments(student) {
            if (student.contract.installments <= 1) return;
            
            const installmentValue = student.contract.value / student.contract.installments;
            const today = new Date();
            
            for (let i = 0; i < student.contract.installments; i++) {
                const dueDate = new Date(today);
                dueDate.setMonth(today.getMonth() + i);
                
                data.payments.push({
                    id: Date.now().toString() + '_' + i,
                    studentId: student.id,
                    studentName: student.name,
                    installment: i + 1,
                    value: installmentValue,
                    dueDate: dueDate.toISOString().split('T')[0],
                    status: 'pendente',
                    paymentDate: null,
                    method: null
                });
            }
        }

        // Tab Editor functions
        function populateTabEditorSelect() {
            const select = document.getElementById('editTabSelect');
            if (!select) return;
            
            select.innerHTML = '<option value="">Escolha uma aba</option>';
            
            data.customTabs.forEach(tab => {
                const option = document.createElement('option');
                option.value = tab.id;
                option.textContent = `${tab.icon} ${tab.name}`;
                select.appendChild(option);
            });
        }

        function loadTabForEditing() {
            const tabId = document.getElementById('editTabSelect').value;
            if (!tabId) {
                document.getElementById('tabEditContent').style.display = 'none';
                return;
            }

            const tab = data.customTabs.find(t => t.id === tabId);
            if (!tab) return;

            document.getElementById('tabEditContent').style.display = 'block';
            document.getElementById('editingTabName').textContent = `Editando: ${tab.name}`;
            document.getElementById('editTabName').value = tab.name;
            document.getElementById('editTabIcon').value = tab.icon;
            document.getElementById('editTabContent').value = data.customPages[tab.id] || '';
        }

        function previewTab() {
            const content = document.getElementById('editTabContent').value;
            const preview = document.getElementById('tabPreview');
            const previewContent = document.getElementById('previewContent');
            
            preview.style.display = 'block';
            previewContent.innerHTML = content;
        }

        function saveTabEdits() {
            const tabId = document.getElementById('editTabSelect').value;
            if (!tabId) return;

            const tab = data.customTabs.find(t => t.id === tabId);
            if (!tab) return;

            const newName = document.getElementById('editTabName').value.trim();
            const newIcon = document.getElementById('editTabIcon').value;
            const newContent = document.getElementById('editTabContent').value;

            if (!newName || !newIcon) {
                showNotification('‚ùå Preencha nome e √≠cone', 'error');
                return;
            }

            tab.name = newName;
            tab.icon = newIcon;
            tab.label = `${newIcon} ${newName}`;
            data.customPages[tabId] = newContent;

            saveData();
            initializeTabs(); // Recarregar tabs
            showNotification('‚úÖ Aba atualizada com sucesso!', 'success');
            addActivity(`Aba ${newName} foi editada`);
        }

        // Configuration functions
        function loadConfigView() {
            if (!requirePermission('admin')) {
                document.getElementById('configuracao').innerHTML = `
                    <div class="card">
                        <h3>‚ùå Acesso Negado</h3>
                        <p>Voc√™ n√£o tem permiss√£o para acessar as configura√ß√µes.</p>
                    </div>
                `;
                return;
            }
            
            updateConfigStats();
            loadUsersManagement();
            loadCustomTabsManagement();
            updateCoursesList();
        }

        function updateConfigStats() {
            document.getElementById('configTotalStudents').textContent = data.students.length;
            document.getElementById('configTotalClasses').textContent = data.turmas.length;
            document.getElementById('configTotalPayments').textContent = data.payments.length;
            document.getElementById('configTotalUsers').textContent = data.users.length;
        }

        // User management functions (similares √†s originais, mas com permiss√£o de gamifica√ß√£o)
        function saveUser(event) {
            event.preventDefault();
            
            const userData = {
                id: document.getElementById('editingUserId').value || Date.now().toString(),
                name: document.getElementById('userName').value.trim(),
                email: document.getElementById('userEmail').value.trim().toLowerCase(),
                password: document.getElementById('userPassword').value,
                role: document.getElementById('userRole').value,
                permissions: getSelectedPermissions(),
                active: true,
                createdAt: new Date().toISOString()
            };

            if (!userData.name || !userData.email || !userData.password || !userData.role) {
                showNotification('‚ùå Preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            const existingUser = data.users.find(u => u.email === userData.email && u.id !== userData.id);
            if (existingUser) {
                showNotification('‚ùå Este email j√° est√° cadastrado', 'error');
                return;
            }

            const existingIndex = data.users.findIndex(u => u.id === userData.id);
            if (existingIndex !== -1) {
                if (userData.password === '******') {
                    userData.password = data.users[existingIndex].password;
                }
                data.users[existingIndex] = { ...data.users[existingIndex], ...userData };
                showNotification('‚úÖ Usu√°rio atualizado com sucesso!', 'success');
                addActivity(`Usu√°rio ${userData.name} foi atualizado`);
            } else {
                data.users.push(userData);
                showNotification('‚úÖ Usu√°rio criado com sucesso!', 'success');
                addActivity(`Novo usu√°rio criado: ${userData.name}`);
            }

            saveData();
            closeModal('userModal');
            loadUsersManagement();
            updateConfigStats();
        }

        function getSelectedPermissions() {
            const permissions = [];
            document.querySelectorAll('#permissionsContainer input[type="checkbox"]:checked').forEach(checkbox => {
                permissions.push(checkbox.value);
            });
            return permissions;
        }

        function updatePermissionsForRole() {
            const role = document.getElementById('userRole').value;
            const checkboxes = document.querySelectorAll('#permissionsContainer input[type="checkbox"]');
            
            checkboxes.forEach(cb => cb.checked = false);
            
            const rolePermissions = {
                admin: ['dashboard', 'students', 'classes', 'financial', 'gamification', 'admin', 'users', 'custom_tabs'],
                teacher: ['dashboard', 'students', 'classes', 'gamification'],
                financial: ['dashboard', 'financial', 'students'],
                assistant: ['dashboard', 'students', 'gamification']
            };
            
            if (rolePermissions[role]) {
                rolePermissions[role].forEach(permission => {
                    const checkbox = document.getElementById(`perm_${permission}`);
                    if (checkbox) checkbox.checked = true;
                });
            }
        }

        function loadUsersManagement() {
            const usersContainer = document.getElementById('usersContainer');
            if (!usersContainer) return;
            
            const usersHTML = data.users.map(user => `
                <div class="card" style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${user.name}</strong> <span class="status-badge status-${user.active ? 'ativo' : 'cancelado'}">${user.active ? 'ATIVO' : 'INATIVO'}</span><br>
                            <small>üìß ${user.email} ‚Ä¢ üë§ ${user.role.toUpperCase()}</small><br>
                            <small>üîë Permiss√µes: ${user.permissions.join(', ')}</small>
                        </div>
                        <div>
                            <button class="btn btn-small" onclick="editUser('${user.id}')">‚úèÔ∏è Editar</button>
                            <button class="btn btn-small btn-warning" onclick="changePassword('${user.id}')">üîë Senha</button>
                            <button class="btn btn-small ${user.active ? 'btn-danger' : 'btn-success'}" onclick="toggleUserStatus('${user.id}')">
                                ${user.active ? 'üö´ Desativar' : '‚úÖ Ativar'}
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            usersContainer.innerHTML = usersHTML;
        }

        // Utility functions
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value || 0);
        }

        function formatDate(dateString) {
            if (!dateString) return 'Data n√£o informada';
            return new Date(dateString + 'T00:00:00').toLocaleDateString('pt-BR');
        }

        function addCourse() {
            const courseInput = document.getElementById('newCourse');
            const courseName = courseInput.value.trim();
            
            if (!courseName) {
                showNotification('‚ùå Digite o nome do curso', 'error');
                return;
            }
            
            if (data.courses.includes(courseName)) {
                showNotification('‚ùå Este curso j√° existe', 'error');
                return;
            }
            
            data.courses.push(courseName);
            data.courseModules[courseName] = [
                { name: 'M√≥dulo Introdut√≥rio', lessons: ['Aula 1', 'Aula 2', 'Aula 3'] },
                { name: 'M√≥dulo B√°sico', lessons: ['Aula 1', 'Aula 2', 'Aula 3'] },
                { name: 'M√≥dulo Avan√ßado', lessons: ['Aula 1', 'Aula 2', 'Aula 3'] }
            ];
            
            courseInput.value = '';
            saveData();
            populateCourseSelects();
            addActivity(`Novo curso adicionado: ${courseName}`);
            showNotification(`‚úÖ Curso "${courseName}" adicionado com sucesso!`, 'success');
            updateCoursesList();
        }

        function updateCoursesList() {
            const container = document.getElementById('coursesList');
            if (container) {
                container.innerHTML = `
                    <div class="grid-2" style="margin: 10px 0;">
                        ${data.courses.map(course => `<span>üìö ${course}</span>`).join('')}
                    </div>
                `;
            }
        }

        // Data management
        function saveData() {
            try {
                const dataToSave = {
                    students: data.students,
                    turmas: data.turmas,
                    payments: data.payments,
                    courses: data.courses,
                    courseModules: data.courseModules,
                    activities: data.activities.slice(-50),
                    users: data.users,
                    customTabs: data.customTabs,
                    customPages: data.customPages,
                    achievements: data.achievements,
                    gamificationStats: data.gamificationStats,
                    lastSaved: new Date().toISOString()
                };
                const dataString = JSON.stringify(dataToSave);
                if (dataString.length < 5000000) {
                    localStorage.setItem('gamecreators_data', dataString);
                }
            } catch (error) {
                console.error('Error saving data:', error);
                showNotification('‚ö†Ô∏è Erro ao salvar dados. Espa√ßo insuficiente.', 'error');
            }
        }

        function loadStoredData() {
            try {
                const storedData = localStorage.getItem('gamecreators_data');
                if (storedData) {
                    const parsedData = JSON.parse(storedData);
                    Object.assign(data, parsedData);
                    
                    data.users = data.users || [];
                    data.customTabs = data.customTabs || [];
                    data.customPages = data.customPages || {};
                    data.achievements = data.achievements || [];
                    data.gamificationStats = data.gamificationStats || { totalXP: 0, totalAchievements: 0, avgLevel: 1, activeStreaks: 0 };
                }
            } catch (error) {
                console.error('Error loading data:', error);
                showNotification('‚ö†Ô∏è Erro ao carregar dados salvos', 'error');
            }
        }

        // Custom tab functions
        function saveCustomTab(event) {
            event.preventDefault();
            
            const tabData = {
                id: document.getElementById('editingCustomTabId').value || 'custom_' + Date.now().toString(),
                label: document.getElementById('customTabIcon').value + ' ' + document.getElementById('customTabName').value,
                permission: document.getElementById('customTabPermission').value.toLowerCase(),
                icon: document.getElementById('customTabIcon').value,
                name: document.getElementById('customTabName').value,
                description: document.getElementById('customTabDescription').value,
                content: document.getElementById('customTabContent').value,
                color: document.getElementById('customTabColor').value || '#2196F3',
                createdAt: new Date().toISOString()
            };

            if (!tabData.name || !tabData.icon || !tabData.permission) {
                showNotification('‚ùå Preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            const existingTab = data.customTabs.find(t => t.permission === tabData.permission && t.id !== tabData.id);
            if (existingTab) {
                showNotification('‚ùå J√° existe uma aba com esta permiss√£o', 'error');
                return;
            }

            const existingIndex = data.customTabs.findIndex(t => t.id === tabData.id);
            if (existingIndex !== -1) {
                data.customTabs[existingIndex] = { ...data.customTabs[existingIndex], ...tabData };
                showNotification('‚úÖ Aba atualizada com sucesso!', 'success');
                addActivity(`Aba customizada ${tabData.name} foi atualizada`);
            } else {
                data.customTabs.push(tabData);
                showNotification('‚úÖ Aba criada com sucesso!', 'success');
                addActivity(`Nova aba customizada criada: ${tabData.name}`);
            }

            data.customPages[tabData.id] = tabData.content;

            saveData();
            closeModal('customTabModal');
            loadCustomTabsManagement();
            initializeTabs();
            showNotification('üîÑ Aba criada! Ela aparecer√° na navega√ß√£o.', 'info');
        }

        function loadCustomTab(tabId) {
            const content = data.customPages[tabId];
            const tab = data.customTabs.find(t => t.id === tabId);
            
            if (!content || !tab) {
                document.getElementById(tabId).innerHTML = `
                    <div class="card">
                        <h3>‚ùå Aba n√£o encontrada</h3>
                        <p>O conte√∫do desta aba n√£o foi encontrado.</p>
                    </div>
                `;
                return;
            }

            if (tab.color) {
                const style = document.createElement('style');
                style.textContent = `
                    #${tabId} .btn { background: ${tab.color}; }
                    #${tabId} .stat-card { background: linear-gradient(135deg, ${tab.color} 0%, ${tab.color}DD 100%); }
                    #${tabId} .card-title { color: ${tab.color}; }
                `;
                document.head.appendChild(style);
            }

            document.getElementById(tabId).innerHTML = content;
        }

        function loadCustomTabsManagement() {
            const tabsContainer = document.getElementById('customTabsContainer');
            if (!tabsContainer) return;
            
            if (data.customTabs.length === 0) {
                tabsContainer.innerHTML = `
                    <div class="empty-state">
                        <h3>üìë Nenhuma aba customizada</h3>
                        <p>Clique em "Nova Aba" para criar funcionalidades personalizadas</p>
                    </div>
                `;
                return;
            }
            
            const tabsHTML = data.customTabs.map(tab => `
                <div class="card" style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${tab.label}</strong><br>
                            <small>üîë Permiss√£o: ${tab.permission} ‚Ä¢ üìÖ Criada em: ${formatDate(tab.createdAt.split('T')[0])}</small>
                        </div>
                        <div>
                            <button class="btn btn-small" onclick="editCustomTab('${tab.id}')">‚úèÔ∏è Editar</button>
                            <button class="btn btn-small btn-danger" onclick="deleteCustomTab('${tab.id}')">üóëÔ∏è Excluir</button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            tabsContainer.innerHTML = tabsHTML;
        }

        // Auto-save and initialization
        setInterval(() => {
            if (data.currentUser) {
                saveData();
            }
        }, 30000);

        window.addEventListener('beforeunload', function() {
            if (data.currentUser) {
                saveData();
            }
        });

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Initialize demo notification
        setTimeout(() => {
            if (data.currentUser) {
                showNotification('üí° Sistema completo com gamifica√ß√£o e editor de abas!', 'info');
            }
        }, 2000);
    </script>
</body>
</html>        function requirePermission(permission) {
            if (!hasPermission(permission)) {
                showNotification('‚ùå Voc√™ n√£o tem permiss√£o para acessar esta funcionalidade', 'error');
                return false;
            }
            return true;
        }

        // Fun√ß√µes de modal
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'block';
                
                if (modalId === 'paymentModal') {
                    populateStudentsSelect();
                } else if (modalId === 'progressModal') {
                    populateProgressStudentsSelect();
                } else if (modalId === 'tabEditorModal') {
                    populateTabEditorSelect();
                }
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                clearModalForms(modalId);
            }
        }

        function clearModalForms(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.querySelectorAll('input:not([type="hidden"]), select, textarea').forEach(input => {
                    if (input.type === 'date' && input.id === 'paymentDate') {
                        input.value = new Date().toISOString().split('T')[0];
                    } else if (input.type === 'number' && input.id === 'installments') {
                        input.value = '1';
                    } else if (input.id === 'studentLevel') {
                        input.value = '1';
                    } else if (input.id === 'studentXP' || input.id === 'studentPoints') {
                        input.value = '<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameCreators - Sistema de Gest√£o</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .login-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .main-app {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            min-height: 100vh;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.2);
        }

        .header {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 5px;
            overflow-x: auto;
        }

        .nav-tab {
            padding: 12px 20px;
            background: #f5f5f5;
            border: none;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 14px;
            white-space: nowrap;
            position: relative;
        }

        .nav-tab.active {
            background: #2196F3;
            color: white;
            transform: translateY(-2px);
        }

        .nav-tab:hover {
            background: #1976D2;
            color: white;
        }

        .nav-tab.custom-tab {
            background: linear-gradient(135deg, #9C27B0, #673AB7);
            color: white;
        }

        .nav-tab.custom-tab:hover {
            background: linear-gradient(135deg, #7B1FA2, #512DA8);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.3);
        }

        .btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: #1976D2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }

        .btn-secondary { background: #FF9800; }
        .btn-secondary:hover { background: #F57C00; }
        .btn-danger { background: #f44336; }
        .btn-danger:hover { background: #d32f2f; }
        .btn-success { background: #4CAF50; }
        .btn-success:hover { background: #45a049; }
        .btn-warning { background: #FF9800; }
        .btn-warning:hover { background: #F57C00; }
        .btn-small { padding: 6px 12px; font-size: 12px; }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .table th {
            background: #f5f5f5;
            font-weight: 600;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: scale(1.05);
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }

        .close:hover {
            color: #f44336;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10001;
            transform: translateX(400px);
            transition: transform 0.3s;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: #4CAF50; }
        .notification.error { background: #f44336; }
        .notification.info { background: #2196F3; }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-size: 12px;
            font-weight: 500;
        }

        .status-ativo { background: #4CAF50; }
        .status-inadimplente { background: #f44336; }
        .status-cancelado { background: #9E9E9E; }
        .status-trancado { background: #FF9800; }
        .status-formado { background: #4CAF50; }
        .status-pago { background: #4CAF50; }
        .status-pendente { background: #FF9800; }
        .status-vencido { background: #f44336; }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            transition: width 0.5s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: bold;
            color: #333;
        }

        .points-display {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            padding: 5px 10px;
            border-radius: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 12px;
            display: inline-block;
            margin: 5px;
        }

        .achievement-badge {
            background: linear-gradient(135deg, #9C27B0, #673AB7);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            margin: 2px;
            display: inline-block;
        }

        .level-badge {
            background: linear-gradient(135deg, #FF5722, #E91E63);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
        }

        .search-box {
            width: 300px;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 16px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 10px;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2196F3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .module-progress {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #2196F3;
        }

        .module-title {
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 8px;
        }

        .lesson-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border-left: 3px solid transparent;
        }

        .lesson-completed {
            border-left-color: #4CAF50;
            background: #f1f8e9;
        }

        .lesson-current {
            border-left-color: #FF9800;
            background: #fff3e0;
        }

        .lesson-locked {
            border-left-color: #9E9E9E;
            background: #f5f5f5;
            opacity: 0.7;
        }

        .gamification-panel {
            background: linear-gradient(135deg, #6A1B9A, #8E24AA);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .xp-bar {
            background: rgba(255,255,255,0.2);
            height: 25px;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }

        .xp-fill {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            height: 100%;
            transition: width 0.5s ease;
        }

        .xp-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: bold;
            color: #333;
        }

        .streak-display {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #FF5722, #FF8A65);
            border-radius: 10px;
            color: white;
            margin: 10px 0;
        }

        .streak-number {
            font-size: 24px;
            font-weight: bold;
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .achievement-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }

        .achievement-card.unlocked {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #E8F5E8, #F1F8E9);
        }

        .achievement-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }

        .tab-editor {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin: 10px 0;
        }

        .tab-editor-header {
            background: #f5f5f5;
            padding: 10px 15px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-editor {
            font-family: 'Courier New', monospace;
            min-height: 200px;
            padding: 15px;
            border: none;
            resize: vertical;
            background: #f9f9f9;
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .nav-tabs { flex-direction: column; }
            .nav-tab { border-radius: 8px; margin-bottom: 5px; }
            .action-buttons { flex-direction: column; align-items: flex-start; }
            .table { font-size: 14px; }
            .table th, .table td { padding: 8px; }
        }

        .welcome-message {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .quick-stat {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #2196F3;
        }

        .recent-activity {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #2196F3;
        }

        .demo-badge {
            background: #FF5722;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .leaderboard {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #ddd;
        }

        .leaderboard-item.top-1 { border-left-color: #FFD700; background: #FFFBF0; }
        .leaderboard-item.top-2 { border-left-color: #C0C0C0; background: #F8F8F8; }
        .leaderboard-item.top-3 { border-left-color: #CD7F32; background: #FDF6F0; }

        .rank-badge {
            background: #2196F3;
            color: white;
            padding: 4px 8px;
            border-radius: 50%;
            font-weight: bold;
            min-width: 30px;
            text-align: center;
        }

        .rank-badge.rank-1 { background: #FFD700; color: #333; }
        .rank-badge.rank-2 { background: #C0C0C0; color: #333; }
        .rank-badge.rank-3 { background: #CD7F32; color: white; }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="demo-badge">DEMO</div>
            <h1 style="color: #2196F3; margin-bottom: 10px;">üéÆ GameCreators</h1>
            <p style="color: #666; margin-bottom: 30px;">Sistema de Gest√£o Educacional</p>
            
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" placeholder="admin@gamecreators.com" value="admin@gamecreators.com">
            </div>
            <div class="form-group">
                <label for="password">Senha:</label>
                <input type="password" id="password" placeholder="Digite sua senha" value="123456">
            </div>
            <button class="btn" onclick="login()">üîê Entrar</button>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app">
        <div class="header">
            <div>
                <h1>üéÆ GameCreators - Sistema de Gest√£o</h1>
                <p id="userWelcome">Bem-vindo!</p>
            </div>
            <button class="btn btn-danger" onclick="logout()">üö™ Sair</button>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs" id="navTabs"></div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="welcome-message">
                <h2>üìä Dashboard - Vis√£o Geral</h2>
                <p>Acompanhe as principais m√©tricas e atividades da sua institui√ß√£o</p>
            </div>

            <div class="quick-stats">
                <div class="quick-stat">
                    <div style="font-size: 24px; font-weight: bold; color: #2196F3;" id="totalStudents">0</div>
                    <div style="font-size: 14px; color: #666;">Participantes</div>
                </div>
                <div class="quick-stat">
                    <div style="font-size: 24px; font-weight: bold; color: #4CAF50;" id="activeStudents">0</div>
                    <div style="font-size: 14px; color: #666;">Ativos</div>
                </div>
                <div class="quick-stat">
                    <div style="font-size: 24px; font-weight: bold; color: #FF9800;" id="totalClasses">0</div>
                    <div style="font-size: 14px; color: #666;">Turmas</div>
                </div>
                <div class="quick-stat">
                    <div style="font-size: 24px; font-weight: bold; color: #9C27B0;" id="totalCourses">0</div>
                    <div style="font-size: 14px; color: #666;">Cursos</div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card" style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);">
                    <div class="stat-number" id="totalReceita">R$ 0,00</div>
                    <div class="stat-label">üí∞ Receita Total</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);">
                    <div class="stat-number" id="totalVencido">R$ 0,00</div>
                    <div class="stat-label">‚ö†Ô∏è Valores Vencidos</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);">
                    <div class="stat-number" id="totalPendente">R$ 0,00</div>
                    <div class="stat-label">‚è≥ Pr√≥ximo M√™s</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);">
                    <div class="stat-number" id="avgProgress">0%</div>
                    <div class="stat-label">üìà Progresso M√©dio</div>
                </div>
            </div>

            <div class="grid-2">
                <!-- Ranking de Participantes -->
                <div class="leaderboard">
                    <h3 class="card-title">üèÜ Ranking de Participantes</h3>
                    <div id="leaderboard">
                        <div class="empty-state">
                            <p>Dados de ranking aparecer√£o aqui</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">üìù Atividades Recentes</h3>
                    <div id="recentActivities">
                        <div class="recent-activity">
                            <strong>Sistema iniciado</strong><br>
                            <small>Bem-vindo ao GameCreators!</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Students Tab -->
        <div id="students" class="tab-content">
            <div class="action-buttons">
                <h2>üë• Gest√£o de Participantes</h2>
                <button class="btn" onclick="openModal('studentModal')">‚ûï Novo Participante</button>
                <button class="btn btn-secondary" onclick="generateStudentReport()">üìä Relat√≥rio</button>
                <button class="btn btn-success" onclick="openModal('progressModal')">üìà Acompanhar Progresso</button>
            </div>
            
            <input type="text" id="studentSearch" placeholder="üîç Buscar participante..." 
                   onkeyup="searchStudents()" class="search-box">
            
            <div id="studentsContainer">
                <div class="empty-state">
                    <h3>Nenhum participante cadastrado</h3>
                    <p>Clique em "Novo Participante" para come√ßar</p>
                </div>
            </div>
        </div>

        <!-- Classes Tab -->
        <div id="turmas" class="tab-content">
            <div class="action-buttons">
                <h2>üè´ Gest√£o de Turmas</h2>
                <button class="btn" onclick="openModal('turmaModal')">‚ûï Nova Turma</button>
                <button class="btn btn-secondary" onclick="generateClassReport()">üìä Relat√≥rio</button>
            </div>
            <div id="turmasContainer">
                <div class="empty-state">
                    <h3>Nenhuma turma cadastrada</h3>
                    <p>Clique em "Nova Turma" para come√ßar</p>
                </div>
            </div>
        </div>

        <!-- Financial Tab -->
        <div id="financeiro" class="tab-content">
            <h2>üí∞ Controle Financeiro</h2>
            
            <div class="stats-grid">
                <div class="stat-card" style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);">
                    <div class="stat-number" id="totalReceita2">R$ 0,00</div>
                    <div class="stat-label">üí∞ Receita Total</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);">
                    <div class="stat-number" id="totalVencido2">R$ 0,00</div>
                    <div class="stat-label">‚ö†Ô∏è Vencidos</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);">
                    <div class="stat-number" id="totalPendente2">R$ 0,00</div>
                    <div class="stat-label">‚è≥ Pr√≥ximo M√™s</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);">
                    <div class="stat-number" id="saldoCaixa">R$ 0,00</div>
                    <div class="stat-label">üè¶ Saldo Caixa</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn" onclick="openModal('paymentModal')">üí≥ Registrar Pagamento</button>
                <button class="btn btn-secondary" onclick="generateFinancialReport()">üìä Relat√≥rio</button>
                <button class="btn btn-success" onclick="showNotification('Funcionalidade em desenvolvimento', 'info')">üìÑ Gerar Boleto</button>
            </div>

            <div class="card">
                <h3 class="card-title">üí≥ Pagamentos Recentes</h3>
                <div id="paymentsContainer">
                    <div class="empty-state">
                        <h3>Nenhum pagamento registrado</h3>
                        <p>Os pagamentos aparecer√£o aqui automaticamente</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gamification Tab -->
        <div id="gamificacao" class="tab-content">
            <div class="welcome-message">
                <h2>üéÆ Centro de Gamifica√ß√£o</h2>
                <p>Acompanhe conquistas, rankings e progresso dos participantes</p>
            </div>

            <div class="grid-2">
                <!-- Sistema de Conquistas -->
                <div class="card">
                    <h3 class="card-title">üèÜ Sistema de Conquistas</h3>
                    <div class="action-buttons">
                        <button class="btn" onclick="openModal('achievementModal')">‚ûï Nova Conquista</button>
                        <button class="btn btn-secondary" onclick="unlockRandomAchievement()">üéÅ Desbloquear Teste</button>
                    </div>
                    <div id="achievementsContainer">
                        <div class="achievement-grid" id="achievementGrid">
                            <!-- Conquistas ser√£o carregadas aqui -->
                        </div>
                    </div>
                </div>

                <!-- Estat√≠sticas de Gamifica√ß√£o -->
                <div class="card">
                    <h3 class="card-title">üìä Estat√≠sticas Globais</h3>
                    <div class="quick-stats">
                        <div class="quick-stat">
                            <div style="font-size: 20px; font-weight: bold; color: #FFD700;" id="totalXP">0</div>
                            <div style="font-size: 12px; color: #666;">XP Total</div>
                        </div>
                        <div class="quick-stat">
                            <div style="font-size: 20px; font-weight: bold; color: #9C27B0;" id="totalAchievements">0</div>
                            <div style="font-size: 12px; color: #666;">Conquistas</div>
                        </div>
                        <div class="quick-stat">
                            <div style="font-size: 20px; font-weight: bold; color: #FF5722;" id="avgLevel">1</div>
                            <div style="font-size: 12px; color: #666;">N√≠vel M√©dio</div>
                        </div>
                        <div class="quick-stat">
                            <div style="font-size: 20px; font-weight: bold; color: #4CAF50;" id="activeStreaks">0</div>
                            <div style="font-size: 12px; color: #666;">Sequ√™ncias Ativas</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Performers -->
            <div class="leaderboard">
                <h3 class="card-title">ü•á Hall da Fama</h3>
                <div id="topPerformers">
                    <div class="empty-state">
                        <p>Os melhores desempenhos aparecer√£o aqui</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Tab -->
        <div id="configuracao" class="tab-content">
            <div class="card">
                <h3 class="card-title">‚öôÔ∏è Configura√ß√µes do Sistema</h3>
                
                <!-- Gest√£o de Usu√°rios -->
                <div style="margin-bottom: 40px;">
                    <h4>üë• Gest√£o de Usu√°rios</h4>
                    <div class="action-buttons">
                        <button class="btn" onclick="openModal('userModal')">‚ûï Novo Usu√°rio</button>
                        <button class="btn btn-secondary" onclick="openModal('changePasswordModal')">üîë Alterar Minha Senha</button>
                    </div>
                    <div id="usersContainer"></div>
                </div>

                <!-- Gest√£o de Abas Customizadas -->
                <div style="margin-bottom: 40px;">
                    <h4>üìë Abas Personalizadas</h4>
                    <div class="action-buttons">
                        <button class="btn" onclick="openModal('customTabModal')">‚ûï Nova Aba</button>
                        <button class="btn btn-secondary" onclick="openModal('tabEditorModal')">‚úèÔ∏è Editor de Abas</button>
                    </div>
                    <div id="customTabsContainer"></div>
                </div>
                
                <!-- Cursos -->
                <div style="margin-bottom: 40px;">
                    <h4>üìö Cursos Dispon√≠veis</h4>
                    <div id="coursesList">
                        <div class="grid-2" style="margin: 10px 0;">
                            <span>üìö Desenvolvimento de Jogos</span>
                            <span>üìö Design Gr√°fico</span>
                            <span>üìö Programa√ß√£o Web</span>
                            <span>üìö Mobile Development</span>
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <input type="text" id="newCourse" placeholder="Nome do novo curso" style="width: 300px; margin-right: 10px;">
                        <button class="btn" onclick="addCourse()">‚ûï Adicionar Curso</button>
                    </div>
                </div>

                <!-- Backup e Dados -->
                <div style="margin-bottom: 40px;">
                    <h4 style="margin-top: 30px;">üíæ Dados do Sistema</h4>
                    <div class="action-buttons">
                        <button class="btn" onclick="exportData()">üì• Exportar Dados</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì§ Importar Dados</button>
                        <button class="btn btn-warning" onclick="clearAllData()">üóëÔ∏è Limpar Dados</button>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                    </div>
                </div>

                <!-- Estat√≠sticas -->
                <h4 style="margin-top: 30px;">üìä Estat√≠sticas do Sistema</h4>
                <div class="quick-stats">
                    <div class="quick-stat">
                        <div style="font-size: 20px; font-weight: bold; color: #2196F3;" id="configTotalStudents">0</div>
                        <div style="font-size: 12px; color: #666;">Total de Participantes</div>
                    </div>
                    <div class="quick-stat">
                        <div style="font-size: 20px; font-weight: bold; color: #4CAF50;" id="configTotalClasses">0</div>
                        <div style="font-size: 12px; color: #666;">Total de Turmas</div>
                    </div>
                    <div class="quick-stat">
                        <div style="font-size: 20px; font-weight: bold; color: #FF9800;" id="configTotalPayments">0</div>
                        <div style="font-size: 12px; color: #666;">Total de Pagamentos</div>
                    </div>
                    <div class="quick-stat">
                        <div style="font-size: 20px; font-weight: bold; color: #9C27B0;" id="configTotalUsers">0</div>
                        <div style="font-size: 12px; color: #666;">Total de Usu√°rios</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Modal -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('studentModal')">&times;</span>
            <h2 id="studentModalTitle">üë• Cadastro de Participante</h2>
            
            <form onsubmit="saveStudent(event)">
                <div class="grid-2">
                    <div class="form-group">
                        <label>Nome Completo: *</label>
                        <input type="text" id="studentName" required>
                    </div>
                    <div class="form-group">
                        <label>Email: *</label>
                        <input type="email" id="studentEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Telefone:</label>
                        <input type="tel" id="studentPhone">
                    </div>
                    <div class="form-group">
                        <label>Curso: *</label>
                        <select id="studentCourse" required onchange="updateTurmaOptions()">
                            <option value="">Selecione um curso</option>
                        </select>
                    </div>
                </div>
                
                <h3>üéÆ Configura√ß√µes de Gamifica√ß√£o</h3>
                <div class="grid-3">
                    <div class="form-group">
                        <label>XP Inicial:</label>
                        <input type="number" id="studentXP" value="0" min="0">
                    </div>
                    <div class="form-group">
                        <label>N√≠vel Inicial:</label>
                        <input type="number" id="studentLevel" value="1" min="1" max="100">
                    </div>
                    <div class="form-group">
                        <label>Pontos:</label>
                        <input type="number" id="studentPoints" value="0" min="0">
                    </div>
                </div>
                
                <h3>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Respons√°vel Financeiro</h3>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Nome do Respons√°vel: *</label>
                        <input type="text" id="responsibleName" required>
                    </div>
                    <div class="form-group">
                        <label>Email do Respons√°vel: *</label>
                        <input type="email" id="responsibleEmail" required>
                    </div>
                </div>
                
                <h3>üí∞ Dados do Contrato</h3>
                <div class="grid-3">
                    <div class="form-group">
                        <label>Valor Total: *</label>
                        <input type="number" id="contractValue" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Forma de Pagamento:</label>
                        <select id="paymentMethod">
                            <option value="avista">√Ä Vista</option>
                            <option value="parcelado">Parcelado</option>
                            <option value="semestral">Semestral</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>N√∫mero de Parcelas:</label>
                        <input type="number" id="installments" value="1" min="1" max="24">
                    </div>
                </div>
                
                <button type="submit" class="btn">üíæ Salvar Turma</button>
                <input type="hidden" id="editingTurmaId">
            </form>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('paymentModal')">&times;</span>
            <h2>üí≥ Registrar Pagamento</h2>
            
            <form onsubmit="savePayment(event)">
                <div class="grid-2">
                    <div class="form-group">
                        <label>Participante: *</label>
                        <select id="paymentStudent" required>
                            <option value="">Selecione um participante</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Valor: *</label>
                        <input type="number" id="paymentValue" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Data do Pagamento: *</label>
                        <input type="date" id="paymentDate" required>
                    </div>
                    <div class="form-group">
                        <label>M√©todo de Pagamento:</label>
                        <select id="paymentMethodPayment">
                            <option value="dinheiro">üíµ Dinheiro</option>
                            <option value="cartao">üí≥ Cart√£o</option>
                            <option value="pix">üì± PIX</option>
                            <option value="transferencia">üè¶ Transfer√™ncia</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Observa√ß√µes:</label>
                    <textarea id="paymentNotes" rows="3" placeholder="Informa√ß√µes adicionais sobre o pagamento"></textarea>
                </div>
                
                <button type="submit" class="btn">üíæ Registrar Pagamento</button>
            </form>
        </div>
    </div>

    <!-- User Management Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('userModal')">&times;</span>
            <h2 id="userModalTitle">üë§ Novo Usu√°rio</h2>
            
            <form onsubmit="saveUser(event)">
                <div class="grid-2">
                    <div class="form-group">
                        <label>Nome Completo: *</label>
                        <input type="text" id="userName" required>
                    </div>
                    <div class="form-group">
                        <label>Email: *</label>
                        <input type="email" id="userEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Senha: *</label>
                        <input type="password" id="userPassword" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label>Perfil: *</label>
                        <select id="userRole" required onchange="updatePermissionsForRole()">
                            <option value="">Selecione um perfil</option>
                            <option value="admin">üëë Administrador</option>
                            <option value="teacher">üë®‚Äçüè´ Professor</option>
                            <option value="financial">üí∞ Financeiro</option>
                            <option value="assistant">üë§ Assistente</option>
                            <option value="custom">‚öôÔ∏è Personalizado</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Permiss√µes:</label>
                    <div id="permissionsContainer" class="grid-3" style="margin-top: 10px;">
                        <label><input type="checkbox" id="perm_dashboard" value="dashboard"> üìä Dashboard</label>
                        <label><input type="checkbox" id="perm_students" value="students"> üë• Participantes</label>
                        <label><input type="checkbox" id="perm_classes" value="classes"> üè´ Turmas</label>
                        <label><input type="checkbox" id="perm_financial" value="financial"> üí∞ Financeiro</label>
                        <label><input type="checkbox" id="perm_gamification" value="gamification"> üéÆ Gamifica√ß√£o</label>
                        <label><input type="checkbox" id="perm_admin" value="admin"> ‚öôÔ∏è Configura√ß√µes</label>
                        <label><input type="checkbox" id="perm_users" value="users"> üë• Usu√°rios</label>
                        <label><input type="checkbox" id="perm_custom_tabs" value="custom_tabs"> üìë Abas Custom</label>
                    </div>
                </div>
                
                <button type="submit" class="btn">üíæ Salvar Usu√°rio</button>
                <input type="hidden" id="editingUserId">
            </form>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('changePasswordModal')">&times;</span>
            <h2>üîë Alterar Senha</h2>
            
            <form onsubmit="changeCurrentPassword(event)">
                <div class="form-group">
                    <label>Senha Atual: *</label>
                    <input type="password" id="currentPassword" required>
                </div>
                <div class="form-group">
                    <label>Nova Senha: *</label>
                    <input type="password" id="newPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label>Confirmar Nova Senha: *</label>
                    <input type="password" id="confirmPassword" required minlength="6">
                </div>
                
                <button type="submit" class="btn">üîë Alterar Senha</button>
            </form>
        </div>
    </div>

    <!-- User Password Change Modal -->
    <div id="userPasswordModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('userPasswordModal')">&times;</span>
            <h2 id="userPasswordTitle">üîë Alterar Senha do Usu√°rio</h2>
            
            <form onsubmit="saveUserPassword(event)">
                <div class="form-group">
                    <label>Nova Senha: *</label>
                    <input type="password" id="newUserPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label>Confirmar Nova Senha: *</label>
                    <input type="password" id="confirmUserPassword" required minlength="6">
                </div>
                
                <button type="submit" class="btn">üîë Alterar Senha</button>
                <input type="hidden" id="editingPasswordUserId">
            </form>
        </div>
    </div>

    <!-- Custom Tab Modal -->
    <div id="customTabModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('customTabModal')">&times;</span>
            <h2 id="customTabModalTitle">üìë Nova Aba Personalizada</h2>
            
            <form onsubmit="saveCustomTab(event)">
                <div class="grid-2">
                    <div class="form-group">
                        <label>Nome da Aba: *</label>
                        <input type="text" id="customTabName" required placeholder="Ex: Relat√≥rios, Vendas, etc.">
                    </div>
                    <div class="form-group">
                        <label>√çcone: *</label>
                        <select id="customTabIcon" required>
                            <option value="">Selecione um √≠cone</option>
                            <option value="üìä">üìä Gr√°ficos</option>
                            <option value="üìà">üìà Vendas</option>
                            <option value="üìã">üìã Relat√≥rios</option>
                            <option value="üéØ">üéØ Metas</option>
                            <option value="üìû">üìû Contatos</option>
                            <option value="üì¶">üì¶ Estoque</option>
                            <option value="üè™">üè™ Loja</option>
                            <option value="üìÖ">üìÖ Agenda</option>
                            <option value="üìù">üìù Notas</option>
                            <option value="üéÆ">üéÆ Games</option>
                            <option value="üèÜ">üèÜ Conquistas</option>
                            <option value="üí°">üí° Ideias</option>
                            <option value="üîß">üîß Ferramentas</option>
                            <option value="üì±">üì± Mobile</option>
                            <option value="üåü">üåü Premium</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Permiss√£o Necess√°ria: *</label>
                        <input type="text" id="customTabPermission" required placeholder="Ex: reports, sales, etc." pattern="[a-z_]+" title="Use apenas letras min√∫sculas e underscore">
                    </div>
                    <div class="form-group">
                        <label>Cor de Destaque:</label>
                        <select id="customTabColor">
                            <option value="#2196F3">üîµ Azul</option>
                            <option value="#4CAF50">üü¢ Verde</option>
                            <option value="#FF9800">üü† Laranja</option>
                            <option value="#9C27B0">üü£ Roxo</option>
                            <option value="#F44336">üî¥ Vermelho</option>
                            <option value="#607D8B">‚ö´ Cinza</option>
                            <option value="#795548">üü§ Marrom</option>
                            <option value="#E91E63">üíó Rosa</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Descri√ß√£o:</label>
                    <textarea id="customTabDescription" rows="2" placeholder="Breve descri√ß√£o da funcionalidade"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Conte√∫do HTML da P√°gina:</label>
                    <textarea id="customTabContent" rows="10" placeholder="Digite o HTML que ser√° exibido na aba..." style="font-family: monospace;">
<div class="card">
    <h3 class="card-title">Minha Aba Personalizada</h3>
    <p>Este √© o conte√∫do da sua nova aba.</p>
    <div class="action-buttons">
        <button class="btn" onclick="showNotification('Bot√£o funcionando!', 'success')">Teste</button>
    </div>
</div></textarea>
                </div>
                
                <button type="submit" class="btn">üìë Criar Aba</button>
                <input type="hidden" id="editingCustomTabId">
            </form>
        </div>
    </div>

    <script>
        // Sistema de dados local
        const data = {
            students: [],
            courses: ['Desenvolvimento de Jogos', 'Design Gr√°fico', 'Programa√ß√£o Web', 'Mobile Development'],
            courseModules: {
                'Desenvolvimento de Jogos': [
                    {
                        name: 'Introdu√ß√£o ao Game Development',
                        lessons: ['Conceitos B√°sicos', 'Hist√≥ria dos Jogos', 'Tipos de Jogos', 'Ferramentas']
                    },
                    {
                        name: 'Unity B√°sico',
                        lessons: ['Interface Unity', 'GameObjects', 'Scripts C#', 'F√≠sica B√°sica']
                    },
                    {
                        name: 'Programa√ß√£o em C#',
                        lessons: ['Vari√°veis', 'Fun√ß√µes', 'Classes', 'Eventos']
                    },
                    {
                        name: 'Game Design',
                        lessons: ['Mec√¢nicas', 'Level Design', 'UI/UX', 'Balanceamento']
                    },
                    {
                        name: 'Publica√ß√£o',
                        lessons: ['Build Settings', 'Play Store', 'Steam', 'Marketing']
                    }
                ],
                'Design Gr√°fico': [
                    {
                        name: 'Fundamentos do Design',
                        lessons: ['Teoria das Cores', 'Tipografia', 'Composi√ß√£o', 'Princ√≠pios']
                    },
                    {
                        name: 'Adobe Photoshop',
                        lessons: ['Interface', 'Ferramentas', 'Layers', 'Efeitos']
                    },
                    {
                        name: 'Adobe Illustrator',
                        lessons: ['Vetores', 'Formas', 'Textos', 'Exporta√ß√£o']
                    },
                    {
                        name: 'Identidade Visual',
                        lessons: ['Logotipos', 'Manual de Marca', 'Aplica√ß√µes', 'Apresenta√ß√£o']
                    },
                    {
                        name: 'Portfolio',
                        lessons: ['Sele√ß√£o de Trabalhos', 'Apresenta√ß√£o', 'Online', 'Impress√£o']
                    }
                ],
                'Programa√ß√£o Web': [
                    {
                        name: 'HTML/CSS',
                        lessons: ['HTML B√°sico', 'CSS B√°sico', 'Flexbox', 'Grid']
                    },
                    {
                        name: 'JavaScript',
                        lessons: ['Sintaxe', 'DOM', 'Eventos', 'APIs']
                    },
                    {
                        name: 'React',
                        lessons: ['Components', 'Props', 'State', 'Hooks']
                    },
                    {
                        name: 'Node.js',
                        lessons: ['Express', 'APIs', 'Database', 'Auth']
                    },
                    {
                        name: 'Deploy',
                        lessons: ['Git', 'Heroku', 'Netlify', 'Domain']
                    }
                ],
                'Mobile Development': [
                    {
                        name: 'Fundamentos Mobile',
                        lessons: ['Android', 'iOS', 'H√≠brido', 'Nativo']
                    },
                    {
                        name: 'React Native',
                        lessons: ['Setup', 'Components', 'Navigation', 'State']
                    },
                    {
                        name: 'Flutter',
                        lessons: ['Dart', 'Widgets', 'Layout', 'Navigation']
                    },
                    {
                        name: 'APIs e Backend',
                        lessons: ['REST', 'GraphQL', 'Authentication', 'Database']
                    },
                    {
                        name: 'Publica√ß√£o',
                        lessons: ['Play Store', 'App Store', 'Testing', 'Analytics']
                    }
                ]
            },
            payments: [],
            turmas: [],
            currentUser: null,
            activities: [],
            users: [],
            customTabs: [],
            customPages: {},
            achievements: [],
            gamificationStats: {
                totalXP: 0,
                totalAchievements: 0,
                avgLevel: 1,
                activeStreaks: 0
            }
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            loadStoredData();
            initializeTabs();
            initializeDateInputs();
            loadDemoData();
            initializeGamification();
        });

        function initializeDateInputs() {
            const today = new Date().toISOString().split('T')[0];
            const paymentDateInput = document.getElementById('paymentDate');
            if (paymentDateInput) {
                paymentDateInput.value = today;
            }
        }

        function loadDemoData() {
            // Carregar dados demo apenas se n√£o houver dados salvos
            if (data.students.length === 0) {
                // Criar usu√°rio administrador padr√£o
                data.users = [
                    {
                        id: 'admin',
                        name: 'Administrador',
                        email: 'admin@gamecreators.com',
                        password: '123456',
                        role: 'admin',
                        permissions: ['dashboard', 'students', 'classes', 'financial', 'gamification', 'admin', 'users', 'custom_tabs'],
                        active: true,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'teacher',
                        name: 'Professor Demo',
                        email: 'professor@gamecreators.com',
                        password: '123456',
                        role: 'teacher',
                        permissions: ['dashboard', 'students', 'classes', 'gamification'],
                        active: true,
                        createdAt: new Date().toISOString()
                    }
                ];

                // Adicionar turmas demo
                data.turmas = [
                    {
                        id: '1',
                        name: 'Turma Unity Iniciante',
                        course: 'Desenvolvimento de Jogos',
                        startDate: '2024-01-15',
                        endDate: '2024-06-15',
                        schedule: '14:00',
                        capacity: 20,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: '2',
                        name: 'Turma Design Avan√ßado',
                        course: 'Design Gr√°fico',
                        startDate: '2024-02-01',
                        endDate: '2024-07-01',
                        schedule: '19:00',
                        capacity: 15,
                        createdAt: new Date().toISOString()
                    }
                ];

                // Adicionar estudantes demo com gamifica√ß√£o
                data.students = [
                    {
                        id: '1',
                        name: 'Jo√£o Silva',
                        email: 'joao.silva@email.com',
                        phone: '(11) 99999-9999',
                        course: 'Desenvolvimento de Jogos',
                        turmaId: '1',
                        responsible: {
                            name: 'Maria Silva',
                            email: 'maria.silva@email.com'
                        },
                        contract: {
                            value: 2500.00,
                            paymentMethod: 'parcelado',
                            installments: 5
                        },
                        status: 'ativo',
                        progress: 65,
                        points: 150,
                        xp: 1250,
                        level: 3,
                        streak: 7,
                        lastActivity: new Date().toISOString(),
                        moduleProgress: {
                            'Introdu√ß√£o ao Game Development': { completed: 4, total: 4 },
                            'Unity B√°sico': { completed: 3, total: 4 },
                            'Programa√ß√£o em C#': { completed: 1, total: 4 }
                        },
                        achievements: ['first_login', 'week_streak', 'module_complete'],
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: '2',
                        name: 'Ana Costa',
                        email: 'ana.costa@email.com',
                        phone: '(11) 88888-8888',
                        course: 'Design Gr√°fico',
                        turmaId: '2',
                        responsible: {
                            name: 'Carlos Costa',
                            email: 'carlos.costa@email.com'
                        },
                        contract: {
                            value: 1800.00,
                            paymentMethod: 'parcelado',
                            installments: 3
                        },
                        status: 'ativo',
                        progress: 45,
                        points: 95,
                        xp: 850,
                        level: 2,
                        streak: 3,
                        lastActivity: new Date().toISOString(),
                        moduleProgress: {
                            'Fundamentos do Design': { completed: 4, total: 4 },
                            'Adobe Photoshop': { completed: 2, total: 4 }
                        },
                        achievements: ['first_login'],
                        createdAt: new Date().toISOString()
                    }
                ];

                // Adicionar conquistas padr√£o
                data.achievements = [
                    {
                        id: 'first_login',
                        name: 'Primeiro Login',
                        icon: 'üéØ',
                        description: 'Fez seu primeiro login no sistema',
                        xpReward: 50,
                        type: 'special'
                    },
                    {
                        id: 'week_streak',
                        name: 'Uma Semana',
                        icon: 'üî•',
                        description: 'Manteve uma sequ√™ncia de 7 dias',
                        xpReward: 100,
                        type: 'streak'
                    },
                    {
                        id: 'module_complete',
                        name: 'Primeiro M√≥dulo',
                        icon: 'üìö',
                        description: 'Completou seu primeiro m√≥dulo',
                        xpReward: 200,
                        type: 'completion'
                    }
                ];

                saveData();
            }
        }

        function initializeGamification() {
            // Calcular estat√≠sticas de gamifica√ß√£o
            updateGamificationStats();
        }

        function updateGamificationStats() {
            const stats = {
                totalXP: data.students.reduce((sum, s) => sum + (s.xp || 0), 0),
                totalAchievements: data.achievements.length,
                avgLevel: data.students.length > 0 ? 
                    Math.round(data.students.reduce((sum, s) => sum + (s.level || 1), 0) / data.students.length) : 1,
                activeStreaks: data.students.filter(s => (s.streak || 0) > 0).length
            };
            
            data.gamificationStats = stats;
            
            // Atualizar interface se estiver na aba de gamifica√ß√£o
            document.getElementById('totalXP').textContent = stats.totalXP.toLocaleString();
            document.getElementById('totalAchievements').textContent = stats.totalAchievements;
            document.getElementById('avgLevel').textContent = stats.avgLevel;
            document.getElementById('activeStreaks').textContent = stats.activeStreaks;
        }

        // Sistema de autentica√ß√£o
        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showNotification('Por favor, preencha email e senha', 'error');
                return;
            }
            
            const user = data.users.find(u => u.email === email && u.active);
            
            if (!user || user.password !== password) {
                showNotification('Email ou senha incorretos', 'error');
                return;
            }
            
            data.currentUser = user;
            
            document.getElementById('userWelcome').textContent = `Bem-vindo, ${user.name}! üëã`;
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            initializeTabs();
            updateDashboard();
            addActivity(`${user.name} fez login no sistema`);
            showNotification(`Login realizado com sucesso! üéâ`, 'success');
        }

        function logout() {
            if (confirm('Deseja realmente sair do sistema?')) {
                data.currentUser = null;
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('email').value = 'admin@gamecreators.com';
                document.getElementById('password').value = '123456';
                showNotification('Logout realizado com sucesso!', 'info');
            }
        }

        // Sistema de tabs
        function initializeTabs() {
            const baseTabs = [
                { id: 'dashboard', label: 'üìä Dashboard', icon: 'üìä', permission: 'dashboard' },
                { id: 'students', label: 'üë• Participantes', icon: 'üë•', permission: 'students' },
                { id: 'turmas', label: 'üè´ Turmas', icon: 'üè´', permission: 'classes' },
                { id: 'financeiro', label: 'üí∞ Financeiro', icon: 'üí∞', permission: 'financial' },
                { id: 'gamificacao', label: 'üéÆ Gamifica√ß√£o', icon: 'üéÆ', permission: 'gamification' },
                { id: 'configuracao', label: '‚öôÔ∏è Configura√ß√µes', icon: '‚öôÔ∏è', permission: 'admin' }
            ];

            const customTabs = data.customTabs || [];
            const allTabs = [...baseTabs, ...customTabs];
            const tabs = data.currentUser ? allTabs.filter(tab => hasPermission(tab.permission)) : allTabs;

            const tabsContainer = document.getElementById('navTabs');
            tabsContainer.innerHTML = '';
            
            tabs.forEach((tab, index) => {
                const button = document.createElement('button');
                button.className = 'nav-tab';
                if (tab.id.startsWith('custom_')) button.classList.add('custom-tab');
                button.textContent = tab.label;
                button.onclick = () => switchTab(tab.id, button);
                if (index === 0) button.classList.add('active');
                tabsContainer.appendChild(button);
                
                if (tab.id.startsWith('custom_') && !document.getElementById(tab.id)) {
                    const tabContent = document.createElement('div');
                    tabContent.id = tab.id;
                    tabContent.className = 'tab-content';
                    document.querySelector('#mainApp').appendChild(tabContent);
                }
            });

            // Populate course selects
            populateCourseSelects();
        }

        function populateCourseSelects() {
            const selects = ['studentCourse', 'turmaCourse'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    const currentValue = select.value;
                    select.innerHTML = '<option value="">Selecione um curso</option>';
                    data.courses.forEach(course => {
                        const option = document.createElement('option');
                        option.value = course;
                        option.textContent = course;
                        select.appendChild(option);
                    });
                    select.value = currentValue;
                }
            });
        }

        function switchTab(tabId, tabElement) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            tabElement.classList.add('active');
            document.getElementById(tabId).classList.add('active');
            
            switch(tabId) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'students':
                    loadStudentsView();
                    break;
                case 'turmas':
                    loadTurmasView();
                    break;
                case 'financeiro':
                    loadFinancialView();
                    break;
                case 'gamificacao':
                    loadGamificationView();
                    break;
                case 'configuracao':
                    loadConfigView();
                    break;
                default:
                    loadCustomTab(tabId);
                    break;
            }
        }

        // Sistema de permiss√µes
        function hasPermission(permission) {
            if (!data.currentUser) return false;
            if (data.currentUser.role === 'admin') return true;
            return data.currentUser.permissions && data.currentUser.permissions.includes(permission);
        }

        function requirePermission(permission) {
            if (!hasPermission(permission)) {
                showNotification('‚ùå Voc√™ n√£o tem permiss√£o para acessar esta funcionalidade', 'error');
                return false;
            }
            return true;
        } Salvar Participante</button>
                <input type="hidden" id="editingStudentId">
            </form>
        </div>
    </div>

    <!-- Progress Modal -->
    <div id="progressModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('progressModal')">&times;</span>
            <h2>üìà Acompanhamento de Progresso</h2>
            
            <div class="form-group">
                <label>Selecionar Participante:</label>
                <select id="progressStudent" onchange="loadStudentProgress()">
                    <option value="">Escolha um participante</option>
                </select>
            </div>
            
            <div id="progressContent" style="display: none;">
                <!-- Informa√ß√µes do Estudante -->
                <div class="gamification-panel">
                    <div class="grid-3">
                        <div class="text-center">
                            <div class="level-badge" id="studentLevelDisplay">N√≠vel 1</div>
                        </div>
                        <div class="text-center">
                            <div class="points-display" id="studentPointsDisplay">0 Pontos</div>
                        </div>
                        <div class="text-center">
                            <div class="streak-display">
                                <div class="streak-number" id="studentStreakDisplay">0</div>
                                <div>dias seguidos</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="xp-bar">
                        <div class="xp-fill" id="studentXPBar"></div>
                        <div class="xp-text" id="studentXPText">0 / 100 XP</div>
                    </div>
                </div>

                <!-- Progresso por M√≥dulos -->
                <div id="moduleProgress">
                    <!-- M√≥dulos ser√£o carregados dinamicamente -->
                </div>

                <!-- Conquistas do Estudante -->
                <div class="card">
                    <h4>üèÜ Conquistas Desbloqueadas</h4>
                    <div id="studentAchievements" class="achievement-grid">
                        <!-- Conquistas ser√£o carregadas aqui -->
                    </div>
                </div>

                <!-- A√ß√µes de Gamifica√ß√£o -->
                <div class="action-buttons">
                    <button class="btn" onclick="addXPToStudent()">‚≠ê Adicionar XP</button>
                    <button class="btn btn-secondary" onclick="updateStudentProgress()">üìö Atualizar Progresso</button>
                    <button class="btn btn-success" onclick="completeLesson()">‚úÖ Marcar Aula Conclu√≠da</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Achievement Modal -->
    <div id="achievementModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('achievementModal')">&times;</span>
            <h2>üèÜ Nova Conquista</h2>
            
            <form onsubmit="saveAchievement(event)">
                <div class="grid-2">
                    <div class="form-group">
                        <label>Nome da Conquista: *</label>
                        <input type="text" id="achievementName" required>
                    </div>
                    <div class="form-group">
                        <label>√çcone: *</label>
                        <select id="achievementIcon" required>
                            <option value="">Selecione um √≠cone</option>
                            <option value="üèÜ">üèÜ Trof√©u</option>
                            <option value="ü•á">ü•á Medalha Ouro</option>
                            <option value="ü•à">ü•à Medalha Prata</option>
                            <option value="ü•â">ü•â Medalha Bronze</option>
                            <option value="‚≠ê">‚≠ê Estrela</option>
                            <option value="üíé">üíé Diamante</option>
                            <option value="üî•">üî• Fogo</option>
                            <option value="‚ö°">‚ö° Raio</option>
                            <option value="üéØ">üéØ Alvo</option>
                            <option value="üöÄ">üöÄ Foguete</option>
                            <option value="üëë">üëë Coroa</option>
                            <option value="üéñÔ∏è">üéñÔ∏è Medalha Militar</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Descri√ß√£o: *</label>
                        <textarea id="achievementDescription" required rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Recompensa XP: *</label>
                        <input type="number" id="achievementXP" required min="1" value="50">
                    </div>
                    <div class="form-group">
                        <label>Tipo de Conquista:</label>
                        <select id="achievementType">
                            <option value="progress">üìà Progresso</option>
                            <option value="streak">üî• Sequ√™ncia</option>
                            <option value="completion">‚úÖ Conclus√£o</option>
                            <option value="special">‚≠ê Especial</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Crit√©rio para Desbloqueio:</label>
                        <input type="text" id="achievementCriteria" placeholder="Ex: Completar 10 aulas, 7 dias seguidos, etc.">
                    </div>
                </div>
                
                <button type="submit" class="btn">üèÜ Criar Conquista</button>
                <input type="hidden" id="editingAchievementId">
            </form>
        </div>
    </div>

    <!-- Tab Editor Modal -->
    <div id="tabEditorModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('tabEditorModal')">&times;</span>
            <h2>‚úèÔ∏è Editor de Abas Avan√ßado</h2>
            
            <div class="form-group">
                <label>Selecionar Aba para Editar:</label>
                <select id="editTabSelect" onchange="loadTabForEditing()">
                    <option value="">Escolha uma aba</option>
                </select>
            </div>
            
            <div id="tabEditContent" style="display: none;">
                <div class="tab-editor">
                    <div class="tab-editor-header">
                        <strong id="editingTabName">Editando Aba</strong>
                        <div>
                            <button class="btn btn-small" onclick="previewTab()">üëÅÔ∏è Visualizar</button>
                            <button class="btn btn-small btn-success" onclick="saveTabEdits()">üíæ Salvar</button>
                        </div>
                    </div>
                    
                    <div class="grid-2" style="margin: 15px;">
                        <div class="form-group">
                            <label>Nome da Aba:</label>
                            <input type="text" id="editTabName" placeholder="Nome da aba">
                        </div>
                        <div class="form-group">
                            <label>√çcone:</label>
                            <select id="editTabIcon">
                                <option value="üìä">üìä Gr√°ficos</option>
                                <option value="üìà">üìà Vendas</option>
                                <option value="üìã">üìã Relat√≥rios</option>
                                <option value="üéØ">üéØ Metas</option>
                                <option value="üìû">üìû Contatos</option>
                                <option value="üì¶">üì¶ Estoque</option>
                                <option value="üè™">üè™ Loja</option>
                                <option value="üìÖ">üìÖ Agenda</option>
                                <option value="üìù">üìù Notas</option>
                                <option value="üéÆ">üéÆ Games</option>
                                <option value="üèÜ">üèÜ Conquistas</option>
                                <option value="üí°">üí° Ideias</option>
                                <option value="üîß">üîß Ferramentas</option>
                                <option value="üì±">üì± Mobile</option>
                                <option value="üåü">üåü Premium</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="margin: 15px;">
                        <label>Conte√∫do HTML:</label>
                        <textarea id="editTabContent" class="code-editor" placeholder="Digite o HTML da sua aba aqui..."></textarea>
                    </div>
                </div>
                
                <!-- Preview da Aba -->
                <div id="tabPreview" style="display: none; margin-top: 20px; border: 2px solid #2196F3; border-radius: 8px; padding: 20px;">
                    <h4 style="color: #2196F3; margin-bottom: 15px;">üëÅÔ∏è Visualiza√ß√£o:</h4>
                    <div id="previewContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Outros modais existentes... -->
    
    <!-- Turma Modal -->
    <div id="turmaModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('turmaModal')">&times;</span>
            <h2>üè´ Nova Turma</h2>
            
            <form onsubmit="saveTurma(event)">
                <div class="grid-2">
                    <div class="form-group">
                        <label>Nome da Turma: *</label>
                        <input type="text" id="turmaName" required>
                    </div>
                    <div class="form-group">
                        <label>Curso: *</label>
                        <select id="turmaCourse" required>
                            <option value="">Selecione um curso</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Data de In√≠cio: *</label>
                        <input type="date" id="turmaStart" required>
                    </div>
                    <div class="form-group">
                        <label>Data de Fim: *</label>
                        <input type="date" id="turmaEnd" required>
                    </div>
                    <div class="form-group">
                        <label>Hor√°rio:</label>
                        <input type="time" id="turmaSchedule">
                    </div>
                    <div class="form-group">
                        <label>Capacidade M√°xima:</label>
                        <input type="number" id="turmaCapacity" value="20" min="1" max="50">
                    </div>
                </div>
                
                <button type="submit" class="btn">üíæ
