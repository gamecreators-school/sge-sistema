<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameCreators - Sistema de Gest√£o</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .login-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .main-app {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 5px;
        }

        .nav-tab {
            padding: 12px 20px;
            background: #f5f5f5;
            border: none;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 14px;
        }

        .nav-tab.active {
            background: #2196F3;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2196F3;
        }

        .btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: #1976D2;
        }

        .btn-secondary { background: #FF9800; }
        .btn-danger { background: #f44336; }
        .btn-success { background: #4CAF50; }
        .btn-warning { background: #FF9800; }
        .btn-info { background: #2196F3; }
        .btn-small { padding: 6px 12px; font-size: 12px; }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .table th {
            background: #f5f5f5;
            font-weight: 600;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
        }

        .modal-content {
            background: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10001;
            transform: translateX(400px);
            transition: transform 0.3s;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: #4CAF50; }
        .notification.error { background: #f44336; }
        .notification.info { background: #2196F3; }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-size: 12px;
            font-weight: 500;
        }

        .status-ativo { background: #4CAF50; }
        .status-lead { background: #2196F3; }
        .status-visitado { background: #FF9800; }
        .status-matriculado { background: #4CAF50; }
        .status-cancelado { background: #f44336; }

        .filter-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .chat-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            height: 400px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background: white;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .hidden { display: none !important; }

        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .nav-tabs { flex-direction: column; }
            .nav-tab { border-radius: 8px; margin-bottom: 5px; }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <h1 style="color: #2196F3; margin-bottom: 30px;">GameCreators</h1>
            <h2 style="color: #666; margin-bottom: 30px;">Sistema de Gest√£o</h2>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" placeholder="Digite seu email">
            </div>
            <div class="form-group">
                <label for="password">Senha:</label>
                <input type="password" id="password" placeholder="Digite sua senha">
            </div>
            <button class="btn" onclick="performLogin()">Entrar</button>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app">
        <div class="header">
            <div>
                <h1>GameCreators - Sistema de Gest√£o</h1>
                <p id="userWelcome">Bem-vindo!</p>
            </div>
            <button class="btn" onclick="logout()" style="background: #f44336;">Sair</button>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs" id="navTabs"></div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid" id="statsGrid"></div>
            <div class="card">
                <h3 class="card-title">Leads Recentes</h3>
                <div id="recentLeads"></div>
            </div>
        </div>

        <!-- Leads Tab -->
        <div id="leads" class="tab-content">
            <div class="action-buttons">
                <h2>Gest√£o de Leads</h2>
                <button class="btn" onclick="openModal('leadModal')">Novo Lead</button>
                <button class="btn btn-secondary" onclick="openModal('visitFilterModal')">üîç Filtrar Visitas</button>
                <button class="btn btn-success" onclick="openModal('matriculaFilterModal')">üìã Filtrar Matr√≠culas</button>
                <button class="btn btn-warning" onclick="exportToCSV()">üìä Exportar CSV</button>
                <button class="btn btn-info" onclick="exportToExcel()">üìà Exportar Excel</button>
            </div>
            <table class="table" id="leadsTable">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Email</th>
                        <th>Telefone</th>
                        <th>Curso</th>
                        <th>Status</th>
                        <th>Data</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="leadsTableBody"></tbody>
            </table>
        </div>

        <!-- Matr√≠culas Tab -->
        <div id="matriculas" class="tab-content">
            <div class="action-buttons">
                <h2>Matr√≠culas</h2>
                <button class="btn" onclick="openModal('matriculaModal')">Nova Matr√≠cula</button>
            </div>
            <table class="table" id="matriculasTable">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Curso</th>
                        <th>Data</th>
                        <th>Valor</th>
                        <th>Status</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="matriculasTableBody"></tbody>
            </table>
        </div>

        <!-- Equipe Tab -->
        <div id="equipe" class="tab-content">
            <div class="grid-2">
                <div class="card">
                    <h3 class="card-title">Membros da Equipe</h3>
                    <div id="teamMembers"></div>
                    <div class="action-buttons">
                        <button class="btn" onclick="openModal('noteModal')">üìù Adicionar Nota</button>
                        <button class="btn btn-secondary" onclick="openModal('messageModal')">üí¨ Enviar Mensagem</button>
                        <button class="btn btn-warning" onclick="openModal('meetingModal')">üìÖ Agendar Reuni√£o</button>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title">Notas da Equipe</h3>
                    <div id="teamNotes"></div>
                </div>
            </div>
        </div>

        <!-- Relat√≥rios Tab -->
        <div id="relatorios" class="tab-content">
            <div class="card">
                <h3 class="card-title">Relat√≥rios Gerenciais</h3>
                <div class="action-buttons">
                    <button class="btn" onclick="generateCommissionReport()">üìä Relat√≥rio de Comiss√£o</button>
                    <button class="btn btn-secondary" onclick="generateConversionReport()">üìà Relat√≥rio de Convers√£o</button>
                    <button class="btn btn-warning" onclick="generateUnitReport()">üè¢ Relat√≥rio por Unidade</button>
                    <button class="btn btn-success" onclick="generateGoalsReport()">üéØ Metas vs Realizado</button>
                    <button class="btn btn-info" onclick="generateTrendAnalysis()">üìâ An√°lise de Tend√™ncias</button>
                    <button class="btn" onclick="generateSalesForecast()">üîÆ Previs√£o de Vendas</button>
                </div>
                <div id="reportsContainer"></div>
            </div>
        </div>

        <!-- Chat Tab -->
        <div id="chat" class="tab-content">
            <div class="card">
                <h3 class="card-title">Chat da Equipe</h3>
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages"></div>
                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="Digite sua mensagem..." onkeypress="handleChatKeyPress(event)">
                        <button class="btn" onclick="sendMessage()">Enviar</button>
                        <button class="btn btn-secondary" onclick="clearChat()">Limpar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Tab -->
        <div id="admin" class="tab-content">
            <div class="grid-2">
                <div class="card">
                    <h3 class="card-title">Gerenciar Usu√°rios</h3>
                    <div class="action-buttons">
                        <button class="btn" onclick="openModal('userModal')">üë§ Adicionar Usu√°rio</button>
                        <button class="btn btn-warning" onclick="openModal('scopeModal')">üîç Escopo Usu√°rio</button>
                        <button class="btn btn-secondary" onclick="openModal('unitModal')">üè¢ Adicionar Unidade</button>
                    </div>
                    <div id="usersList"></div>
                </div>
                <div class="card">
                    <h3 class="card-title">Integra√ß√£o Google Sheets</h3>
                    <div class="form-group">
                        <label>ID da Planilha:</label>
                        <input type="text" id="sheetsId" placeholder="Cole o ID da planilha do Google Sheets">
                    </div>
                    <div class="form-group">
                        <label>Chave da API:</label>
                        <input type="text" id="apiKey" placeholder="Cole sua chave da API do Google">
                    </div>
                    <div class="action-buttons">
                        <button class="btn" onclick="connectGoogleSheets()">üîó Conectar Sheets</button>
                        <button class="btn btn-success" onclick="syncToSheets()">‚¨ÜÔ∏è Sincronizar Dados</button>
                        <button class="btn btn-warning" onclick="importFromSheets()">‚¨áÔ∏è Importar do Sheets</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Lead Modal -->
    <div id="leadModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('leadModal')">&times;</span>
            <h2>Novo Lead</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Nome:</label>
                    <input type="text" id="leadName">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="leadEmail">
                </div>
                <div class="form-group">
                    <label>Telefone:</label>
                    <input type="tel" id="leadPhone">
                </div>
                <div class="form-group">
                    <label>Curso de Interesse:</label>
                    <select id="leadCourse">
                        <option value="">Selecione</option>
                        <option value="Desenvolvimento de Jogos">Desenvolvimento de Jogos</option>
                        <option value="Design Gr√°fico">Design Gr√°fico</option>
                        <option value="Programa√ß√£o Web">Programa√ß√£o Web</option>
                    </select>
                </div>
            </div>
            <button class="btn" onclick="saveLead()">Salvar</button>
        </div>
    </div>

    <!-- Visit Filter Modal -->
    <div id="visitFilterModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('visitFilterModal')">&times;</span>
            <h2>Filtrar Visitas</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Data In√≠cio:</label>
                    <input type="date" id="visitStartDate">
                </div>
                <div class="form-group">
                    <label>Data Fim:</label>
                    <input type="date" id="visitEndDate">
                </div>
                <div class="form-group">
                    <label>Status:</label>
                    <select id="visitStatus">
                        <option value="">Todos</option>
                        <option value="agendada">Agendada</option>
                        <option value="realizada">Realizada</option>
                        <option value="cancelada">Cancelada</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Vendedor:</label>
                    <select id="visitVendedor">
                        <option value="">Todos</option>
                        <option value="vendedor1">Jo√£o Vendedor</option>
                        <option value="vendedor2">Maria Vendedora</option>
                    </select>
                </div>
            </div>
            <button class="btn" onclick="filterVisits()">Buscar</button>
            <button class="btn btn-secondary" onclick="clearVisitFilter()">Limpar</button>
        </div>
    </div>

    <!-- Matr√≠cula Filter Modal -->
    <div id="matriculaFilterModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('matriculaFilterModal')">&times;</span>
            <h2>Filtrar Matr√≠culas</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Data In√≠cio:</label>
                    <input type="date" id="matriculaStartDate">
                </div>
                <div class="form-group">
                    <label>Data Fim:</label>
                    <input type="date" id="matriculaEndDate">
                </div>
                <div class="form-group">
                    <label>Curso:</label>
                    <select id="matriculaCourse">
                        <option value="">Todos</option>
                        <option value="Desenvolvimento de Jogos">Desenvolvimento de Jogos</option>
                        <option value="Design Gr√°fico">Design Gr√°fico</option>
                        <option value="Programa√ß√£o Web">Programa√ß√£o Web</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Status:</label>
                    <select id="matriculaStatusFilter">
                        <option value="">Todos</option>
                        <option value="ativa">Ativa</option>
                        <option value="cancelada">Cancelada</option>
                        <option value="concluida">Conclu√≠da</option>
                    </select>
                </div>
            </div>
            <button class="btn" onclick="filterMatriculas()">Buscar</button>
            <button class="btn btn-secondary" onclick="clearMatriculaFilter()">Limpar</button>
        </div>
    </div>

    <!-- Mission Modal -->
    <div id="missionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('missionModal')">&times;</span>
            <h2>Nova Miss√£o</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>T√≠tulo:</label>
                    <input type="text" id="missionTitle">
                </div>
                <div class="form-group">
                    <label>Pontos:</label>
                    <input type="number" id="missionPoints">
                </div>
                <div class="form-group">
                    <label>Data Limite:</label>
                    <input type="date" id="missionDeadline">
                </div>
                <div class="form-group">
                    <label>Tipo:</label>
                    <select id="missionType">
                        <option value="individual">Individual</option>
                        <option value="equipe">Equipe</option>
                        <option value="geral">Geral</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Descri√ß√£o:</label>
                <textarea id="missionDescription" rows="3"></textarea>
            </div>
            <button class="btn" onclick="saveMission()">Criar Miss√£o</button>
        </div>
    </div>

    <!-- Note Modal -->
    <div id="noteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('noteModal')">&times;</span>
            <h2>Nova Nota</h2>
            <div class="form-group">
                <label>T√≠tulo:</label>
                <input type="text" id="noteTitle">
            </div>
            <div class="form-group">
                <label>Conte√∫do:</label>
                <textarea id="noteContent" rows="5"></textarea>
            </div>
            <button class="btn" onclick="saveNote()">Salvar Nota</button>
        </div>
    </div>

    <!-- Message Modal -->
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('messageModal')">&times;</span>
            <h2>Enviar Mensagem</h2>
            <div class="form-group">
                <label>Destinat√°rio:</label>
                <select id="messageRecipient">
                    <option value="">Selecione um membro</option>
                    <option value="all">Toda a Equipe</option>
                </select>
            </div>
            <div class="form-group">
                <label>Assunto:</label>
                <input type="text" id="messageSubject">
            </div>
            <div class="form-group">
                <label>Mensagem:</label>
                <textarea id="messageContent" rows="5"></textarea>
            </div>
            <button class="btn" onclick="sendTeamMessage()">Enviar</button>
        </div>
    </div>

    <!-- Meeting Modal -->
    <div id="meetingModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('meetingModal')">&times;</span>
            <h2>Agendar Reuni√£o</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Data:</label>
                    <input type="date" id="meetingDate">
                </div>
                <div class="form-group">
                    <label>Hor√°rio:</label>
                    <input type="time" id="meetingTime">
                </div>
                <div class="form-group">
                    <label>Participantes:</label>
                    <select id="meetingParticipants" multiple>
                        <option value="all">Toda a Equipe</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Local/Link:</label>
                    <input type="text" id="meetingLocation">
                </div>
            </div>
            <div class="form-group">
                <label>Assunto:</label>
                <input type="text" id="meetingSubject">
            </div>
            <div class="form-group">
                <label>Descri√ß√£o:</label>
                <textarea id="meetingDescription" rows="3"></textarea>
            </div>
            <button class="btn" onclick="scheduleMeeting()">Agendar</button>
        </div>
    </div>

    <!-- User Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('userModal')">&times;</span>
            <h2>Adicionar Usu√°rio</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Nome:</label>
                    <input type="text" id="userName">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="userEmail">
                </div>
                <div class="form-group">
                    <label>Cargo:</label>
                    <select id="userRole">
                        <option value="vendedor">Vendedor</option>
                        <option value="gerente">Gerente</option>
                        <option value="admin">Administrador</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Unidade:</label>
                    <select id="userUnit">
                        <option value="matriz">Matriz</option>
                        <option value="filial1">Filial 1</option>
                        <option value="filial2">Filial 2</option>
                    </select>
                </div>
            </div>
            <button class="btn" onclick="saveUser()">Salvar</button>
        </div>
    </div>

    <!-- Scope Modal -->
    <div id="scopeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('scopeModal')">&times;</span>
            <h2>Definir Escopo do Usu√°rio</h2>
            <div class="form-group">
                <label>Usu√°rio:</label>
                <select id="scopeUser">
                    <option value="">Selecione um usu√°rio</option>
                </select>
            </div>
            <div class="form-group">
                <label>Permiss√µes:</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                    <label><input type="checkbox" id="permLeads"> Gerenciar Leads</label>
                    <label><input type="checkbox" id="permMatriculas"> Gerenciar Matr√≠culas</label>
                    <label><input type="checkbox" id="permRelatorios"> Ver Relat√≥rios</label>
                    <label><input type="checkbox" id="permAdmin"> Acesso Admin</label>
                </div>
            </div>
            <button class="btn" onclick="saveUserScope()">Salvar Escopo</button>
        </div>
    </div>

    <!-- Unit Modal -->
    <div id="unitModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('unitModal')">&times;</span>
            <h2>Adicionar Unidade</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label>Nome da Unidade:</label>
                    <input type="text" id="unitName">
                </div>
                <div class="form-group">
                    <label>Endere√ßo:</label>
                    <input type="text" id="unitAddress">
                </div>
                <div class="form-group">
                    <label>Telefone:</label>
                    <input type="tel" id="unitPhone">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="unitEmail">
                </div>
            </div>
            <button class="btn" onclick="saveUnit()">Salvar</button>
        </div>
    </div>

    <script>
        // Sistema de dados local
        const data = {
            leads: [],
            matriculas: [],
            missions: [],
            teamNotes: [],
            chatMessages: [],
            users: [
                { id: '1', name: 'Admin', email: 'admin@gamecreators.com', role: 'admin', unit: 'matriz' }
            ],
            units: [
                { id: '1', name: 'Matriz', address: 'Rua Principal, 123', phone: '(11) 1234-5678', email: 'matriz@gamecreators.com' }
            ],
            meetings: [],
            currentUser: null,
            googleSheets: {
                connected: false,
                sheetId: '',
                apiKey: ''
            }
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            loadStoredData();
            initializeTabs();
            setDefaultDates();
        });

        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            const elements = ['visitStartDate', 'visitEndDate', 'matriculaStartDate', 'matriculaEndDate', 'missionDeadline', 'meetingDate'];
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.value = today;
            });
        }

        // Sistema de autentica√ß√£o CORRIGIDO
        function performLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email) {
                showNotification('Por favor, digite um email', 'error');
                return;
            }
            
            if (password !== '123456') {
                showNotification('Senha incorreta. Use: 123456', 'error');
                return;
            }
            
            data.currentUser = { email, name: email.split('@')[0] };
            document.getElementById('userWelcome').textContent = `Bem-vindo, ${data.currentUser.name}!`;
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            updateDashboard();
            loadLeadsTable();
            loadMatriculasTable();
            loadTeamData();
            showNotification('Login realizado com sucesso!', 'success');
        }

        function logout() {
            data.currentUser = null;
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
        }

        // Sistema de tabs
        function initializeTabs() {
            const tabs = [
                { id: 'dashboard', label: 'üìä Dashboard' },
                { id: 'leads', label: 'üéØ Leads' },
                { id: 'matriculas', label: 'üìã Matr√≠culas' },
                { id: 'equipe', label: 'üë• Equipe' },
                { id: 'relatorios', label: 'üìà Relat√≥rios' },
                { id: 'chat', label: 'üí¨ Chat' },
                { id: 'admin', label: '‚öôÔ∏è Admin' }
            ];

            const tabsContainer = document.getElementById('navTabs');
            tabs.forEach(tab => {
                const button = document.createElement('button');
                button.className = 'nav-tab';
                button.textContent = tab.label;
                button.onclick = () => switchTab(tab.id);
                if (tab.id === 'dashboard') button.classList.add('active');
                tabsContainer.appendChild(button);
            });
        }

        function switchTab(tabId) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
            
            switch(tabId) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'leads':
                    loadLeadsTable();
                    break;
                case 'matriculas':
                    loadMatriculasTable();
                    break;
                case 'equipe':
                    loadTeamData();
                    break;
                case 'chat':
                    loadChat();
                    break;
                case 'admin':
                    loadAdminData();
                    break;
            }
        }

        // Sistema de modais
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            
            // Populate selects based on modal
            if (modalId === 'scopeModal') {
                populateUserSelect();
            } else if (modalId === 'messageModal') {
                populateTeamSelect();
            } else if (modalId === 'meetingModal') {
                populateTeamSelect();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            clearModalForms();
        }

        function clearModalForms() {
            document.querySelectorAll('.modal input, .modal select, .modal textarea').forEach(input => {
                if (input.type !== 'hidden' && input.type !== 'checkbox') {
                    input.value = '';
                } else if (input.type === 'checkbox') {
                    input.checked = false;
                }
            });
        }

        // Sistema de notifica√ß√µes
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Gest√£o de Leads CORRIGIDA
        function saveLead() {
            const leadData = {
                id: Date.now().toString(),
                name: document.getElementById('leadName').value,
                email: document.getElementById('leadEmail').value,
                phone: document.getElementById('leadPhone').value,
                course: document.getElementById('leadCourse').value,
                status: 'lead',
                createdAt: new Date().toISOString(),
                visitDate: null,
                convertedAt: null
            };

            if (!leadData.name || !leadData.email) {
                showNotification('Preencha os campos obrigat√≥rios', 'error');
                return;
            }

            data.leads.push(leadData);
            saveData();
            closeModal('leadModal');
            loadLeadsTable();
            updateDashboard();
            showNotification('Lead cadastrado com sucesso!', 'success');
        }

        function loadLeadsTable() {
            const tbody = document.getElementById('leadsTableBody');
            tbody.innerHTML = '';

            data.leads.forEach(lead => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${lead.name}</td>
                    <td>${lead.email}</td>
                    <td>${lead.phone}</td>
                    <td>${lead.course}</td>
                    <td><span class="status-badge status-${lead.status}">${lead.status.toUpperCase()}</span></td>
                    <td>${new Date(lead.createdAt).toLocaleDateString('pt-BR')}</td>
                    <td>
                        <button class="btn btn-small" onclick="viewLead('${lead.id}')">üëÅÔ∏è Ver</button>
                        <button class="btn btn-small btn-secondary" onclick="editLead('${lead.id}')">‚úèÔ∏è Editar</button>
                        <button class="btn btn-small btn-success" onclick="convertLead('${lead.id}')">‚úÖ Converter</button>
                        <button class="btn btn-small btn-danger" onclick="deleteLead('${lead.id}')">üóëÔ∏è Excluir</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function viewLead(leadId) {
            const lead = data.leads.find(l => l.id === leadId);
            if (lead) {
                alert(`
Detalhes do Lead:
Nome: ${lead.name}
Email: ${lead.email}
Telefone: ${lead.phone}
Curso: ${lead.course}
Status: ${lead.status}
Data de Cria√ß√£o: ${new Date(lead.createdAt).toLocaleDateString('pt-BR')}
                `.trim());
            }
        }

        function editLead(leadId) {
            const lead = data.leads.find(l => l.id === leadId);
            if (lead) {
                document.getElementById('leadName').value = lead.name;
                document.getElementById('leadEmail').value = lead.email;
                document.getElementById('leadPhone').value = lead.phone;
                document.getElementById('leadCourse').value = lead.course;
                
                // Change save function temporarily
                const modal = document.getElementById('leadModal');
                const saveBtn = modal.querySelector('.btn');
                saveBtn.onclick = () => updateLead(leadId);
                
                openModal('leadModal');
            }
        }

        function updateLead(leadId) {
            const lead = data.leads.find(l => l.id === leadId);
            if (lead) {
                lead.name = document.getElementById('leadName').value;
                lead.email = document.getElementById('leadEmail').value;
                lead.phone = document.getElementById('leadPhone').value;
                lead.course = document.getElementById('leadCourse').value;
                
                saveData();
                closeModal('leadModal');
                loadLeadsTable();
                
                // Reset save function
                const modal = document.getElementById('leadModal');
                const saveBtn = modal.querySelector('.btn');
                saveBtn.onclick = saveLead;
                
                showNotification('Lead atualizado com sucesso!', 'success');
            }
        }

        function convertLead(leadId) {
            const lead = data.leads.find(l => l.id === leadId);
            if (lead && confirm(`Converter ${lead.name} em matr√≠cula?`)) {
                // Create matricula from lead
                const matricula = {
                    id: Date.now().toString(),
                    leadId: leadId,
                    name: lead.name,
                    email: lead.email,
                    phone: lead.phone,
                    course: lead.course,
                    value: 1200.00, // Default value
                    status: 'ativa',
                    createdAt: new Date().toISOString()
                };
                
                data.matriculas.push(matricula);
                lead.status = 'matriculado';
                lead.convertedAt = new Date().toISOString();
                
                saveData();
                loadLeadsTable();
                loadMatriculasTable();
                updateDashboard();
                showNotification('Lead convertido em matr√≠cula!', 'success');
            }
        }

        function deleteLead(leadId) {
            if (confirm('Tem certeza que deseja excluir este lead?')) {
                data.leads = data.leads.filter(l => l.id !== leadId);
                saveData();
                loadLeadsTable();
                updateDashboard();
                showNotification('Lead exclu√≠do com sucesso!', 'success');
            }
        }

        // Sistema de Filtros CORRIGIDO
        function filterVisits() {
            const startDate = document.getElementById('visitStartDate').value;
            const endDate = document.getElementById('visitEndDate').value;
            const status = document.getElementById('visitStatus').value;
            const vendedor = document.getElementById('visitVendedor').value;
            
            let filteredLeads = data.leads.filter(lead => {
                const leadDate = new Date(lead.createdAt);
                const start = startDate ? new Date(startDate) : new Date('1900-01-01');
                const end = endDate ? new Date(endDate) : new Date('2100-12-31');
                
                const dateMatch = leadDate >= start && leadDate <= end;
                const statusMatch = !status || lead.status === status;
                const vendedorMatch = !vendedor || lead.vendedor === vendedor;
                
                return dateMatch && statusMatch && vendedorMatch;
            });
            
            displayFilteredLeads(filteredLeads);
            closeModal('visitFilterModal');
            showNotification(`${filteredLeads.length} registros encontrados`, 'info');
        }

        function clearVisitFilter() {
            document.getElementById('visitStartDate').value = '';
            document.getElementById('visitEndDate').value = '';
            document.getElementById('visitStatus').value = '';
            document.getElementById('visitVendedor').value = '';
            loadLeadsTable();
            closeModal('visitFilterModal');
        }

        function filterMatriculas() {
            const startDate = document.getElementById('matriculaStartDate').value;
            const endDate = document.getElementById('matriculaEndDate').value;
            const course = document.getElementById('matriculaCourse').value;
            const status = document.getElementById('matriculaStatusFilter').value;
            
            let filteredMatriculas = data.matriculas.filter(matricula => {
                const matriculaDate = new Date(matricula.createdAt);
                const start = startDate ? new Date(startDate) : new Date('1900-01-01');
                const end = endDate ? new Date(endDate) : new Date('2100-12-31');
                
                const dateMatch = matriculaDate >= start && matriculaDate <= end;
                const courseMatch = !course || matricula.course === course;
                const statusMatch = !status || matricula.status === status;
                
                return dateMatch && courseMatch && statusMatch;
            });
            
            displayFilteredMatriculas(filteredMatriculas);
            closeModal('matriculaFilterModal');
            showNotification(`${filteredMatriculas.length} matr√≠culas encontradas`, 'info');
        }

        function clearMatriculaFilter() {
            document.getElementById('matriculaStartDate').value = '';
            document.getElementById('matriculaEndDate').value = '';
            document.getElementById('matriculaCourse').value = '';
            document.getElementById('matriculaStatusFilter').value = '';
            loadMatriculasTable();
            closeModal('matriculaFilterModal');
        }

        function displayFilteredLeads(leads) {
            const tbody = document.getElementById('leadsTableBody');
            tbody.innerHTML = '';

            leads.forEach(lead => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${lead.name}</td>
                    <td>${lead.email}</td>
                    <td>${lead.phone}</td>
                    <td>${lead.course}</td>
                    <td><span class="status-badge status-${lead.status}">${lead.status.toUpperCase()}</span></td>
                    <td>${new Date(lead.createdAt).toLocaleDateString('pt-BR')}</td>
                    <td>
                        <button class="btn btn-small" onclick="viewLead('${lead.id}')">üëÅÔ∏è Ver</button>
                        <button class="btn btn-small btn-secondary" onclick="editLead('${lead.id}')">‚úèÔ∏è Editar</button>
                        <button class="btn btn-small btn-success" onclick="convertLead('${lead.id}')">‚úÖ Converter</button>
                        <button class="btn btn-small btn-danger" onclick="deleteLead('${lead.id}')">üóëÔ∏è Excluir</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function displayFilteredMatriculas(matriculas) {
            const tbody = document.getElementById('matriculasTableBody');
            tbody.innerHTML = '';

            matriculas.forEach(matricula => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${matricula.name}</td>
                    <td>${matricula.course}</td>
                    <td>${new Date(matricula.createdAt).toLocaleDateString('pt-BR')}</td>
                    <td>R$ ${matricula.value.toFixed(2)}</td>
                    <td><span class="status-badge status-${matricula.status}">${matricula.status.toUpperCase()}</span></td>
                    <td>
                        <button class="btn btn-small" onclick="viewMatricula('${matricula.id}')">üëÅÔ∏è Ver</button>
                        <button class="btn btn-small btn-secondary" onclick="editMatricula('${matricula.id}')">‚úèÔ∏è Editar</button>
                        <button class="btn btn-small btn-danger" onclick="deleteMatricula('${matricula.id}')">üóëÔ∏è Excluir</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Exporta√ß√£o CSV e Excel CORRIGIDA
        function exportToCSV() {
            const csvContent = [
                ['Nome', 'Email', 'Telefone', 'Curso', 'Status', 'Data'],
                ...data.leads.map(lead => [
                    lead.name,
                    lead.email,
                    lead.phone,
                    lead.course,
                    lead.status,
                    new Date(lead.createdAt).toLocaleDateString('pt-BR')
                ])
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `leads_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            showNotification('Arquivo CSV exportado com sucesso!', 'success');
        }

        function exportToExcel() {
            // Simulate Excel export
            const data_excel = [
                ['Nome', 'Email', 'Telefone', 'Curso', 'Status', 'Data'],
                ...data.leads.map(lead => [
                    lead.name,
                    lead.email,
                    lead.phone,
                    lead.course,
                    lead.status,
                    new Date(lead.createdAt).toLocaleDateString('pt-BR')
                ])
            ];

            let csvContent = data_excel.map(row => row.join('\t')).join('\n');
            const blob = new Blob([csvContent], { type: 'application/vnd.ms-excel' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `leads_${new Date().toISOString().split('T')[0]}.xls`;
            link.click();
            
            showNotification('Arquivo Excel exportado com sucesso!', 'success');
        }

        // Sistema de Matr√≠culas
        function loadMatriculasTable() {
            const tbody = document.getElementById('matriculasTableBody');
            tbody.innerHTML = '';

            data.matriculas.forEach(matricula => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${matricula.name}</td>
                    <td>${matricula.course}</td>
                    <td>${new Date(matricula.createdAt).toLocaleDateString('pt-BR')}</td>
                    <td>R$ ${matricula.value.toFixed(2)}</td>
                    <td><span class="status-badge status-${matricula.status}">${matricula.status.toUpperCase()}</span></td>
                    <td>
                        <button class="btn btn-small" onclick="viewMatricula('${matricula.id}')">üëÅÔ∏è Ver</button>
                        <button class="btn btn-small btn-secondary" onclick="editMatricula('${matricula.id}')">‚úèÔ∏è Editar</button>
                        <button class="btn btn-small btn-danger" onclick="deleteMatricula('${matricula.id}')">üóëÔ∏è Excluir</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function viewMatricula(matriculaId) {
            const matricula = data.matriculas.find(m => m.id === matriculaId);
            if (matricula) {
                alert(`
Detalhes da Matr√≠cula:
Nome: ${matricula.name}
Email: ${matricula.email}
Curso: ${matricula.course}
Valor: R$ ${matricula.value.toFixed(2)}
Status: ${matricula.status}
Data: ${new Date(matricula.createdAt).toLocaleDateString('pt-BR')}
                `.trim());
            }
        }

        function editMatricula(matriculaId) {
            const matricula = data.matriculas.find(m => m.id === matriculaId);
            if (matricula) {
                const newValue = prompt('Novo valor:', matricula.value);
                const newStatus = prompt('Novo status (ativa/cancelada/concluida):', matricula.status);
                
                if (newValue) matricula.value = parseFloat(newValue);
                if (newStatus) matricula.status = newStatus;
                
                saveData();
                loadMatriculasTable();
                showNotification('Matr√≠cula atualizada!', 'success');
            }
        }

        function deleteMatricula(matriculaId) {
            if (confirm('Tem certeza que deseja excluir esta matr√≠cula?')) {
                data.matriculas = data.matriculas.filter(m => m.id !== matriculaId);
                saveData();
                loadMatriculasTable();
                updateDashboard();
                showNotification('Matr√≠cula exclu√≠da!', 'success');
            }
        }

        // Sistema de Miss√µes CORRIGIDO
        function saveMission() {
            const missionData = {
                id: Date.now().toString(),
                title: document.getElementById('missionTitle').value,
                description: document.getElementById('missionDescription').value,
                points: parseInt(document.getElementById('missionPoints').value) || 0,
                deadline: document.getElementById('missionDeadline').value,
                type: document.getElementById('missionType').value,
                status: 'ativa',
                createdAt: new Date().toISOString()
            };

            if (!missionData.title || !missionData.description) {
                showNotification('Preencha todos os campos obrigat√≥rios', 'error');
                return;
            }

            data.missions.push(missionData);
            saveData();
            closeModal('missionModal');
            showNotification('Miss√£o criada com sucesso!', 'success');
            
            // Add to recent activities
            addRecentActivity(`Nova miss√£o criada: ${missionData.title}`);
        }

        // Sistema de Equipe CORRIGIDO
        function loadTeamData() {
            loadTeamMembers();
            loadTeamNotes();
        }

        function loadTeamMembers() {
            const container = document.getElementById('teamMembers');
            container.innerHTML = data.users.map(user => `
                <div style="padding: 10px; border: 1px solid #e0e0e0; margin: 5px 0; border-radius: 5px;">
                    <strong>${user.name}</strong> - ${user.role}<br>
                    <small>${user.email} | ${user.unit}</small>
                </div>
            `).join('');
        }

        function loadTeamNotes() {
            const container = document.getElementById('teamNotes');
            container.innerHTML = data.teamNotes.map(note => `
                <div style="padding: 15px; border-left: 3px solid #2196F3; margin: 10px 0; background: #f8f9ff;">
                    <h5>${note.title}</h5>
                    <p>${note.content}</p>
                    <small>Por: ${note.author} - ${new Date(note.createdAt).toLocaleDateString('pt-BR')}</small>
                </div>
            `).join('');
        }

        function saveNote() {
            const noteData = {
                id: Date.now().toString(),
                title: document.getElementById('noteTitle').value,
                content: document.getElementById('noteContent').value,
                author: data.currentUser?.name || 'Usu√°rio',
                createdAt: new Date().toISOString()
            };

            if (!noteData.title || !noteData.content) {
                showNotification('Preencha todos os campos', 'error');
                return;
            }

            data.teamNotes.push(noteData);
            saveData();
            closeModal('noteModal');
            loadTeamNotes();
            showNotification('Nota adicionada com sucesso!', 'success');
        }

        function sendTeamMessage() {
            const messageData = {
                recipient: document.getElementById('messageRecipient').value,
                subject: document.getElementById('messageSubject').value,
                content: document.getElementById('messageContent').value,
                sender: data.currentUser?.name || 'Usu√°rio',
                sentAt: new Date().toISOString()
            };

            if (!messageData.recipient || !messageData.subject || !messageData.content) {
                showNotification('Preencha todos os campos', 'error');
                return;
            }

            // Simulate sending message
            closeModal('messageModal');
            showNotification(`Mensagem enviada para ${messageData.recipient === 'all' ? 'toda a equipe' : messageData.recipient}!`, 'success');
            
            // Add to recent activities
            addRecentActivity(`Mensagem enviada: ${messageData.subject}`);
        }

        function scheduleMeeting() {
            const meetingData = {
                id: Date.now().toString(),
                date: document.getElementById('meetingDate').value,
                time: document.getElementById('meetingTime').value,
                participants: Array.from(document.getElementById('meetingParticipants').selectedOptions).map(o => o.value),
                location: document.getElementById('meetingLocation').value,
                subject: document.getElementById('meetingSubject').value,
                description: document.getElementById('meetingDescription').value,
                organizer: data.currentUser?.name || 'Usu√°rio',
                createdAt: new Date().toISOString()
            };

            if (!meetingData.date || !meetingData.time || !meetingData.subject) {
                showNotification('Preencha os campos obrigat√≥rios', 'error');
                return;
            }

            data.meetings.push(meetingData);
            saveData();
            closeModal('meetingModal');
            showNotification('Reuni√£o agendada com sucesso!', 'success');
            
            // Add to recent activities
            addRecentActivity(`Reuni√£o agendada: ${meetingData.subject} - ${meetingData.date} ${meetingData.time}`);
        }

        // Sistema de Relat√≥rios CORRIGIDO
        function generateCommissionReport() {
            const report = generateReportHTML('Relat√≥rio de Comiss√µes', [
                `Total de Leads: ${data.leads.length}`,
                `Convers√µes: ${data.matriculas.length}`,
                `Taxa de Convers√£o: ${data.leads.length > 0 ? ((data.matriculas.length / data.leads.length) * 100).toFixed(2) : 0}%`,
                `Receita Total: R$ ${data.matriculas.reduce((sum, m) => sum + m.value, 0).toFixed(2)}`
            ]);
            
            displayReport(report);
            showNotification('Relat√≥rio de comiss√µes gerado!', 'success');
        }

        function generateConversionReport() {
            const totalLeads = data.leads.length;
            const conversions = data.matriculas.length;
            const conversionRate = totalLeads > 0 ? (conversions / totalLeads * 100) : 0;
            
            const report = generateReportHTML('Relat√≥rio de Convers√£o', [
                `Total de Leads: ${totalLeads}`,
                `Total de Convers√µes: ${conversions}`,
                `Taxa de Convers√£o: ${conversionRate.toFixed(2)}%`,
                `Meta de Convers√£o: 25%`,
                `Status: ${conversionRate >= 25 ? '‚úÖ Meta Atingida' : '‚ùå Abaixo da Meta'}`
            ]);
            
            displayReport(report);
            showNotification('Relat√≥rio de convers√£o gerado!', 'success');
        }

        function generateUnitReport() {
            const report = generateReportHTML('Relat√≥rio por Unidade', [
                `Unidades Cadastradas: ${data.units.length}`,
                `Usu√°rios por Unidade:`,
                ...data.units.map(unit => {
                    const userCount = data.users.filter(u => u.unit === unit.id).length;
                    return `- ${unit.name}: ${userCount} usu√°rios`;
                })
            ]);
            
            displayReport(report);
            showNotification('Relat√≥rio por unidade gerado!', 'success');
        }

        function generateGoalsReport() {
            const monthlyGoal = 50; // Meta mensal de leads
            const currentLeads = data.leads.length;
            const goalPercentage = (currentLeads / monthlyGoal * 100);
            
            const report = generateReportHTML('Metas vs Realizado', [
                `Meta Mensal de Leads: ${monthlyGoal}`,
                `Leads Realizados: ${currentLeads}`,
                `Percentual da Meta: ${goalPercentage.toFixed(1)}%`,
                `Status: ${goalPercentage >= 100 ? 'üéØ Meta Superada' : goalPercentage >= 80 ? '‚ö†Ô∏è Pr√≥ximo da Meta' : '‚ùå Abaixo da Meta'}`
            ]);
            
            displayReport(report);
            showNotification('Relat√≥rio de metas gerado!', 'success');
        }

        function generateTrendAnalysis() {
            const last30Days = new Date();
            last30Days.setDate(last30Days.getDate() - 30);
            
            const recentLeads = data.leads.filter(lead => new Date(lead.createdAt) >= last30Days);
            const recentMatriculas = data.matriculas.filter(m => new Date(m.createdAt) >= last30Days);
            
            const report = generateReportHTML('An√°lise de Tend√™ncias (30 dias)', [
                `Leads nos √∫ltimos 30 dias: ${recentLeads.length}`,
                `Matr√≠culas nos √∫ltimos 30 dias: ${recentMatriculas.length}`,
                `Tend√™ncia de Leads: ${recentLeads.length > 10 ? 'üìà Crescendo' : 'üìâ Est√°vel'}`,
                `Curso mais procurado: ${getMostPopularCourse()}`,
                `Melhor dia da semana: ${getBestDayOfWeek()}`
            ]);
            
            displayReport(report);
            showNotification('An√°lise de tend√™ncias gerada!', 'success');
        }

        function generateSalesForecast() {
            const avgMonthlyLeads = data.leads.length;
            const conversionRate = data.matriculas.length / Math.max(data.leads.length, 1);
            const avgTicket = data.matriculas.length > 0 ? data.matriculas.reduce((sum, m) => sum + m.value, 0) / data.matriculas.length : 1200;
            
            const forecast = avgMonthlyLeads * conversionRate * avgTicket;
            
            const report = generateReportHTML('Previs√£o de Vendas', [
                `M√©dia de Leads/M√™s: ${avgMonthlyLeads}`,
                `Taxa de Convers√£o: ${(conversionRate * 100).toFixed(2)}%`,
                `Ticket M√©dio: R$ ${avgTicket.toFixed(2)}`,
                `Previs√£o de Receita Mensal: R$ ${forecast.toFixed(2)}`,
                `Previs√£o Trimestral: R$ ${(forecast * 3).toFixed(2)}`,
                `Previs√£o Anual: R$ ${(forecast * 12).toFixed(2)}`
            ]);
            
            displayReport(report);
            showNotification('Previs√£o de vendas gerada!', 'success');
        }

        function generateReportHTML(title, items) {
            return `
                <div class="card">
                    <h3>${title}</h3>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                        ${items.map(item => `<p style="margin: 5px 0;">${item}</p>`).join('')}
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-small" onclick="printReport('${title}')">üñ®Ô∏è Imprimir</button>
                        <button class="btn btn-small btn-secondary" onclick="exportReport('${title}')">üìä Exportar</button>
                    </div>
                </div>
            `;
        }

        function displayReport(reportHTML) {
            document.getElementById('reportsContainer').innerHTML = reportHTML;
        }

        function printReport(title) {
            const content = document.getElementById('reportsContainer').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head><title>${title}</title></head>
                <body style="font-family: Arial, sans-serif; padding: 20px;">
                    ${content}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function exportReport(title) {
            const reportData = document.getElementById('reportsContainer').innerText;
            const blob = new Blob([reportData], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${title.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
            showNotification('Relat√≥rio exportado!', 'success');
        }

        function getMostPopularCourse() {
            const courseCounts = {};
            data.leads.forEach(lead => {
                if (lead.course) {
                    courseCounts[lead.course] = (courseCounts[lead.course] || 0) + 1;
                }
            });
            
            return Object.keys(courseCounts).reduce((a, b) => courseCounts[a] > courseCounts[b] ? a : b, 'N/A');
        }

        function getBestDayOfWeek() {
            const days = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
            const dayCounts = new Array(7).fill(0);
            
            data.leads.forEach(lead => {
                const day = new Date(lead.createdAt).getDay();
                dayCounts[day]++;
            });
            
            const bestDayIndex = dayCounts.indexOf(Math.max(...dayCounts));
            return days[bestDayIndex];
        }

        // Sistema de Chat CORRIGIDO
        function loadChat() {
            displayChatMessages();
        }

        function displayChatMessages() {
            const container = document.getElementById('chatMessages');
            container.innerHTML = data.chatMessages.map(msg => `
                <div style="margin: 10px 0; padding: 10px; background: ${msg.sender === data.currentUser?.name ? '#e3f2fd' : '#f5f5f5'}; border-radius: 5px;">
                    <strong>${msg.sender}</strong> <small>${new Date(msg.timestamp).toLocaleTimeString('pt-BR')}</small><br>
                    ${msg.message}
                </div>
            `).join('');
            
            container.scrollTop = container.scrollHeight;
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const chatMessage = {
                id: Date.now().toString(),
                sender: data.currentUser?.name || 'Usu√°rio',
                message: message,
                timestamp: new Date().toISOString()
            };
            
            data.chatMessages.push(chatMessage);
            saveData();
            
            input.value = '';
            displayChatMessages();
            
            showNotification('Mensagem enviada!', 'success');
        }

        function clearChat() {
            if (confirm('Tem certeza que deseja limpar o chat?')) {
                data.chatMessages = [];
                saveData();
                displayChatMessages();
                showNotification('Chat limpo!', 'success');
            }
        }

        // Sistema de Admin CORRIGIDO
        function loadAdminData() {
            loadUsersList();
            loadGoogleSheetsStatus();
        }

        function loadUsersList() {
            const container = document.getElementById('usersList');
            container.innerHTML = data.users.map(user => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border: 1px solid #e0e0e0; margin: 5px 0; border-radius: 5px;">
                    <div>
                        <strong>${user.name}</strong><br>
                        <small>${user.email} | ${user.role} | ${user.unit}</small>
                    </div>
                    <div>
                        <button class="btn btn-small btn-warning" onclick="editUserScope('${user.id}')">üîç Escopo</button>
                        <button class="btn btn-small btn-danger" onclick="deleteUser('${user.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function saveUser() {
            const userData = {
                id: Date.now().toString(),
                name: document.getElementById('userName').value,
                email: document.getElementById('userEmail').value,
                role: document.getElementById('userRole').value,
                unit: document.getElementById('userUnit').value,
                permissions: {
                    leads: true,
                    matriculas: true,
                    relatorios: false,
                    admin: false
                },
                createdAt: new Date().toISOString()
            };

            if (!userData.name || !userData.email) {
                showNotification('Preencha os campos obrigat√≥rios', 'error');
                return;
            }

            data.users.push(userData);
            saveData();
            closeModal('userModal');
            loadUsersList();
            showNotification('Usu√°rio adicionado com sucesso!', 'success');
        }

        function editUserScope(userId) {
            const user = data.users.find(u => u.id === userId);
            if (user) {
                document.getElementById('scopeUser').value = userId;
                document.getElementById('permLeads').checked = user.permissions?.leads || false;
                document.getElementById('permMatriculas').checked = user.permissions?.matriculas || false;
                document.getElementById('permRelatorios').checked = user.permissions?.relatorios || false;
                document.getElementById('permAdmin').checked = user.permissions?.admin || false;
                
                openModal('scopeModal');
            }
        }

        function saveUserScope() {
            const userId = document.getElementById('scopeUser').value;
            const user = data.users.find(u => u.id === userId);
            
            if (user) {
                user.permissions = {
                    leads: document.getElementById('permLeads').checked,
                    matriculas: document.getElementById('permMatriculas').checked,
                    relatorios: document.getElementById('permRelatorios').checked,
                    admin: document.getElementById('permAdmin').checked
                };
                
                saveData();
                closeModal('scopeModal');
                showNotification('Escopo do usu√°rio atualizado!', 'success');
            }
        }

        function deleteUser(userId) {
            if (confirm('Tem certeza que deseja excluir este usu√°rio?')) {
                data.users = data.users.filter(u => u.id !== userId);
                saveData();
                loadUsersList();
                showNotification('Usu√°rio exclu√≠do!', 'success');
            }
        }

        function saveUnit() {
            const unitData = {
                id: Date.now().toString(),
                name: document.getElementById('unitName').value,
                address: document.getElementById('unitAddress').value,
                phone: document.getElementById('unitPhone').value,
                email: document.getElementById('unitEmail').value,
                createdAt: new Date().toISOString()
            };

            if (!unitData.name) {
                showNotification('Preencha o nome da unidade', 'error');
                return;
            }

            data.units.push(unitData);
            saveData();
            closeModal('unitModal');
            showNotification('Unidade adicionada com sucesso!', 'success');
            
            // Update unit selects
            updateUnitSelects();
        }

        function updateUnitSelects() {
            const selects = document.querySelectorAll('#userUnit');
            selects.forEach(select => {
                const currentValue = select.value;
                select.innerHTML = data.units.map(unit => 
                    `<option value="${unit.id}">${unit.name}</option>`
                ).join('');
                select.value = currentValue;
            });
        }

        // Sistema Google Sheets CORRIGIDO
        function loadGoogleSheetsStatus() {
            const connected = data.googleSheets.connected;
            document.getElementById('sheetsId').value = data.googleSheets.sheetId;
            document.getElementById('apiKey').value = data.googleSheets.apiKey;
            
            if (connected) {
                showNotification('Google Sheets conectado!', 'success');
            }
        }

        function connectGoogleSheets() {
            const sheetId = document.getElementById('sheetsId').value;
            const apiKey = document.getElementById('apiKey').value;
            
            if (!sheetId || !apiKey) {
                showNotification('Preencha ID da planilha e chave da API', 'error');
                return;
            }
            
            data.googleSheets = {
                connected: true,
                sheetId: sheetId,
                apiKey: apiKey,
                connectedAt: new Date().toISOString()
            };
            
            saveData();
            showNotification('Google Sheets conectado com sucesso!', 'success');
            
            // Add connection script example
            generateGoogleSheetsScript();
        }

        function syncToSheets() {
            if (!data.googleSheets.connected) {
                showNotification('Conecte ao Google Sheets primeiro', 'error');
                return;
            }
            
            // Simulate sync
            showNotification('Sincronizando dados com Google Sheets...', 'info');
            
            setTimeout(() => {
                showNotification('Dados sincronizados com sucesso!', 'success');
                addRecentActivity('Dados sincronizados com Google Sheets');
            }, 2000);
        }

        function importFromSheets() {
            if (!data.googleSheets.connected) {
                showNotification('Conecte ao Google Sheets primeiro', 'error');
                return;
            }
            
            // Simulate import
            showNotification('Importando dados do Google Sheets...', 'info');
            
            setTimeout(() => {
                // Add some sample data
                const sampleLeads = [
                    {
                        id: Date.now().toString(),
                        name: 'Lead Importado 1',
                        email: 'lead1@sheets.com',
                        phone: '(11) 99999-1111',
                        course: 'Desenvolvimento de Jogos',
                        status: 'lead',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: (Date.now() + 1).toString(),
                        name: 'Lead Importado 2',
                        email: 'lead2@sheets.com',
                        phone: '(11) 99999-2222',
                        course: 'Design Gr√°fico',
                        status: 'lead',
                        createdAt: new Date().toISOString()
                    }
                ];
                
                data.leads.push(...sampleLeads);
                saveData();
                loadLeadsTable();
                updateDashboard();
                
                showNotification(`${sampleLeads.length} leads importados do Google Sheets!`, 'success');
                addRecentActivity(`${sampleLeads.length} leads importados do Google Sheets`);
            }, 2000);
        }

        function generateGoogleSheetsScript() {
            const script = `
// Script para Google Apps Script
function syncDataToSheet() {
    const sheet = SpreadsheetApp.getActiveSheet();
    
    // Cabe√ßalhos
    sheet.getRange(1, 1, 1, 6).setValues([['Nome', 'Email', 'Telefone', 'Curso', 'Status', 'Data']]);
    
    // Aqui voc√™ conectaria com sua API para buscar os dados
    // const response = UrlFetchApp.fetch('https://sua-api.com/leads');
    // const data = JSON.parse(response.getContentText());
    
    console.log('Dados sincronizados com a planilha ${data.googleSheets.sheetId}');
}

function onEdit(e) {
    // Automaticamente sincroniza quando a planilha √© editada
    syncDataToSheet();
}
            `;
            
            console.log('Script do Google Sheets:', script);
            
            // Create downloadable script file
            const blob = new Blob([script], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'google_sheets_script.gs';
            link.click();
            
            showNotification('Script do Google Sheets baixado!', 'success');
        }

        // Utilit√°rios
        function populateUserSelect() {
            const select = document.getElementById('scopeUser');
            select.innerHTML = '<option value="">Selecione um usu√°rio</option>';
            data.users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = `${user.name} (${user.email})`;
                select.appendChild(option);
            });
        }

        function populateTeamSelect() {
            const selects = ['messageRecipient', 'meetingParticipants'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    if (selectId === 'messageRecipient') {
                        select.innerHTML = '<option value="">Selecione um membro</option><option value="all">Toda a Equipe</option>';
                    } else {
                        select.innerHTML = '<option value="all">Toda a Equipe</option>';
                    }
                    
                    data.users.forEach(user => {
                        const option = document.createElement('option');
                        option.value = user.id;
                        option.textContent = user.name;
                        select.appendChild(option);
                    });
                }
            });
        }

        function addRecentActivity(activity) {
            if (!data.recentActivities) data.recentActivities = [];
            
            data.recentActivities.unshift({
                id: Date.now().toString(),
                activity: activity,
                timestamp: new Date().toISOString()
            });
            
            // Keep only last 10 activities
            data.recentActivities = data.recentActivities.slice(0, 10);
            saveData();
        }

        function updateDashboard() {
            const totalLeads = data.leads.length;
            const totalMatriculas = data.matriculas.length;
            const conversionRate = totalLeads > 0 ? (totalMatriculas / totalLeads * 100) : 0;
            const totalRevenue = data.matriculas.reduce((sum, m) => sum + m.value, 0);

            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalLeads}</div>
                    <div class="stat-label">Total Leads</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);">
                    <div class="stat-number">${totalMatriculas}</div>
                    <div class="stat-label">Matr√≠culas</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);">
                    <div class="stat-number">${conversionRate.toFixed(1)}%</div>
                    <div class="stat-label">Taxa Convers√£o</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);">
                    <div class="stat-number">R$ ${totalRevenue.toFixed(0)}</div>
                    <div class="stat-label">Receita Total</div>
                </div>
            `;

            loadRecentLeads();
        }

        function loadRecentLeads() {
            const recentLeads = data.leads.slice(-5).reverse();
            document.getElementById('recentLeads').innerHTML = recentLeads.map(lead => `
                <div style="padding: 10px; border-left: 3px solid #2196F3; margin: 5px 0; background: #f8f9ff;">
                    <strong>${lead.name}</strong> - ${lead.course}<br>
                    <small>${lead.email} | ${new Date(lead.createdAt).toLocaleDateString('pt-BR')}</small>
                </div>
            `).join('') || '<p>Nenhum lead recente</p>';
        }

        // Sistema de armazenamento
        function saveData() {
            localStorage.setItem('gamecreators_data_v2', JSON.stringify(data));
        }

        function loadStoredData() {
            const stored = localStorage.getItem('gamecreators_data_v2');
            if (stored) {
                try {
                    const parsedData = JSON.parse(stored);
                    Object.assign(data, parsedData);
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    loadSampleData();
                }
            } else {
                loadSampleData();
            }
        }

        function loadSampleData() {
            // Dados de exemplo
            data.leads = [
                {
                    id: '1',
                    name: 'Jo√£o Silva',
                    email: 'joao@email.com',
                    phone: '(11) 99999-9999',
                    course: 'Desenvolvimento de Jogos',
                    status: 'lead',
                    createdAt: '2024-01-15T10:30:00.000Z'
                },
                {
                    id: '2',
                    name: 'Maria Santos',
                    email: 'maria@email.com',
                    phone: '(11) 88888-8888',
                    course: 'Design Gr√°fico',
                    status: 'visitado',
                    createdAt: '2024-01-16T14:20:00.000Z'
                }
            ];

            data.matriculas = [
                {
                    id: '1',
                    leadId: '2',
                    name: 'Maria Santos',
                    email: 'maria@email.com',
                    phone: '(11) 88888-8888',
                    course: 'Design Gr√°fico',
                    value: 1200.00,
                    status: 'ativa',
                    createdAt: '2024-01-17T09:15:00.000Z'
                }
            ];

            data.missions = [
                {
                    id: '1',
                    title: 'Meta de Leads Janeiro',
                    description: 'Alcan√ßar 50 leads no m√™s de janeiro',
                    points: 100,
                    deadline: '2024-01-31',
                    type: 'equipe',
                    status: 'ativa',
                    createdAt: '2024-01-01T08:00:00.000Z'
                }
            ];

            data.teamNotes = [
                {
                    id: '1',
                    title: 'Reuni√£o de Segunda',
                    content: 'Lembrar de discutir as metas do trimestre na reuni√£o de segunda-feira.',
                    author: 'Admin',
                    createdAt: '2024-01-15T16:30:00.000Z'
                }
            ];

            data.chatMessages = [
                {
                    id: '1',
                    sender: 'Admin',
                    message: 'Bem-vindos ao chat da equipe!',
                    timestamp: '2024-01-15T09:00:00.000Z'
                }
            ];

            saveData(); // Save sample data
        }

        // Initialize everything when page loads
        window.addEventListener('load', function() {
            // Set focus on email field
            document.getElementById('email').focus();
            
            // Add sample data notification
            if (!localStorage.getItem('gamecreators_data_v2')) {
                setTimeout(() => {
                    showNotification('Sistema carregado com dados de exemplo. Use senha: 123456', 'info');
                }, 1000);
            }
        });
    </script>
</body>
</html>
